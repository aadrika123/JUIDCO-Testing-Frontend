import{r as h,j as c,u as wt,f as xt,d as ot,A as ct,F as rt,b as S,L as vt,P as Ct}from"./index-0069139d.js";import{u as It}from"./formik.esm-61dbd241.js";import{c as St,b as yt,a as nt}from"./index.esm-51642fe0.js";/* empty css                */import{R as pt}from"./Hourglass-449055df.js";import{T as dt,F as Et,P as Nt}from"./LoadingButton-5fb774e8.js";import"./hoist-non-react-statics.cjs-0a2889ca.js";import"./ThemeStyle-994f51bc.js";import"./index.esm-88163b48.js";/*! js-cookie v3.0.5 | MIT */function y(a){for(var u=1;u<arguments.length;u++){var m=arguments[u];for(var d in m)a[d]=m[d]}return a}var Rt={read:function(a){return a[0]==='"'&&(a=a.slice(1,-1)),a.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(a){return encodeURIComponent(a).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function N(a,u){function m(e,o,i){if(!(typeof document>"u")){i=y({},u,i),typeof i.expires=="number"&&(i.expires=new Date(Date.now()+i.expires*864e5)),i.expires&&(i.expires=i.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var f="";for(var l in i)i[l]&&(f+="; "+l,i[l]!==!0&&(f+="="+i[l].split(";")[0]));return document.cookie=e+"="+a.write(o,e)+f}}function d(e){if(!(typeof document>"u"||arguments.length&&!e)){for(var o=document.cookie?document.cookie.split("; "):[],i={},f=0;f<o.length;f++){var l=o[f].split("="),v=l.slice(1).join("=");try{var r=decodeURIComponent(l[0]);if(i[r]=a.read(v,r),e===r)break}catch{}}return e?i[e]:i}}return Object.create({set:m,get:d,remove:function(e,o){m(e,"",y({},o,{expires:-1}))},withAttributes:function(e){return N(this.converter,y({},this.attributes,e))},withConverter:function(e){return N(y({},this.converter,e),this.attributes)}},{attributes:{value:Object.freeze(u)},converter:{value:Object.freeze(a)}})}var bt=N(Rt,{path:"/"});const At=()=>{const[a,u]=h.useState(""),m=()=>{const l=Math.random().toString(36).slice(2,8).toUpperCase();u(l)},d=(l,v)=>l===a?!0:(v({captcha:""},!1),m(),!1),e=document.createElement("canvas");e.style.margin="0",e.style.padding="0",e.width=100,e.height=22;const o=e.getContext("2d");o.font="bold 15px Arial",o.fillStyle="blue",o.fillText(a,21,16);const i=e.toDataURL();return h.useEffect(()=>{m()},[]),{catptchaTextField:l=>c("div",{children:c(dt,{name:"captcha",placeholder:"Enter captcha",formik:l})}),captcha:a,dataUrl:i,verifyCaptcha:d,generateCaptcha:m}},Vt=()=>{const a=wt(),{catptchaTextField:u,dataUrl:m,generateCaptcha:d,verifyCaptcha:e}=At(),{notify:o,setisLoggedIn:i,setheartBeatCounter:f}=h.useContext(xt),[l,v]=h.useState(null),[r,R]=h.useState(),{api_login:st,api_getPermission:mt}=Ct(),[p,w]=h.useState(!1),ut=St({email:yt().required("Enter email"),password:nt().required("Enter password"),captcha:nt().required("Enter captcha")}),g=It({initialValues:{email:"",password:"",type:"mobile",captcha:""},onSubmit:async(n,{resetForm:t})=>{e(n==null?void 0:n.captcha,t)?ht():o("Invalid Captcha")},validationSchema:ut}),b=["TAX COLLECTOR","ULB TAX COLLECTOR","TEAM LEADER","JUNIOR ENGINEER","TAX DAROGA","DRIVER","SEPTIC TANKER DRIVER","ENFORCEMENT OFFICER","CONDUCTOR","PARKING INCHARGE","LAMS FieldOfficer"],ft=h.useMemo(()=>Array.isArray(l)&&l.some(n=>b.includes(n)),[l]);h.useEffect(()=>{var n,t,x,C;l!=null&&(ft?(o("Login Successful !!! ","success"),window.localStorage.setItem("menuList",JSON.stringify((n=r==null?void 0:r.userDetails)==null?void 0:n.menuPermission)),window.localStorage.setItem("userName",JSON.stringify((t=r==null?void 0:r.userDetails)==null?void 0:t.name)),window.localStorage.setItem("conductorId",(x=r==null?void 0:r.userDetails)==null?void 0:x.user_name),window.localStorage.setItem("roles",JSON.stringify((C=r==null?void 0:r.userDetails)==null?void 0:C.role)),a("/dashboard")):o("You don't have permission of Tax Collector !!!","warn"))},[l]);const E=JSON.parse(window.localStorage.getItem("roles")),I=window.localStorage.getItem("token"),gt=h.useMemo(()=>Array.isArray(E)&&E.some(n=>b.includes(n)),[E,I]);h.useEffect(()=>{I!=""&&I!=null&&I!=null&&gt&&a("/dashboard")},[]);const ht=()=>{w(!0);let n={email:g.values.email,password:g.values.password,type:"mobile"};console.log("--1--before login send...",n),ot.post(st,n,ct()).then(function(t){var x,C,A,F,O,L,T,D,k,U,P,j,V,B,J,M,_,q,G,X,$,z,H,K,W,Y,Q,Z,tt,et;console.log("login response => ",t),t.data.status==!0?(console.log("--2--login response...",t),window.localStorage.setItem("token",(C=(x=t==null?void 0:t.data)==null?void 0:x.data)==null?void 0:C.token),window.localStorage.setItem("isLoggedIn",!0),window.localStorage.setItem("userEmail",(O=(F=(A=t==null?void 0:t.data)==null?void 0:A.data)==null?void 0:F.userDetails)==null?void 0:O.email),window.localStorage.setItem("userName",(D=(T=(L=t==null?void 0:t.data)==null?void 0:L.data)==null?void 0:T.userDetails)==null?void 0:D.name),window.localStorage.setItem("conductorId",(P=(U=(k=t==null?void 0:t.data)==null?void 0:k.data)==null?void 0:U.userDetails)==null?void 0:P.user_name),window.localStorage.setItem("userType",(B=(V=(j=t==null?void 0:t.data)==null?void 0:j.data)==null?void 0:V.userDetails)==null?void 0:B.user_type),window.localStorage.setItem("userMobile",(_=(M=(J=t==null?void 0:t.data)==null?void 0:J.data)==null?void 0:M.userDetails)==null?void 0:_.mobile),window.localStorage.setItem("ulbId",(X=(G=(q=t==null?void 0:t.data)==null?void 0:q.data)==null?void 0:G.userDetails)==null?void 0:X.ulb_id),window.localStorage.setItem("device","mobile"),window.localStorage.setItem("userUlbName",JSON.stringify((H=(z=($=t==null?void 0:t.data)==null?void 0:$.data)==null?void 0:z.userDetails)==null?void 0:H.ulbName)),bt.set("accesstoken",(W=(K=t==null?void 0:t.data)==null?void 0:K.data)==null?void 0:W.token,{expires:7,secure:!0}),R((Y=t==null?void 0:t.data)==null?void 0:Y.data),v((tt=(Z=(Q=t==null?void 0:t.data)==null?void 0:Q.data)==null?void 0:Z.userDetails)==null?void 0:tt.role),f(s=>s+1),i(!0),ot.post(mt,{moduleId:1},ct()).then(s=>{var at,it,lt;console.log("getPermission response => ",s),s.data.status==!0?window.localStorage.setItem("menuList",JSON.stringify((it=(at=s==null?void 0:s.data)==null?void 0:at.data)==null?void 0:it.permission)):(o((lt=s==null?void 0:s.data)==null?void 0:lt.message,"error"),g.setFieldValue("captcha",""),d(),w(!1))}).catch(s=>{console.log("getPermission error => ",s),o("Something went wrong !!! ","error"),g.setFieldValue("captcha",""),d(),w(!1)})):(w(!1),o((et=t==null?void 0:t.data)==null?void 0:et.message,"error"),g.setFieldValue("captcha",""),d(),w(!1))}).catch(function(t){w(!1),console.log("--2--login error...",t),o("Something went wrong !!! ","error"),g.setFieldValue("captcha",""),d(),w(!1)})};return c(rt,{children:S(Et,{formik:g,children:[c("div",{className:"mt-6 flex flex-col flex-wrap gap-2",children:c(dt,{name:"email",label:"Email",formik:g})}),c("div",{className:"mt-4 flex flex-col flex-wrap gap-2",children:c(Nt,{name:"password",label:"Password",formik:g})}),c("div",{className:"mt-6 flex flex-col flex-wrap gap-0",children:S("div",{className:"flex justify-between",children:[c("div",{className:"bg-gray-400 px-4 py-1 rounded-sm",children:c("img",{src:m,alt:"captcha"})}),c("div",{children:c("button",{type:"button",onClick:d,className:"text-[#5846BE] text-sm",children:"Reload Captcha"})})]})}),c("div",{className:"mt-2 flex flex-col flex-wrap gap-2",children:u(g)}),c("div",{className:"text-center mb-6 mt-4",children:p?c("div",{className:"flex justify-center",children:c(pt,{strokeColor:"grey",strokeWidth:"5",animationDuration:"0.75",width:"25",visible:!0})}):S(rt,{children:[c("div",{className:"mb-1",children:c(vt,{to:"/forget-password",className:"text-xs text-indigo-600",children:"Forgot Password ?"})}),S("button",{disabled:p,type:"submit",className:"px-4 py-1.5 bg-green-200 hover:bg-green-300 rounded-md shadow-md text-sm",children:[" ",p?"Please wait...":"Login"]})," "]})})]})})};export{Vt as default};
