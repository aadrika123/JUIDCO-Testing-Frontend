import{j as e}from"./mui-8bd1858b.js";import{b as de,u as $,r as l,f as le}from"./router-56e993c5.js";import{f as C}from"./index.esm-0185619c.js";import{h as m}from"./moment-a9aaa855.js";import{M as ce,o as ie,W as me,A as f,c as xe,d as V,u as pe}from"./index-48939ba9.js";import"./RazorpayPaymentScreen-157b41ea.js";import{B as he}from"./BarLoader-29e6d937.js";import{a as ue}from"./index.esm-6017d94b.js";import{i as ge}from"./success-39308b33.js";import{U as be}from"./UseRazorpay-4579b10c.js";import{h as fe}from"./useRazorPayForApp-00a62b48.js";import"./reactIcons-d26c0b2d.js";import"./axios-ab7cc016.js";import"./materialTailwind-98468b5d.js";import"./redux-a3f69129.js";import"./i18next-2edfafb0.js";import"./index-1cc92de0.js";const ye={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",background:"transparent",border:"none"}};function Ne(x){const[t,y]=de.useState(!1),a=x==null?void 0:x.transData,i=$(),c=x.paymentData;console.log("paymentData======",c),l.useEffect(()=>{y(!0)},[]);function j(){}function p(){y(!1),i("/water-dashboard")}return e.jsx("div",{className:"",children:e.jsx(ce,{isOpen:t,onAfterOpen:j,onRequestClose:p,style:ye,contentLabel:"Example Modal",children:e.jsx("div",{children:e.jsxs("div",{className:"bg-green-200 shadow-2xl border border-sky-200 p-5 m-5 rounded-md",children:[e.jsxs("div",{onClick:p,className:"absolute cursor-pointer bg-green-100 hover:bg-gray-300 p-1 rounded-md",children:[e.jsx(ue,{})," "]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:ge,className:"h-20",alt:"",srcset:""})}),e.jsx("div",{className:"py-1 pl-3 font-semibold text-center text-2xl text-gray-800",children:" Payment Completed Successfully "}),e.jsxs("p",{className:"text-center",children:[e.jsx("span",{className:"text-base",children:" Payment Transaction No"})," ",e.jsx("span",{className:"font-bold text-blue-700 text-xl",children:a==null?void 0:a.transectionNo})]}),e.jsx("p",{className:"border-b border-gray-300 mx-10 py-1"}),e.jsxs("div",{className:"grid grid-cols-12 px-8 py-3 leading-8 space-x-8 text-sm",children:[e.jsx("div",{className:"md:col-span-6 col-span-12",children:e.jsxs("div",{className:"grid grid-cols-12",children:[e.jsxs("div",{className:"col-span-6 font-semibold",children:[e.jsx("p",{children:"Application No"}),e.jsx("p",{children:"Transaction Type"})]}),e.jsxs("div",{className:"col-span-6 ml-3",children:[e.jsx("p",{children:(a==null?void 0:a.applicationNo)||"NA"}),e.jsx("p",{children:(a==null?void 0:a.tranType)||"NA"})]})]})}),e.jsx("div",{className:"md:col-span-6 col-span-12",children:e.jsxs("div",{className:"grid grid-cols-12",children:[e.jsxs("div",{className:"col-span-6 font-semibold",children:[e.jsx("p",{children:"Amount"}),e.jsx("p",{children:"Payment Date"})]}),e.jsxs("div",{className:"col-span-6",children:[e.jsx("p",{children:a==null?void 0:a.amount}),e.jsx("p",{children:a==null?void 0:a.transectionDate})]})]})}),e.jsx("div",{className:"col-span-12 md:mt-4 mt-10",children:e.jsxs("div",{className:"flex justify-center",children:[e.jsx("button",{onClick:p,className:"mx-2 bg-sky-600 hover:bg-sky-700 transition duration-200 hover:scale-105 font-normal text-white px-6 py-1 text-sm rounded-sm shadow-xl",children:"Close"}),a&&e.jsx("button",{onClick:()=>i(`/waterUserReceipt/${a==null?void 0:a.transectionNo}`),className:"mx-2 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm  rounded-sm shadow-xl",children:"View Receipt"})]})})]})]})})})})}const Ge=x=>{var I,S,P;const[t,y]=l.useState(),[a,i]=l.useState(!1),[c,j]=l.useState(),{handlePayment:p}=be(),[n,v]=l.useState(),[h,F]=l.useState(),[N,H]=l.useState(),[D,je]=l.useState(!1),[J,ve]=l.useState(),[we,A]=l.useState(!1),{id:u}=le(),w=$(),{notify:M}=l.useContext(ie),{api_generatedreceipt:k,api_getTranNo:_e,api_waterApprovedApplicationDetails:K,api_waterListDemand:Q,api_waterDemandCalculation:X,api_waterDemandPayment:Z,header:g}=me();l.useEffect(()=>{se(),te()},[u]),l.useEffect(()=>{ee()},[N,h]);const ee=()=>{if(N==""||h=="")return v();i(!0);const s={consumerId:u,demandFrom:h,demandUpto:N};f.post(X,s,g).then(function(o){console.log("water demand calculation Details",o.data.data),v(o.data.data),i(!1)}).catch(function(o){console.log("Error : water calculating demand",o),i(!1)})},se=()=>{i(!0),f.post(K,{id:u},g).then(function(s){console.log("water Approved Application Details",s.data.data),y(s.data.data),i(!1)}).catch(function(s){console.log("Error : water Approved Application Details",s),i(!1)})},te=()=>{f.post(Q,{ConsumerId:u},g).then(s=>{console.log("Fetched Water Demand List",s.data.data),j(s.data.data)}).catch(s=>{console.log("Exception while fetching Water Demand",s)})},oe=async s=>{console.log("generateReceipt",s),console.log(s);let o={applicationId:s==null?void 0:s.applicationId,departmentId:s==null?void 0:s.departmentId,status:"",captured:"1",card_id:"",amount:s==null?void 0:s.amount,payment_method:"upi/netbanking",workflow_id:s==null?void 0:s.workflowId,user_id:s==null?void 0:s.userId,ulb_id:s==null?void 0:s.ulbId,user_id:localStorage.getItem("citizenId"),payment_order_id:s==null?void 0:s.razorpay_order_id,payment_id:s==null?void 0:s.razorpay_payment_id,created_at:""};console.log("Receipt",s),f.post(k,o,g).then(d=>{var b;console.log("genereted receipt",d),d.data.status==!0?(console.log("Oder ID Generated ++++dddddddddddddddddddddddd+++++",d.data),w(`/waterUserReceipt/${(b=d==null?void 0:d.data)==null?void 0:b.data}`)):toast.error(d.data.message,"error")}).catch(d=>{console.log("Error genrating order id",d),toast.error(d.message,"error")})},re=()=>{i(!0);const s={consumerId:u,demandFrom:h,demandUpto:N,amount:n==null?void 0:n.totalPayAmount,paymentMode:"online",remarks:"citizen payment"};console.log("final submit",s),f.post(Z,s,g).then(o=>{var d,b,Y,R,U,E,O,T,L,z,W,q,B,G;console.log("Oder ID Generated",o),A(!1),o.data.status==!0?(window.ReactNativeWebView?fe({generatedOrder:(d=o==null?void 0:o.data)==null?void 0:d.data,payload:{applicationId:(Y=(b=o==null?void 0:o.data)==null?void 0:b.data)==null?void 0:Y.applicationId,departmentId:(U=(R=o==null?void 0:o.data)==null?void 0:R.data)==null?void 0:U.departmentId,status:"",captured:"1",card_id:"",amount:(O=(E=o==null?void 0:o.data)==null?void 0:E.data)==null?void 0:O.amount,payment_method:"upi/netbanking",workflow_id:(L=(T=o==null?void 0:o.data)==null?void 0:T.data)==null?void 0:L.workflowId,user_id:(W=(z=o==null?void 0:o.data)==null?void 0:z.data)==null?void 0:W.userId,ulb_id:(B=(q=o==null?void 0:o.data)==null?void 0:q.data)==null?void 0:B.ulbId,user_id:localStorage.getItem("citizenId"),created_at:""},api:k,returnUrl:"/citizen/waterUserReceipt"}):p((G=o==null?void 0:o.data)==null?void 0:G.data,oe),w("/water-dashboard",{replace:!0})):M(o.data.message,"error")}).catch(o=>{A(!1),console.log("Error genrating order id",o),M(o.message,"error")})},ne=xe({monthFrom:V().required("Require Field"),monthUpto:V().required("Require Field")}),r=pe({enableReinitialize:!0,initialValues:{monthFrom:"",monthUpto:"",penalty:"",rebate:"",advanced:""},onSubmit:(s,o)=>{re()},validationSchema:ne}),ae=s=>{let o=s.target.name,d=s.target.value;o=="monthFrom"&&F(d),o=="monthUpto"&&H(d)},_=(I=c==null?void 0:c.consumerDemands)==null?void 0:I.filter(s=>m(s.demand_upto,"YYYY-MM-DD").format("yy-MM").toString()>=m(h,"YYYY-MM-DD").format("yy-MM"));return e.jsxs(e.Fragment,{children:[a&&e.jsx(he,{}),D&&e.jsx(Ne,{transData:J}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-12 lg:grid-cols-12 gap-2 container mx-auto w-full",children:e.jsxs("div",{className:"col-span-12 rounded-lg p-4 max-sm:p-0",children:[e.jsx("div",{className:"p-4 max-sm:p-2",children:e.jsxs("div",{className:"",children:[e.jsxs("h1",{className:"px-1 font-semibold font-serif  text-gray-500",children:[e.jsx(C,{className:"inline"})," Basic Details"]}),e.jsx("div",{className:"py-6 mt-2 bg-white rounded-lg shadow-xl p-4",children:e.jsxs("div",{className:"flex space-x-5 pl-4 max-sm:flex-col max-sm:space-x-0 max-sm:space-y-2 ",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-sm",children:t!=null&&t.ulb_name?t==null?void 0:t.ulb_name:"N/A"}),e.jsx("div",{className:"text-gray-500 text-xs",children:"ULB Name"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-bold text-sm",children:t!=null&&t.ward_name?t==null?void 0:t.ward_name:"N/A"}),e.jsx("div",{className:"text-gray-500 text-xs",children:"Ward No."})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-bold text-sm",children:t!=null&&t.consumer_no?t==null?void 0:t.consumer_no:"N/A"}),e.jsx("div",{className:"text-gray-500 text-xs",children:"Consumer No"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-bold text-sm",children:t!=null&&t.connection_through?t==null?void 0:t.connection_through:"N/A"}),e.jsx("div",{className:"text-gray-500 text-xs",children:"Connection Through"})]}),(t==null?void 0:t.connection_through)=="SAF"?e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-md",children:t!=null&&t.saf_no?t==null?void 0:t.saf_no:"N/A"}),e.jsx("div",{className:"text-gray-500 text-xs",children:"SAF No"})]}):e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-md",children:t!=null&&t.holding_no?t==null?void 0:t.holding_no:"N/A"}),e.jsx("div",{className:"text-gray-500 text-xs",children:"Holding No"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold text-md",children:t!=null&&t.owner_char_type?t==null?void 0:t.owner_char_type:"N/A"}),e.jsx("div",{className:"text-gray-500 text-xs",children:"Ownership Type"})]})]})})]})}),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"mt-5 p-4",children:[e.jsxs("h1",{className:"px-1 font-semibold font-serif text-gray-500",children:[e.jsx(C,{className:"inline"}),"Due Demand Details"]}),e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"min-w-full leading-normal mt-2 bg-white rounded-lg shadow-xl p-4",children:[e.jsx("thead",{className:"font-bold text-left text-sm border text-gray-800 bg-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:"#"}),e.jsx("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:"Demand From"}),e.jsx("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:"Demand Upto"}),e.jsx("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:"Demand Amount"}),e.jsx("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:"Penalty"}),e.jsx("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:"Connection Type"}),e.jsx("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:"Payable Amount "})]})}),e.jsx("tbody",{className:"text-sm",children:e.jsx(e.Fragment,{children:(S=c==null?void 0:c.consumerDemands)==null?void 0:S.map((s,o)=>e.jsxs("tr",{className:"bg-white shadow-xl border-b border-gray-200",children:[e.jsx("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:o+1}),e.jsx("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:s!=null&&s.demand_from?m(s==null?void 0:s.demand_from,"YYYY-MM-DD").format("DD-MMM-yy"):"N/A"}),e.jsx("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:s!=null&&s.demand_upto?m(s==null?void 0:s.demand_upto,"YYYY-MM-DD").format("DD-MMM-yy"):"N/A"}),e.jsx("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:s!=null&&s.balance_amount?s==null?void 0:s.balance_amount:"N/A"}),e.jsx("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:s!=null&&s.penalty?s==null?void 0:s.penalty:"N/A"}),e.jsx("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:s!=null&&s.connection_type?s==null?void 0:s.connection_type:"N/A"}),e.jsx("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:s!=null&&s.amount?"₹ "+(s==null?void 0:s.amount):"N/A"})]}))})})]})})]})}),e.jsx("div",{className:"col-span-12 rounded-lg p-4",children:e.jsx("div",{className:"py-6 mt-2 bg-white rounded-lg shadow-xl border border-y-gray-200 p-4",children:e.jsx("form",{onSubmit:r.handleSubmit,onChange:ae,className:"p-4 relative",children:e.jsxs("div",{className:"grid grid-cols-12",children:[e.jsxs("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[e.jsxs("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold",children:[e.jsx("small",{className:" mt-1 text-sm font-semibold text-red-600 inline ",children:"*"}),"Select Month From"]}),e.jsxs("select",{...r.getFieldProps("monthFrom"),type:"text",className:"form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md",children:[e.jsx("option",{value:"",children:"Select"}),(P=c==null?void 0:c.consumerDemands)==null?void 0:P.map((s,o)=>e.jsx("option",{value:s.demand_from,children:m(s.demand_from,"YYYY-MM-DD").format("MMM-yy")},o))]}),e.jsx("span",{className:"text-red-600 absolute text-xs",children:r.touched.monthFrom&&r.errors.monthFrom?r.errors.monthFrom:null})]}),e.jsxs("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[e.jsxs("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold",children:[e.jsx("small",{className:" mt-1 text-sm font-semibold text-red-600 inline ",children:"*"}),"Select Month Upto"]}),e.jsxs("select",{...r.getFieldProps("monthUpto"),type:"text",className:"form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md",children:[e.jsx("option",{value:"",children:"Select"}),_==null?void 0:_.map((s,o)=>e.jsx("option",{value:s.demand_upto,children:m(s.demand_upto,"YYYY-MM-DD").format("MMM-yy")},o))]}),e.jsx("span",{className:"text-red-600 absolute text-xs",children:r.touched.monthUpto&&r.errors.monthUpto?r.errors.monthUpto:null})]}),e.jsxs("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[e.jsx("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold",children:"Total Demand"}),e.jsx("input",{...r.getFieldProps("amount"),value:(n==null?void 0:n.totalDemand)||0,disabled:!0,type:"text",className:"form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md bg-slate-200"}),e.jsx("span",{className:"text-red-600 absolute text-xs",children:r.touched.amount&&r.errors.amount?r.errors.amount:null})]}),e.jsxs("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[e.jsx("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold",children:"Penalty"}),e.jsx("input",{...r.getFieldProps("penalty"),value:(n==null?void 0:n.totalPenalty)||0,disabled:!0,type:"text",className:"form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md bg-slate-200"}),e.jsx("span",{className:"text-red-600 absolute text-xs",children:r.touched.penalty&&r.errors.penalty?r.errors.penalty:null})]}),e.jsxs("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[e.jsx("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold",children:"Rebate"}),e.jsx("input",{...r.getFieldProps("rebate"),value:(n==null?void 0:n.totalRebate)||0,disabled:!0,type:"text",className:"form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md bg-slate-200"}),e.jsx("span",{className:"text-red-600 absolute text-xs",children:r.touched.rebate&&r.errors.rebate?r.errors.rebate:null})]}),e.jsxs("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[e.jsx("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold",children:"Advanced"}),e.jsx("input",{...r.getFieldProps("advanced"),value:(n==null?void 0:n.totalAdvance)||0,disabled:!0,type:"text",className:"form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md bg-slate-200"}),e.jsx("span",{className:"text-red-600 absolute text-xs",children:r.touched.advanced&&r.errors.advanced?r.errors.advanced:null})]}),e.jsx("div",{className:"form-group mb-4 col-span-12 md:col-span-6 md:px-4",children:e.jsxs("p",{children:["Remain Advance : ",e.jsx("span",{className:"text-orange-700 font-semibold",children:(n==null?void 0:n.remaningAdvanceAmount)||0})]})}),e.jsx("div",{className:"form-group mb-4 col-span-12 md:col-span-6 md:px-4",children:e.jsxs("p",{children:[" Payable Amount : ",e.jsx("span",{className:"text-green-700 font-semibold",children:n!=null&&n.totalPayAmount?"₹"+(n==null?void 0:n.totalPayAmount):0})]})}),e.jsxs("div",{className:"col-span-12 grid grid-cols-2 mt-10",children:[e.jsx("div",{className:""}),e.jsxs("div",{className:"md:pl-10 text-right space-x-5 max-sm:space-x-0 max-sm:pl-0 max-sm:space-y-2",children:[e.jsx("button",{type:"button",onClick:()=>w(-1),className:" px-6 py-2.5 max-sm:px-8 bg-sky-600 text-white font-medium text-xs leading-tight  rounded shadow-md hover:bg-sky-700 hover:shadow-lg focus:bg-sky-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-indigo-800 active:shadow-lg transition duration-150 ease-in-out cursor-pointer",children:"Back"}),e.jsx("button",{type:"submit",className:" px-6 py-2.5 bg-indigo-600 text-white font-medium text-xs leading-tight  rounded shadow-md hover:bg-indigo-600 hover:shadow-lg focus:bg-indigo-700 focus:shadow-lg focus:outline-none focus:ring-0 active:shadow-lg transition duration-150 ease-in-out cursor-pointer",children:"Pay Now"})]})]})]})})})})]})})]})};export{Ge as default};
