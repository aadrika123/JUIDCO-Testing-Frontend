import{_ as q,c as T,j as e,P as ee}from"./index-K9wnwIEh.js";import{r as Y,h as ae,d as _}from"./router-WshRxXk2.js";import{u as te,F as ie,S as A,T as r,L as se}from"./TextArea-wmoREJF1.js";import{r as x}from"./tailwind-Ucrx0-S6.js";import{c as oe,a as h}from"./index.esm-Wdru5IDi.js";import{a as ne,b as $}from"./useCustomQuery-5jXXRIIF.js";import{u as le}from"./useErrorFocusField-dZsYFtof.js";import{r as z}from"./resizeImage-0lDDx4VD.js";import{C as re,O as de}from"./CreateConfirmation-m8LcWMgm.js";import"./reactQuery-2daanlHr.js";import"./reactQueryDevtools-6dm9iask.js";import"./axios-YpSsR79r.js";import"./reactLazyLoadImageComponent-2lnvQYCj.js";import"./reactIcons-UnuJhE_7.js";import"./headlessui-oHdMYZDI.js";var J={};Object.defineProperty(J,"__esModule",{value:!0});var Z=J.useGeolocated=void 0;const l=Y;function ce(y={}){const{positionOptions:f={enableHighAccuracy:!0,maximumAge:0,timeout:1/0},isOptimisticGeolocationEnabled:N=!0,userDecisionTimeout:v=void 0,suppressLocationOnMount:w=!1,watchPosition:b=!1,geolocationProvider:o=typeof navigator<"u"?navigator.geolocation:void 0,watchLocationPermissionChange:O=!1,onError:C,onSuccess:S}=y,L=(0,l.useRef)(0),p=(0,l.useRef)(!0),R=(0,l.useRef)(0),[I,E]=(0,l.useState)(N),[U,t]=(0,l.useState)(),[M,k]=(0,l.useState)(),[B,G]=(0,l.useState)(),[W,H]=(0,l.useState)(),j=(0,l.useCallback)(()=>{L.current&&window.clearTimeout(L.current)},[]),F=(0,l.useCallback)(s=>{j(),p.current&&(t(()=>{}),E(!1),G(s)),C==null||C(s)},[C,j]),V=(0,l.useCallback)(s=>{j(),p.current&&(t(s.coords),k(s.timestamp),E(!0),G(()=>{})),S==null||S(s)},[S,j]),D=(0,l.useCallback)(()=>{if(!o||!o.getCurrentPosition||!o.watchPosition)throw new Error("The provided geolocation provider is invalid");v&&(L.current=window.setTimeout(()=>{F()},v)),b?R.current=o.watchPosition(V,F,f):o.getCurrentPosition(V,F,f)},[o,b,v,F,V,f]);return(0,l.useEffect)(()=>{let s;return O&&o&&"permissions"in navigator&&navigator.permissions.query({name:"geolocation"}).then(P=>{s=P,s.onchange=()=>{H(s.state)}}).catch(P=>{console.error("Error updating the permissions",P)}),()=>{s&&(s.onchange=null)}},[]),(0,l.useEffect)(()=>(w||D(),()=>{j(),b&&R.current&&(o==null||o.clearWatch(R.current))}),[W]),{getPosition:D,coords:U,timestamp:M,isGeolocationEnabled:I,isGeolocationAvailable:!!o,positionError:B}}Z=J.useGeolocated=ce;function me(){const{isGeolocationAvailable:y,isGeolocationEnabled:f,getPosition:N,coords:v,positionError:w,timestamp:b}=Z({positionOptions:{enableHighAccuracy:!0,timeout:1/0,maximumAge:localStorage.getItem("geoMaxAge")||1/0},watchPosition:!0,userDecisionTimeout:5e3});return{isGeolocationAvailable:y,isGeolocationEnabled:f,coords:v,positionError:w,timestamp:b,getPosition:N}}const ue=oe({fullName:h().required("Required"),email:h().email("Invalid email"),wardId:h().required("Required"),address1:h().required("Required"),violationPlace:h().required("Required"),photo:h().required("Required"),challanType:h().required("Required"),mobile:h().min(10).max(10).label("Mobile"),violationId:h().required("Required"),violationDepartmentId:h().required("Required")});function pe(){var D,s,P,K,Q,X;const y=ae(),f=Y.useRef(),[N,v]=_.useState(""),[w,b]=_.useState(""),[o,O]=_.useState(""),[C,S]=_.useState(""),{AutoFocusErrorField:L}=le(),{coords:p,isGeolocationEnabled:R}=me(),I=ne({}),E=$({api:T.api_getWardlist,options:{enabled:!0}}),U=$({api:T.api_get_department_list,options:{enabled:!0}}),t=te({initialValues:{challanType:"",fullName:"",guardianName:"",mobile:"",email:"",holdingNo:"",tradeLicenseNo:"",address1:"",violationPlace:"",witnessName:"",witnessMobileNo:"",city:"",region:"",violationId:"",violationType:"",violationDepartmentId:"",postalCode:"",penaltyAmount:"",wardId:"",photo:"",photo2:"",photo3:"",pdf:"",latitude:"",longitude:"",audioVideo:""},validationSchema:ue,onSubmit:async a=>{await re("Are you sure you want to generate challan?")?await V(a):q.error("Challan Generation Cancelled")}}),{isSubmitting:M,submitCount:k,errors:B}=t,G=async a=>{var d,c,m,u;if(!R){q.error("Please enable location permission to capture the image with location"),a.target.value=null;return}const n=a.target.files[0];if(n){const i=await z(n),g=new File([i],(c=(d=a==null?void 0:a.target)==null?void 0:d.files[0])==null?void 0:c.name,{type:(u=(m=a==null?void 0:a.target)==null?void 0:m.files[0])==null?void 0:u.type});v(URL.createObjectURL(g)),t.setFieldValue("photo",g),t.setFieldValue("latitude",p==null?void 0:p.latitude),t.setFieldValue("longitude",p==null?void 0:p.longitude)}else t.setFieldValue("photo",null),t.setFieldValue("latitude",""),t.setFieldValue("longitude","")},W=async a=>{var d,c,m,u;const n=a.target.files[0];if(n){const i=await z(n),g=new File([i],(c=(d=a==null?void 0:a.target)==null?void 0:d.files[0])==null?void 0:c.name,{type:(u=(m=a==null?void 0:a.target)==null?void 0:m.files[0])==null?void 0:u.type});b(URL.createObjectURL(g)),t.setFieldValue("photo2",g)}else t.setFieldValue("photo2",null)},H=async a=>{var d,c,m,u;const n=a.target.files[0];if(n){const i=await z(n),g=new File([i],(c=(d=a==null?void 0:a.target)==null?void 0:d.files[0])==null?void 0:c.name,{type:(u=(m=a==null?void 0:a.target)==null?void 0:m.files[0])==null?void 0:u.type});O(URL.createObjectURL(g)),t.setFieldValue("photo3",g)}else t.setFieldValue("photo3",null)},j=async a=>{const n=a.target.files[0];t.setFieldValue("pdf",n),S(URL.createObjectURL(n))},F=$({api:T.api_department_type_by_department_id,config:{departmentId:t.values.violationDepartmentId},value:[t.values.violationDepartmentId],options:{enabled:!!t.values.violationDepartmentId}}),V=async a=>{var n,d,c,m,u;try{const i=await I.mutateAsync({api:a.challanType=="onSpot"?T.api_save_on_spot:T.api_save_verification,data:a});(n=i==null?void 0:i.data)!=null&&n.status?(q.success((d=i==null?void 0:i.data)==null?void 0:d.message),a.challanType=="onSpot"?(y("/fines-app/today-challan"),t.resetForm()):(y("/fines-app/today-application"),t.resetForm())):q.error((c=i==null?void 0:i.data)==null?void 0:c.message)}catch(i){q.error((u=(m=i==null?void 0:i.response)==null?void 0:m.data)==null?void 0:u.message)}};return _.useEffect(()=>{L({formik:t})},[B,k,M]),e.jsxs(ee,{title:"Generate Challan",meta:e.jsx(e.Fragment,{children:e.jsx("meta",{name:"description",content:"Generate Challan"})}),children:[I.isLoading&&e.jsx(de,{}),e.jsx("div",{className:"p-4",children:e.jsxs(ie,{formik:t,children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-sm font-semibold text-blue-gray-500 mb-2 ",children:"# Violator Information"}),e.jsx(x.Card,{className:"rounded-2xl",children:e.jsx(x.Card.Body,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-1 md:grid-cols-2",children:[e.jsxs(A,{name:"challanType",label:"Challan Type",formik:t,isRequiredLabel:!0,children:[e.jsx("option",{value:"",children:"Select Challan Type"}),e.jsx("option",{value:"onSpot",children:"On Spot"}),e.jsx("option",{value:"verification",children:"Verification"})]}),e.jsx(r,{formik:t,isRequiredLabel:!0,name:"fullName",label:"Full Name",inputValidation:["removeSpecialCharacterWithDoubleSpace","string"]}),e.jsx(r,{formik:t,name:"guardianName",label:"Guardian Name",inputValidation:["removeSpecialCharacterWithDoubleSpace","string","nocopy"]}),e.jsx(r,{formik:t,type:"number",name:"mobile",label:"Mobile No",inputValidation:["mobile"]}),e.jsx(r,{type:"email",formik:t,name:"email",label:"Email"}),e.jsxs(A,{name:"wardId",label:"Ward",formik:t,isRequiredLabel:!0,children:[e.jsx("option",{value:"",children:"Select Ward"}),(s=(D=E.data)==null?void 0:D.data)==null?void 0:s.map(a=>e.jsx("option",{value:a.id,children:a.ward_name},a.id))]}),e.jsx(r,{formik:t,name:"holdingNo",label:"Holding No",inputValidation:["removeSpace"]}),e.jsx(r,{formik:t,name:"tradeLicenseNo",label:"Trade License No",inputValidation:["removeSpace"]})]})})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h1",{className:"text-sm font-semibold text-blue-gray-500 mb-2 ",children:"# Violator Address Information"}),e.jsx(x.Card,{className:"rounded-2xl",children:e.jsx(x.Card.Body,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-1 md:grid-cols-2",children:[e.jsx(r,{formik:t,name:"region",label:"Region",inputValidation:["removeDoubleSpace"]}),e.jsx(r,{formik:t,name:"address1",isRequiredLabel:!0,label:"Street Address",inputValidation:["removeDoubleSpace"]}),e.jsx(r,{isRequiredLabel:!0,formik:t,name:"violationPlace",label:"Place",inputValidation:["removeDoubleSpace","string"]})]})})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h1",{className:"text-sm font-semibold text-blue-gray-500 mb-2 ",children:"# Challan Details"}),e.jsx(x.Card,{className:"rounded-2xl",children:e.jsx(x.Card.Body,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-1 md:grid-cols-2",children:[e.jsxs(A,{name:"violationDepartmentId",label:"Violation Department",formik:t,isRequiredLabel:!0,children:[e.jsx("option",{value:"",children:"Select Violation"}),(K=(P=U.data)==null?void 0:P.data)==null?void 0:K.map(a=>e.jsx("option",{value:a.id,children:a.department_name},a.id))]}),e.jsxs(A,{name:"violationId",label:"Violation Type",formik:t,isRequiredLabel:!0,children:[e.jsx("option",{value:"",children:"Select Violation Type"}),(X=(Q=F.data)==null?void 0:Q.data)==null?void 0:X.map(a=>e.jsx("option",{value:a.id,children:a.violation_name},a.id))]})]})})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h1",{className:"text-sm font-semibold text-blue-gray-500 mb-2 ",children:"# Document"}),e.jsx(x.Card,{className:"rounded-2xl",children:e.jsx(x.Card.Body,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-1 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(r,{isRequiredLabel:!0,accept:"image/*",type:"file",name:"photo",label:"Select Image",onChange:G,ref:f}),t.errors.photo&&t.touched.photo&&e.jsx("span",{className:"text-red-600 text-xs -mt-7",children:t.errors.photo}),e.jsx("div",{className:"mt-4",children:N&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("img",{src:N,alt:"preview",className:"w-40 h-40 object-cover rounded-lg"})}),p&&t.values.photo&&e.jsxs("h1",{className:"text-sm font-semibold text-blue-gray-500 mt-2 ",children:["Latitude: ",t.values.latitude," | Longitude:"," ",t.values.longitude]}),e.jsx("hr",{className:"border-t border-gray-200 my-4"})]})})]}),e.jsxs("div",{children:[e.jsx(r,{accept:"image/*",type:"file",name:"photo2",label:"Select Image 2",onChange:W}),e.jsx("div",{className:"mt-4",children:w&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("img",{src:w,alt:"preview",className:"w-40 h-40 object-cover rounded-lg"})}),e.jsx("hr",{className:"border-t border-gray-200 my-4"})]})})]}),e.jsxs("div",{children:[e.jsx(r,{accept:"image/*",type:"file",name:"photo3",label:"Select Image 3",onChange:H}),e.jsx("div",{className:"mt-4",children:o&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("img",{src:o,alt:"preview",className:"w-40 h-40 object-cover rounded-lg"})}),e.jsx("hr",{className:"border-t border-gray-200 my-4"})]})})]}),e.jsxs("div",{children:[e.jsx(r,{accept:".pdf",type:"file",name:"pdf",label:"Select PDF",onChange:j}),e.jsx("div",{className:"mt-4",children:t.values.pdf&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("iframe",{src:C,width:"100%",height:"250px",children:"This browser does not support PDFs. Please download the PDF to view it: Download PDF"})}),e.jsx("hr",{className:"border-t border-gray-200 my-4"})]})})]})]})})})]}),e.jsx("div",{className:"py-8",children:e.jsx(se,{type:"submit",loading:I.isLoading,disabled:I.isLoading,className:"mt-4",children:"Generate Challan"})})]})})]})}function Le(){return e.jsx(pe,{})}export{Le as default};
