import{r as d,j as a,A as I,n as xt,P as ht}from"./index-5a588281.js";import{L as nt}from"./ListTable-803e9f6c.js";import{C as mt}from"./index.esm-f3259f95.js";import{u as Mt}from"./useSetTitle-1d9b5759.js";import{A as H}from"./AxiosInterceptors-aea314b9.js";import{d as ot,c as st,n as _,i as it}from"./PowerupFunctions-79d5c0b2.js";import{S as ft}from"./ShimmerEffectInline-58a923c6.js";import{B as Et}from"./BarLoader-6d7dc457.js";import{B as It}from"./BottomErrorCard-2656355b.js";import{R as ut}from"./index.esm-241dd1f8.js";import{c as Ht,a as Dt,u as zt}from"./formik.esm-4d73a438.js";import{F as $t}from"./index.esm-68fb1568.js";import{c as Bt}from"./index.esm-921e46e9.js";import"./index-f2df240c.js";import"./index-f5252c61.js";import"./index.esm-ddcfd483.js";import"./index-51275a9e.js";const Pt=n=>{var b,f,F,v,V,P,M,T;const{api_assignViolation:J}=ht(),[g,L]=d.useState(0),[p,j]=d.useState([]),[D,z]=d.useState(!1),[S,$]=d.useState(!1);d.useEffect(()=>{var m,h;const i=(h=(m=n==null?void 0:n.dataList)==null?void 0:m.filter(r=>(r==null?void 0:r.on_spot)==!0))==null?void 0:h.map(r=>r==null?void 0:r.id);j(i)},[n==null?void 0:n.dataList]);const K=i=>p.some(m=>parseInt(m)==parseInt(i)),B=(i,m="")=>{var C,q;const h=i.target.name,r=i.target.value,A=i.target.checked;if(h=="violationAll")if(z(A),A){const x=(q=(C=n==null?void 0:n.dataList)==null?void 0:C.filter(u=>parseFloat(u==null?void 0:u.penalty_amount)<=parseFloat(g)))==null?void 0:q.map(u=>u==null?void 0:u.id);j(x)}else j([]);if(h=="violationSingle"){if(A)j(x=>[...x,r]);else if(!A&&D!=!0){let x=p==null?void 0:p.filter(u=>u!=r);j(x)}}},Q=()=>{n==null||n.closeFun(),z(!1),L(0),n==null||n.refresh()},W=()=>{$(!0);let i={violationId:p};H.post(J,i,I()).then(m=>{var h,r;(h=m==null?void 0:m.data)!=null&&h.status?xt.success("Violation Assigned Successfully !!!"):n==null||n.activateBottomErrorCard(!0,st((r=m==null?void 0:m.data)==null?void 0:r.message))}).catch(m=>{n==null||n.activateBottomErrorCard(!0,"Server Error! Please try again later.")}).finally(()=>{$(!1),n==null||n.refresh()})};return a.jsxs(a.Fragment,{children:[a.jsx("span",{onClick:()=>Q(),className:"block p-1 bg-red-100 hover:bg-red-500 rounded-full hover:text-white cursor-pointer transition-all duration-200 absolute top-2 right-2",children:a.jsx(ut,{})}),a.jsxs("div",{className:"p-4 px-6",children:[a.jsx("h1",{className:"font-semibold text-sky-700 border-b pb-1 text-center my-4 text-xl ",children:"Penalty Amount Assignment for On-Spot Challan Generation"}),a.jsxs("div",{className:"bg-sky-50 p-4",children:[a.jsx("label",{for:"minmax-range",class:"block mb-2 font-medium text-gray-900 text-lg",children:"Select Penalty Range"}),a.jsx("input",{id:"minmax-range",type:"range",min:"0",max:n==null?void 0:n.maxAmount,onChange:i=>L(i.target.value),value:g,class:"w-full h-2 range-input bg-sky-800 rounded-lg appearance-none cursor-pointer darks:bg-gray-700"}),a.jsxs("div",{className:"w-full flex justify-between text-xs font-semibold",children:[a.jsx("span",{children:ot(0)}),a.jsx("span",{children:ot(n==null?void 0:n.maxAmount)})]})]}),a.jsxs("div",{className:"my-4 font-semibold",children:[a.jsx("span",{className:"text-sm font-normal",children:"Amount:"})," â‚¹ ",a.jsx("input",{type:"number",className:"focus:outline-none border-b border-gray-300 w-28 bg-white",name:"",value:g,onChange:i=>L(i.target.value),max:parseFloat(n==null?void 0:n.maxAmount),placeholder:"0.00",id:""})]}),!S&&Array.isArray(n==null?void 0:n.dataList)&&((f=(b=n==null?void 0:n.dataList)==null?void 0:b.filter(i=>parseFloat(i==null?void 0:i.penalty_amount)<=parseFloat(g)))==null?void 0:f.length)>0&&a.jsx("div",{className:"px-2 animate__animated animate__fadeIn animate__faster",children:a.jsx("button",{onClick:()=>W(),className:"float-right bg-green-500 px-3 py-1 rounded-sm shadow-lg hover:shadow-xl hover:bg-green-600 hover:text-white text-white flex items-center mb-1",children:"Assign"})}),a.jsxs("div",{className:"flex flex-col h-[60vh] w-full overflow-y-auto md:overflow-x-hidden",children:[a.jsxs("div",{className:"w-full grid grid-cols-12 items-center gap-2 bg-slate-500 text-white font-semibold border border-slate-200 px-4 py-2",children:[a.jsx("div",{className:"col-span-1",children:"Section"}),a.jsx("div",{className:"col-span-10 text-center",children:"Violation Name"}),a.jsxs("div",{className:"col-span-1 flex",children:[a.jsx("span",{children:"Action"}),Array.isArray(n==null?void 0:n.dataList)&&((v=(F=n==null?void 0:n.dataList)==null?void 0:F.filter(i=>parseFloat(i==null?void 0:i.penalty_amount)<=parseFloat(g)))==null?void 0:v.length)>0&&a.jsx("label",{class:"inline-flex items-center px-4 animate__animated animate__fadeIn animate__faster",children:a.jsx("input",{type:"checkbox",name:"violationAll",onChange:i=>B(i),class:"cursor-pointer form-checkbox h-5 w-5 text-slate-800"})})]})]}),S&&a.jsx(ft,{}),!S&&Array.isArray(n==null?void 0:n.dataList)&&((P=(V=n==null?void 0:n.dataList)==null?void 0:V.filter(i=>parseFloat(i==null?void 0:i.penalty_amount)<=parseFloat(g)))==null?void 0:P.map((i,m)=>a.jsx(a.Fragment,{children:a.jsxs("div",{className:"w-full grid grid-cols-12 items-center gap-2 bg-slate-100 border-b hover:bg-white pb-1 p-4 animate__animated animate__fadeIn animate__faster",children:[a.jsx("div",{className:"col-span-1",children:i==null?void 0:i.violation_section}),a.jsx("div",{className:"col-span-10",children:i==null?void 0:i.violation_name}),a.jsx("div",{className:"col-span-1",children:a.jsx("label",{class:"inline-flex items-center px-4",children:a.jsx("input",{type:"checkbox",name:"violationSingle",checked:D||K(i==null?void 0:i.id)?!0:null,value:i==null?void 0:i.id,onChange:h=>B(h,i==null?void 0:i.id),class:"cursor-pointer form-checkbox h-5 w-5 text-slate-800"})})})]},m)}))),!S&&Array.isArray(n==null?void 0:n.dataList)&&((T=(M=n==null?void 0:n.dataList)==null?void 0:M.filter(i=>parseFloat(i==null?void 0:i.penalty_amount)<=parseFloat(g)))==null?void 0:T.length)==0&&a.jsx("div",{className:"w-full text-center text-red-400 font-semibold pb-1 p-4",children:"No Violation Available"})]})]})]})},se=()=>{var dt,ct;Mt("Violation Master");const{api_violationMasterList:n,api_updateViolation:J,api_deleteViolation:g,api_addViolation:L,api_listDepartment:p,api_addDepartment:j,api_updateDepartment:D,api_deleteDepartment:z,api_listSection:S,api_addSection:$,api_updateSection:K,api_deleteSection:B,api_getSectionList:Q,api_getDepartmentList:W}=ht(),b=d.useRef(),[f,F]=d.useState([]),[v,V]=d.useState(!1),[P,M]=d.useState(!1),[T,i]=d.useState(""),[m,h]=d.useState(!1),[r,A]=d.useState(""),[C,q]=d.useState(null),[x,u]=d.useState(null),[gt,bt]=d.useState([]),[pt,jt]=d.useState([]),[yt,Tt]=d.useState([]),[Nt,O]=d.useState(!1),[o,X]=d.useState("department"),Z="border border-red-300 text-red-400 mx-1 px-3 py-1 rounded-sm shadow-lg hover:shadow-xl hover:bg-red-800 hover:text-white",tt="float-right bg-[#1A4D8C] px-3 py-1 rounded-sm shadow-lg hover:shadow-xl hover:bg-[#113766] hover:text-white text-white flex items-center",wt="text-gray-800 text-sm",rt="border focus:outline-none drop-shadow-sm focus:drop-shadow-md px-4 py-1 text-gray-700 shadow-black placeholder:text-sm",_t=t=>`px-4 py-1 text-sm bg-${t}-500 hover:bg-${t}-600 select-none rounded-sm hover:drop-shadow-md text-white`,et=t=>`border border-slate-700 ${t?"bg-slate-700 text-white":"text-slate-700 shadow-2xl shadow-slate-700"} mx-1 px-3 py-1 rounded-sm hover:bg-slate-700 hover:text-white text-sm`,y=(t,e)=>{h(t),i(e)},k=(t,e=null)=>{switch(A(t),t){case"add":break;case"edit":u(e),o=="department"&&c.setFieldValue("department",e==null?void 0:e.department_name),o=="section"&&(c.setFieldValue("violationSection",e==null?void 0:e.violation_section),c.setFieldValue("department",e==null?void 0:e.department_id)),o=="violation"&&(c.setFieldValue("violationName",e==null?void 0:e.violation_name),c.setFieldValue("violationSection",e==null?void 0:e.violation_section_id),c.setFieldValue("department",e==null?void 0:e.department_id),c.setFieldValue("penaltyAmount",e==null?void 0:e.penalty_amount));break;case"delete":q(e);break}b.current.showModal()},St=[{Header:"#",Cell:({row:t})=>a.jsx("div",{className:"pr-2",children:(t==null?void 0:t.index)+1})},{Header:"Department",accessor:"department_name",Cell:({cell:t})=>{var e;return _((e=t.row.original)==null?void 0:e.department_name)}},{Header:"Created At",accessor:"date",Cell:({cell:t})=>{var e;return it((e=t.row.original)==null?void 0:e.date)}},{Header:"Action",accessor:"id",Cell:({cell:t})=>a.jsx("div",{className:"flex flex-row flex-wrap gap-2",children:a.jsx("button",{onClick:()=>{var e,s;return k("delete",(s=(e=t==null?void 0:t.row)==null?void 0:e.original)==null?void 0:s.id)},className:Z,children:"Delete"})})}],vt=[{Header:"#",Cell:({row:t})=>a.jsx("div",{className:"pr-2",children:(t==null?void 0:t.index)+1})},{Header:"Department",accessor:"department_name",Cell:({cell:t})=>{var e;return _((e=t.row.original)==null?void 0:e.department_name)}},{Header:"Violation Section",accessor:"violation_section",Cell:({cell:t})=>{var e;return _((e=t.row.original)==null?void 0:e.violation_section)}},{Header:"Created At",Cell:({cell:t})=>{var e;return it((e=t.row.original)==null?void 0:e.date)}},{Header:"Action",accessor:"id",Cell:({cell:t})=>a.jsx("div",{className:"flex flex-row flex-wrap gap-2",children:a.jsx("button",{onClick:()=>{var e,s;return k("delete",(s=(e=t==null?void 0:t.row)==null?void 0:e.original)==null?void 0:s.id)},className:Z,children:"Delete"})})}],At=[{Header:"#",Cell:({row:t})=>a.jsx("div",{className:"pr-2",children:(t==null?void 0:t.index)+1})},{Header:"Department",accessor:"department_name",Cell:({cell:t})=>{var e;return _((e=t.row.original)==null?void 0:e.department_name)}},{Header:"Violation Section",accessor:"violation_section",Cell:({cell:t})=>{var e;return _((e=t.row.original)==null?void 0:e.violation_section)}},{Header:"Violation Name",accessor:"violation_name",Cell:({cell:t})=>{var e;return _((e=t.row.original)==null?void 0:e.violation_name)}},{Header:"Penalty Amount",accessor:"penalty_amount",Cell:({cell:t})=>{var e;return ot((e=t.row.original)==null?void 0:e.penalty_amount)}},{Header:"On Spot",accessor:"on_spot",Cell:({cell:t})=>{var e;return a.jsx(a.Fragment,{children:(e=t.row.original)!=null&&e.on_spot?a.jsx("span",{className:"text-green-400 font-semibold",children:"Yes"}):a.jsx("span",{className:"text-red-400 font-semibold",children:"No"})})}},{Header:"Created By",accessor:"created_by",Cell:({cell:t})=>{var e;return _((e=t.row.original)==null?void 0:e.created_by)}},{Header:"Created At",accessor:"date",Cell:({cell:t})=>{var e;return it((e=t.row.original)==null?void 0:e.date)},className:" w-[7%] "},{Header:"Action",accessor:"id",Cell:({cell:t})=>a.jsx("div",{className:"flex flex-row flex-wrap gap-2",children:a.jsx("button",{onClick:()=>{var e,s;return k("delete",(s=(e=t==null?void 0:t.row)==null?void 0:e.original)==null?void 0:s.id)},className:Z,children:"Delete"})})}],R=[{title:"Department",key:"department",width:`${o=="department"?" md:w-full ":o=="section"?" md:w-[45%] ":" md:w-[20%] "} w-full `,type:o=="department"?"text":"select",hint:"Enter department",required:!0,options:pt,okey:"id",ovalue:"department_name"},{title:"Violation Section",key:"violationSection",width:`${o=="section"?" md:w-[45%] ":" md:w-[20%] "} w-full ${o!="department"?"block ":"hidden "}`,type:o=="section"?"number":"select",hint:"Enter violation section",required:o!="department"&&!0,options:gt,okey:"id",ovalue:"violation_section"},{title:"Violation Name",key:"violationMade",width:`md:w-[20%] w-full ${o!="department"&&o!="section"?"block ":"hidden "}`,type:"text",hint:"Enter violation name",required:o!="department"&&o!="section"&&!0,options:yt,okey:"id",ovalue:"violation_name"},{title:"Penalty Amount",key:"penaltyAmount",width:`md:w-[20%] w-full ${o=="violation"?"block ":"hidden "}`,type:"number",hint:"Enter penalty Amount",required:o=="violation"&&!0}],Ct=Ht().shape([...R].reduce((t,e)=>(e!=null&&e.required&&(t[e.key]=Dt().required(e==null?void 0:e.hint)),t),{})),c=zt({initialValues:{department:"",violationMade:"",violationSection:"",penaltyAmount:""},enableReinitialize:!0,validationSchema:Ct,onSubmit:t=>{lt(t)}}),at=()=>{F([]),V(!0);let t;o=="department"&&(t=p),o=="section"&&(t=S),o=="violation"&&(t=n),H.post(t,{},I()).then(e=>{var s,l,N;(s=e==null?void 0:e.data)!=null&&s.status?F((l=e==null?void 0:e.data)==null?void 0:l.data):y(!0,st((N=e==null?void 0:e.data)==null?void 0:N.message))}).catch(e=>{y(!0,"Server Error! Please try again later.")}).finally(()=>{V(!1)})},kt=(t,e="",s,l="",N="",U=!1,w=[],Y="",G="")=>a.jsxs("div",{className:`flex flex-col ${l} `,children:[e!=""&&a.jsxs("label",{htmlFor:t,className:wt,children:[e," ",U&&a.jsx("span",{className:"text-red-500 text-xs font-bold",children:"*"})," : "]}),s!="select"&&s!="file"&&a.jsx("input",{...c.getFieldProps(t),type:s,className:rt+` ${c.touched[t]&&c.errors[t]?" border-red-200 placeholder:text-red-400 ":" focus:border-zinc-300 border-zinc-200"}`,name:t,id:"",placeholder:N,title:"Special characters are not allowed"}),s=="select"&&a.jsx("select",{...c.getFieldProps(t),className:rt+` ${c.touched[t]&&c.errors[t]?" border-red-200 placeholder:text-red-400 text-red-400":" focus:border-zinc-300 border-zinc-200 "}`,children:Nt?a.jsx("option",{children:"Loading..."}):a.jsxs(a.Fragment,{children:[a.jsx("option",{value:null,children:"Select"}),typeof w=="object"&&(w==null?void 0:w.map(E=>a.jsx("option",{className:"",value:E[Y],children:E[G]})))]})})]}),lt=t=>{M(!0),b.current.close();let e,s;switch(r){case"add":o=="department"&&(e={departmentName:t==null?void 0:t.department},s=j),o=="section"&&(e={violationSection:t==null?void 0:t.violationSection,departmentId:t==null?void 0:t.department},s=$),o=="violation"&&(e={violationName:t==null?void 0:t.violationMade,sectionId:t==null?void 0:t.violationSection,penaltyAmount:t==null?void 0:t.penaltyAmount,departmentId:t==null?void 0:t.department},s=L);break;case"edit":o=="department"&&(e={id:x==null?void 0:x.id,departmentName:t==null?void 0:t.department},s=D),o=="section"&&(e={id:x==null?void 0:x.id,violationSection:t==null?void 0:t.violationSection,department:t==null?void 0:t.department},s=K),o=="violation"&&(e={id:x==null?void 0:x.id,violationName:t==null?void 0:t.violationMade,violationSection:t==null?void 0:t.violationSection,penaltyAmount:t==null?void 0:t.penaltyAmount,department:t==null?void 0:t.department},s=J);break;case"delete":o=="department"&&(s=z,e={departmentId:C}),o=="section"&&(s=B,e={sectionId:C}),o=="violation"&&(s=g,e={id:C});break}H.post(s,e,I()).then(l=>{var N,U,w,Y,G;if((N=l==null?void 0:l.data)!=null&&N.status)xt.success((U=l==null?void 0:l.data)==null?void 0:U.message),at();else{const E=(Y=(w=l==null?void 0:l.data)==null?void 0:w.errors)==null?void 0:Y.penaltyAmount;E?y(!0,E[0]):y(!0,st((G=l==null?void 0:l.data)==null?void 0:G.message))}}).catch(l=>{y(!0,"Server Error! Please try again later.")}).finally(()=>{M(!1),c.resetForm()})},Lt=()=>{O(!0),H.post(W,{},I()).then(t=>{var e,s;(e=t==null?void 0:t.data)!=null&&e.status&&jt((s=t==null?void 0:t.data)==null?void 0:s.data)}).catch(t=>{}).finally(()=>{O(!1)})},Ft=t=>{O(!0),H.post(Q,{departmentId:t},I()).then(e=>{var s,l;(s=e==null?void 0:e.data)!=null&&s.status&&bt((l=e==null?void 0:e.data)==null?void 0:l.data)}).catch(e=>{}).finally(()=>{O(!1)})},Vt=t=>{const e=t.target.name,s=t.target.value;e=="violationSection"&&getViolationNameList(s),e=="department"&&Ft(s)};return d.useEffect(()=>{o!="department"&&Lt(),at()},[o]),a.jsxs(a.Fragment,{children:[P&&a.jsx(Et,{}),m&&a.jsx(It,{activateBottomErrorCard:y,errorTitle:T}),a.jsxs("div",{className:"poppins p-4 px-6",children:[a.jsx("div",{className:"uppercase font-semibold text-gray-700 text-2xl py-2 text-center tracking-[0.7rem]",children:"Violation   Master"}),a.jsx("div",{className:"w-full h-[0.15rem] bg-gray-400 mb-6"}),a.jsxs("div",{className:"flex gap-1 w-full flex-wrap my-6",children:[a.jsx("button",{onClick:()=>X("department"),className:et(o=="department"),children:"Department Master"}),a.jsx("button",{onClick:()=>X("section"),className:et(o=="section"),children:"Section Master"}),a.jsx("button",{onClick:()=>X("violation"),className:et(o=="violation"),children:"Violation Master"})]}),v&&a.jsx(ft,{}),!v&&o=="violation"&&a.jsxs("button",{onClick:()=>k("assign"),className:tt+" bg-orange-500 hover:bg-orange-600 capitalize flex gap-1 items-center ml-2",children:[a.jsx(Bt,{}),"Assign On Spot Violation"]}),!v&&a.jsx(a.Fragment,{children:(f==null?void 0:f.length)>0?a.jsxs(a.Fragment,{children:[a.jsxs("button",{onClick:()=>k("add"),className:tt+"capitalize flex gap-1 items-center",children:[a.jsx(mt,{})," Add ",a.jsx("span",{className:"capitalize",children:o})]}),o=="department"&&a.jsx(nt,{columns:St,dataList:f}),o=="section"&&a.jsx(nt,{columns:vt,dataList:f}),o=="violation"&&a.jsx(nt,{columns:At,dataList:f})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"flex justify-end mb-2",children:a.jsxs("button",{onClick:()=>k("add"),className:tt+"capitalize flex gap-1 items-center",children:[a.jsx(mt,{})," Add ",a.jsx("span",{className:"capitalize",children:o})]})}),a.jsx("div",{className:"bg-red-100 text-red-500 py-2 text-lg font-semibold text-center border border-red-500 drop-shadow-sm",children:"Oops! No Data Found."})]})})]}),a.jsxs("dialog",{ref:b,className:`relative overflow-clip animate__animated animate__zoomIn animate__faster ${r!="delete"&&o=="violation"&&" w-[90vw] md:max-w-[1080px]"}`,children:[r!="assign"&&r!="delete"&&a.jsx("span",{onClick:()=>(b.current.close(),c.resetForm()),className:"block p-1 bg-red-100 hover:bg-red-500 rounded-full hover:text-white cursor-pointer transition-all duration-200 absolute top-2 right-2",children:a.jsx(ut,{})}),r!="assign"&&r!="delete"&&a.jsxs("form",{onChange:t=>(c.handleChange(t),Vt(t)),onSubmit:c.handleSubmit,className:"p-4 px-8 py-6 shadow-lg",children:[a.jsxs("section",{className:"flex gap-4 flex-wrap",children:[a.jsxs("header",{className:"w-full font-semibold text-xl capitalize text-sky-700 border-b pb-1 text-center",children:[r," ",o]}),R==null?void 0:R.map(t=>kt(t==null?void 0:t.key,t==null?void 0:t.title,t==null?void 0:t.type,t==null?void 0:t.width,t==null?void 0:t.hint,t==null?void 0:t.required,t==null?void 0:t.options,t==null?void 0:t.okey,t==null?void 0:t.ovalue)),((dt=c.values)==null?void 0:dt.violationMade)!=""&&a.jsxs("div",{className:"flex flex-wrap gap-2 text-sm w-full",children:[a.jsx("span",{className:"block w-full md:w-[15%]",children:"Violation Name :"}),(ct=c.values)==null?void 0:ct.violationMade,a.jsx("span",{className:"animate-ping",children:"|"})]})]}),a.jsx("footer",{className:"mt-4 flex justify-center",children:a.jsxs("button",{type:"submit",className:_t("green"),children:[r=="add"&&"Add",r=="edit"&&"Update"]})})]}),r=="delete"&&a.jsx(a.Fragment,{children:a.jsxs("div",{className:" z-50 px-6 py-4 flex flex-col gap-4 ",children:[a.jsxs("div",{className:"flex items-center gap-6",children:[a.jsx("span",{className:"text-red-500 bg-red-100 p-2 block rounded-full drop-shadow-md shadow-red-300",children:a.jsx($t,{size:25})}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx("span",{className:"text-xl font-semibold border-b pb-1",children:"Confirmation"}),a.jsx("span",{className:"text-base",children:"Are you sure want to delete ?"})]})]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx("button",{className:"text-white bg-slate-400 hover:bg-slate-500 px-4 py-1 text-sm ",onClick:()=>b.current.close(),children:"No"}),a.jsx("button",{className:"text-white bg-red-500 hover:bg-red-600 px-4 py-1 text-sm ",onClick:()=>lt(),children:"Yes"})]})]})}),r=="assign"&&a.jsx(Pt,{closeFun:()=>b.current.close(),refresh:()=>at(),maxAmount:Math.max(...f.map(t=>parseInt(t==null?void 0:t.penalty_amount,10))),dataList:f,activateBottomErrorCard:y})]})]})};export{se as default};
