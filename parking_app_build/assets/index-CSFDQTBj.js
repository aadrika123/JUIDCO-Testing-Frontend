import{u as C,j as e,C as E,p as H,_ as d}from"./index-13YLhq3g.js";import{u as I,r as c}from"./router-DLL89Qev.js";import{u as P}from"./useCustomQuery-DT-eWy3B.js";import{P as Y}from"./index-Dz5KCr_l.js";import{s as z}from"./index-DXEukT1i.js";import{o as B,c as A,a as o}from"./yup-BsxUPbC_.js";import{b as L,F as M,R as u,B as R}from"./switch-CmH_R43D.js";import{h as p}from"./moment-BjLXg0w5.js";import{S as W}from"./separator-CJDHCAA2.js";import{u as $}from"./useScheduleIncharge-B6xEjBmq.js";import"./axios-DmypytPv.js";import"./headlessui-DXpdh5LM.js";import"./tslib.es6-CRos2fHm.js";const D=A().shape({vehicleType:o().required("Vehicle Type is required"),vehicleNumber:o().required("Vehicle Number is required"),date:o().required("Date is required"),inTime:o().required("In Time is required")});function ce(){var f;const k=I(),h=P({}),r=$(),{user:n}=C(),[m]=c.useState(),[O,x]=c.useState(!1),[U,S]=c.useState(null),a=L({defaultValues:{vehicleType:"",vehicleNumber:"",date:p().format("YYYY-MM-DD"),inTime:p().format("HH:mm")},resolver:B(D)}),{handleSubmit:V}=a,q=async t=>{var l,s,g,v,y,w,j,b,T,N,_;if(await E("Are you sure you want to book ticket?",{title:"Please Confirm",subTitle:"You will be redirected to receipt page",buttonTitle:"Yes, I am sure"}))try{const i=await h.mutateAsync({api:(l=H)==null?void 0:l.bookTicket,data:{vehicle_no:t.vehicleNumber.toUpperCase(),vehicle_type:t.vehicleType,type_parking_space:"Organized",incharge_id:n==null?void 0:n.emp_id,area_id:(v=(g=(s=r==null?void 0:r.data)==null?void 0:s.data)==null?void 0:g.data[0])==null?void 0:v.location_id,in_time:p().format("HH:mm"),scheduler_id:(j=(w=(y=r==null?void 0:r.data)==null?void 0:y.data)==null?void 0:w.data[0])==null?void 0:j.scheduler_id}});(b=i==null?void 0:i.data)!=null&&b.success?(d.success("Ticket Booked Successfully"),k(`/parking-app/in-receipt?receipt_no=${(N=(T=i==null?void 0:i.data)==null?void 0:T.data)==null?void 0:N.receipt_no}`,{replace:!0})):d.error((_=i==null?void 0:i.data)==null?void 0:_.message)}catch{d.error("Something went wrong")}},F=async()=>{x(!0),S(null);const t=await z.createWorker({});await t.load(),await t.loadLanguage("eng"),await t.initialize("eng");const{data:{text:l}}=await t.recognize(m),s=l.split(`
`);a.setValue("vehicleNumber",s&&s.length>0?s[0].trim():""),await t.terminate(),x(!1)};return c.useEffect(()=>{m&&F()},[m]),e.jsx(Y,{title:"Home",children:e.jsx("div",{className:"py-8 mx-auto px-4",children:e.jsx("div",{children:e.jsx("div",{className:"px-8",children:e.jsxs(M,{methods:a,onSubmit:V(q),children:[e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex justify-between items-center gap-6",children:[e.jsxs("div",{className:"flex justify-center items-center gap-1 ",children:[e.jsx("input",{type:"radio",id:"two_wheeler",name:"vehicleType",value:"two_wheeler",className:"w-4 h-4",onChange:t=>a.setValue("vehicleType",t.target.value),checked:a.watch("vehicleType")==="two_wheeler"}),e.jsx("label",{htmlFor:"two_wheeler",className:"text-gray-800 text-sm font-semibold",children:"Two Wheeler"})]}),e.jsxs("div",{className:"flex justify-center items-center gap-1 ",children:[e.jsx("input",{type:"radio",id:"four_wheeler",name:"vehicleType",value:"four_wheeler",className:"w-4 h-4",onChange:t=>a.setValue("vehicleType",t.target.value),checked:a.watch("vehicleType")==="four_wheeler"}),e.jsx("label",{htmlFor:"four_wheeler",className:"text-gray-800 text-sm font-semibold",children:"Four Wheeler"})]})]}),(a==null?void 0:a.formState.errors.vehicleType)&&!(a!=null&&a.watch("vehicleType"))&&e.jsx("small",{className:"text-red-500 text-xs flex justify-center mt-2",children:(f=a==null?void 0:a.formState.errors.vehicleType)==null?void 0:f.message})]}),e.jsx("div",{className:"py-3",children:e.jsx(W,{})}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 w-full",children:[e.jsx("div",{children:e.jsx(u,{type:"text",className:"w-full h-10 border border-gray-300 rounded-lg uppercase",name:"vehicleNumber",label:"Vehicle Number",placeholder:"Enter Vehicle Number",inputValidation:["removeSpace","vehicleNumber"]})}),e.jsx("div",{children:e.jsx(u,{disabled:!0,name:"date",label:"Date",type:"date",placeholder:"Enter Date"})}),e.jsx("div",{children:e.jsx(u,{disabled:!0,name:"inTime",type:"time",label:"In Time",placeholder:"Enter In Time"})}),e.jsx("div",{className:"flex justify-center w-full mt-4",children:e.jsx(R,{isLoading:h.isPending,type:"submit",size:"sm",className:"w-full",children:"Book Ticket"})})]})]})})})})})}export{ce as default};
