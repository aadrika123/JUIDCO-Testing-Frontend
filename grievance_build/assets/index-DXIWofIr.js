import{N as ge,u as pe,r,b as Z,o as ee,s as Q,g as N,j as e,F as se,t as ae,v as re,H as te,w as le,S as ce,x as de,O as fe,y as D,c as ne,d as R,k as oe,P as ie,_ as A,z as be,D as Ne,J as ye,B as Me,G as O,Q as we}from"./index-x5K3To9x.js";import{P as ke}from"./index-C7uy_qK7.js";import{T as me,a as he,b as G,c as m,d as xe,e as h}from"./table-BluvXNrN.js";import{g as ve}from"./services-KQnp_8oA.js";import{P as ue}from"./index-DXjZiuuV.js";import{S as je}from"./index-CilwjrtQ.js";import{D as Pe}from"./index-No3c8H-W.js";import"./pagination-0EZmWsrI.js";/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=ge("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Re=ne().shape({ulbId:R().required("ulb is required"),moduleId:R().required("Module  is required"),workFlowName:R().required("workFlow Name is required"),parentId:R().notRequired(),levelSerial:R().notRequired()});function Ae({open:x,setOpen:n,title:k,edit:y,setEdit:F,refetch:p}){var s,d,V,W,U,L,q,C,B,T,_;const v=pe({}),[f,M]=r.useState(1),[t,o]=r.useState(10),[P,I]=r.useState("");let u=new URLSearchParams(oe().search).get("parentId");const j=Z({resolver:ee(Re)}),c=async()=>{},a=Q({api:`${N.getAllUser}?page=${f}&limit=${t}&q=${P}`,key:"getAllUserData",value:[f,t],options:{enabled:!0}}),w=i=>{ie("Are you sure ?","Please confirm",async()=>{var Y,E;const g=await v.mutateAsync({api:N.createWFUserMapping,data:{workflowId:u,userId:i}});(Y=g.data)!=null&&Y.success?(p(),A.success((E=g==null?void 0:g.data)==null?void 0:E.message)):A.error("workflow user not created successfully")}),n(!1)};return e.jsx(Pe,{open:x,setOpen:n,title:k,setEdit:F,edit:y,isLoading:a==null?void 0:a.isFetching,children:e.jsx(se,{methods:j,onSubmit:j.handleSubmit(c),children:e.jsx("div",{className:"grid gap-x-2 gap-y-4",children:e.jsxs(ae,{children:[e.jsx("div",{className:"mx-5 p-2",children:e.jsx(je,{search:P,setPage:M,setSearch:I,refetch:a.refetch,isFetching:a.isLoading})}),e.jsx(re,{className:"px-7",children:e.jsxs(te,{children:["Workflow Member List (",(d=(s=a.data)==null?void 0:s.data)==null?void 0:d.totalDocs,")"]})}),e.jsx(le,{children:a.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(ce,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(me,{children:[e.jsx(he,{children:e.jsxs(G,{children:[e.jsx(m,{className:"",children:"#"}),e.jsx(m,{className:"",children:"User Name"}),e.jsx(m,{className:"",children:"Role"}),e.jsx(m,{className:"",children:"Created at"}),e.jsx(m,{children:"Action"})]})}),e.jsx(xe,{children:(U=(W=(V=a==null?void 0:a.data)==null?void 0:V.data)==null?void 0:W.docs)==null?void 0:U.map((i,g)=>e.jsxs(G,{children:[e.jsx(h,{children:g+1}),e.jsx(h,{children:i.fullName}),e.jsx(h,{children:i.role}),e.jsx(h,{children:de(i.createdAt).format("DD-MM-YYYY")}),e.jsx(h,{className:"",children:e.jsx(fe,{className:"bg-primary ",onClick:()=>w(i._id),children:"Add Member"})})]},i._id))})]}),e.jsx(D,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(ue,{page:f,perPage:t,totalPage:(q=(L=a==null?void 0:a.data)==null?void 0:L.data)==null?void 0:q.totalDocs,hasNextPage:(B=(C=a==null?void 0:a.data)==null?void 0:C.data)==null?void 0:B.hasNextPage,hasPrevPage:(_=(T=a==null?void 0:a.data)==null?void 0:T.data)==null?void 0:_.hasPrevPage,setPage:M,setPerPage:o})})]})})]})})})})}const Fe=ne().shape({roleName:R().required("Role Name is required")});function Ie({open:x,setOpen:n,title:k,id:y,wrkId:F,edit:p,setEdit:v,refetch:f}){var S,$,u,j;const M=be({}),{data:t}=Q({api:`${N.getWFUserMappingById}/${F}`,key:"getWFUserMappingById",options:{enabled:p}}),o=Z({defaultValues:{roleName:((S=t==null?void 0:t.data)==null?void 0:S._id)||""},resolver:ee(Fe)}),P=async c=>{var a,w;try{const s=await M.mutateAsync({api:`${N.updateWFUserAndMemberMapping}/${y}`,data:{workflowUserMappingId:y,workflowRoleId:c==null?void 0:c.roleName}});(a=s.data)!=null&&a.success?A.success((w=s==null?void 0:s.data)==null?void 0:w.message):A.error("Member Role not updated successfully"),n(!1),v(!1),f()}catch(s){console.log(s)}};r.useEffect(()=>{var c;p?o.reset({roleName:(c=t==null?void 0:t.data)==null?void 0:c._id}):o.reset({roleName:""})},[p,t]);const I=Q({api:`${N.getAllWorkFlowRole}?page=1&limit=1000`,key:"getAllWorkFlowRole",options:{enabled:!0}});return e.jsx(Ne,{open:x,setOpen:n,title:k,setEdit:v,edit:p,children:e.jsx(se,{methods:o,onSubmit:o.handleSubmit(P),children:e.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[e.jsx("div",{children:e.jsx(ye,{name:"roleName",data:((j=(u=($=I.data)==null?void 0:$.data)==null?void 0:u.docs)==null?void 0:j.map(c=>({value:c._id,label:c.workFlowRoleName})))??[]})}),e.jsx(D,{}),e.jsx("div",{children:e.jsx(Me,{isLoading:o.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}function $e(x){var W,U,L,q,C,B,T,_,i,g,Y,E,J,K,X;const[n,k]=r.useState(1),[y,F]=r.useState(10),[p,v]=r.useState(""),[f,M]=r.useState(!1),[t,o]=r.useState(!1),[P,I]=r.useState(""),[S,$]=r.useState(""),[u,j]=r.useState(!1),w=new URLSearchParams(oe().search).get("parentId"),s=Q({api:`${N.getAllWFUserMapping}?workflowId=${w}`,key:"getAllWFUserMapping",value:[n,y,w],options:{enabled:!0}}),d=Q({api:`${N.checkGeneralActions}`,key:"generalActionPermission",options:{enabled:!0}});r.useEffect(()=>{x==null||x.settitle()},[]);const V=l=>{ie("Are you sure ?","Please confirm",async()=>{var z;we.delete(`${(z=N)==null?void 0:z.deleteWFUserMapping}/${l}`).then(b=>{var H;A.success((H=b==null?void 0:b.data)==null?void 0:H.message),s.refetch()}).catch(b=>{A.error(ve(b))})})};return e.jsxs("main",{className:"grid items-start",children:[f&&e.jsx(Ae,{open:f,setOpen:M,title:u?"Edit Workflow Member":"Add Workflow Member",id:S,edit:u,setEdit:j,refetch:s.refetch}),e.jsx(Ie,{open:t,setOpen:o,title:u?"Edit Workflow Member Role":"Add Workflow Member Role",id:S,wrkId:P,edit:u,setEdit:j,refetch:s.refetch}),e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[e.jsxs("div",{className:"flex w-full justify-between gap-2",children:[e.jsx("div",{children:e.jsx(je,{search:p,setPage:k,setSearch:v,refetch:s.refetch,isFetching:s.isLoading})}),((U=(W=d==null?void 0:d.data)==null?void 0:W.permission)==null?void 0:U.canModifyMembers)&&e.jsx("div",{children:e.jsx(O,{className:"flex items-center gap-2",onClick:()=>M(!0),children:"Add New"})})]}),e.jsxs(ae,{children:[e.jsx(re,{className:"px-7",children:e.jsxs(te,{children:["Workflow Member List (",(q=(L=s.data)==null?void 0:L.data)==null?void 0:q.totalDocs,")"]})}),e.jsx(le,{children:s.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(ce,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(me,{children:[e.jsx(he,{children:e.jsxs(G,{children:[e.jsx(m,{className:"",children:"#"}),e.jsx(m,{className:"",children:"Workflow Member"}),e.jsx(m,{className:"",children:"Role"}),((B=(C=d==null?void 0:d.data)==null?void 0:C.permission)==null?void 0:B.canModifyMembers)&&e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"",children:"Created at"}),e.jsx(m,{children:"Action"})]})]})}),e.jsx(xe,{children:(i=(_=(T=s==null?void 0:s.data)==null?void 0:T.data)==null?void 0:_.docs)==null?void 0:i.map((l,z)=>{var b,H;return e.jsxs(G,{children:[e.jsxs(h,{children:[z+1," "]}),e.jsx(h,{className:"font-semibold",children:l.UserName}),e.jsx(h,{children:l.workflowRoleName||"N/A"}),((H=(b=d==null?void 0:d.data)==null?void 0:b.permission)==null?void 0:H.canModifyMembers)&&e.jsxs(e.Fragment,{children:[e.jsx(h,{children:de(l.createdAt).format("DD-MM-YYYY")}),e.jsxs(h,{className:"space-x-5 ",children:[e.jsx(O,{type:"button",className:"",variant:"secondary",onClick:()=>{$(l._id),I(l==null?void 0:l.workflowRoleId),o(!0),j(!!l.workflowRoleId)},children:l.workflowRoleName?e.jsx("div",{children:" Update Member Role "}):e.jsx("div",{className:"ml-5",children:"Add Member Role"})}),e.jsx(O,{className:"bg-red-500 hover:bg-red-700  pt-2",onClick:()=>V(l._id),children:e.jsx(Se,{size:18})})]})]})]},l._id)})})]}),e.jsx(D,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(ue,{page:n,perPage:y,totalPage:(Y=(g=s==null?void 0:s.data)==null?void 0:g.data)==null?void 0:Y.totalDocs,hasNextPage:(J=(E=s==null?void 0:s.data)==null?void 0:E.data)==null?void 0:J.hasNextPage,hasPrevPage:(X=(K=s==null?void 0:s.data)==null?void 0:K.data)==null?void 0:X.hasPrevPage,setPage:k,setPerPage:F})})]})})]})]})]})}function Ye(){const[x,n]=r.useState("Workflow Member List");return e.jsx(ke,{title:x||"Workflow Member List",subTitle:"Manage all the work Flow List here",children:e.jsx("div",{className:"py-12",children:e.jsx($e,{settitle:n})})})}export{Ye as default};
