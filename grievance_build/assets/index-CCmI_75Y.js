import{r as d,a as Ce,u as $e,f as Ge,c as Me,d as c,M as Be,s as j,g as h,b as Pe,o as ze,T as Ue,U as Ve,V as qe,W as He,j as o,F as Je,X as Oe,Y as Ke,Z as Qe,$ as We,a0 as i,J as I,a1 as Xe,y as F,A as Ye,R as p,K as Ze,I as Ie,B as eo,k as oo,_ as k}from"./index-x5K3To9x.js";import{P as so}from"./index-C7uy_qK7.js";function lo(){var C,$,G,M,B,P,z,U,V,q,H,J,O,K,Q,W,X,Y,Z,ee,oe,se,le,re,ne,ie,ce,pe,ae,de;const[fe,we]=d.useState(!1),[R,ve]=d.useState(""),[_,ye]=d.useState(""),[m,ro]=d.useState({}),[f,Te]=d.useState(""),[Le,Ae]=d.useState(!1),[Se,Fe]=d.useState(!1),{user:n}=Ce(),ke=$e({}),E=Ge(),N=new URLSearchParams(oo().search).get("complaintId");console.log(f,"newRole");const Re=Me().shape({ulbId:c().required("ULB  is required"),moduleId:c(),citizenName:c(),mobileNo:c(),email:c(),complaintTypeId:c(),priorityId:c(),targetTypeId:c(),complaintTitle:c(),complaintDescription:c().required("complaint description is required"),complaintDocument:Be().nullable(),tempNo:c(),fixedNo:c(),isTransactionIssue:c(),transactionNo:c(),extraInfo:c(),extraBasicInfo:c()}),{data:s,refetch:_e}=j({api:`${(C=h)==null?void 0:C.getComplaintDetailsById}/${N}`,key:"getApplicationDetails",options:{enabled:!!N}}),l=Pe({resolver:ze(Re),defaultValues:{ulbId:(n==null?void 0:n.roleId)===Ue||(n==null?void 0:n.roleId)===Ve||(n==null?void 0:n.roleId)===qe||(n==null?void 0:n.roleId)===He?"":n==null?void 0:n.userUlbId,moduleName:""}}),Ee=async e=>{var b,g,t,u,w,v;if(console.log(e.mobileNo,"234"),console.log(f,"234"),(f==="Telecaller"||f==="State Jsk/Ivr/Calling")&&!e.mobileNo)return k.error("Please add a mobile number before proceeding.");try{const r=new FormData;r.append("citizenName",(e==null?void 0:e.citizenName)||""),r.append("email",(e==null?void 0:e.email)||""),r.append("mobileNo",(e==null?void 0:e.mobileNo)||""),r.append("complaintTitle",(e==null?void 0:e.complaintTitle)||""),r.append("complaintDescription",e==null?void 0:e.complaintDescription),r.append("ulbName",e==null?void 0:e.ulbName),e!=null&&e.moduleId&&r.append("moduleId",e==null?void 0:e.moduleId),r.append("ulbId",e==null?void 0:e.ulbId),r.append("imageUrl",e==null?void 0:e.complaintDocument),(e==null?void 0:e.tempNo)!==""&&(e==null?void 0:e.tempNo)!==void 0&&r.append("tempNo",e==null?void 0:e.tempNo),(e==null?void 0:e.fixedNo)!==""&&(e==null?void 0:e.fixedNo)!==void 0&&r.append("fixedNo",e==null?void 0:e.fixedNo),(e==null?void 0:e.tempNoLabel)!==""&&(e==null?void 0:e.tempNoLabel)!==void 0&&r.append("tempNoLabel",e==null?void 0:e.tempNoLabel),(e==null?void 0:e.fixedNoLabel)!==""&&(e==null?void 0:e.fixedNoLabel)!==void 0&&r.append("fixedNoLabel",e==null?void 0:e.fixedNoLabel),e!=null&&e.complaintTypeId&&r.append("complaintTypeId",e==null?void 0:e.complaintTypeId),e!=null&&e.priorityId&&r.append("priorityId",e==null?void 0:e.priorityId),e!=null&&e.targetTypeId&&r.append("targetTypeId",e==null?void 0:e.targetTypeId),r.append("isCitizen","2"),r.append("moduleName",(e==null?void 0:e.moduleName)||""),(m==null?void 0:m.problemTypeId)!==""&&(m==null?void 0:m.problemTypeId)!==void 0&&r.append("problemTypeId",m==null?void 0:m.problemTypeId),r.append("wardNo",(e==null?void 0:e.wardNo)||""),r.append("area",(e==null?void 0:e.area)||""),r.append("latitude",(e==null?void 0:e.latitude)||""),r.append("longitude",(e==null?void 0:e.longitude)||""),r.append("holdingNo",(e==null?void 0:e.holdingNo)||""),r.append("safNo",(e==null?void 0:e.safNo)||""),r.append("consumerNo",(e==null?void 0:e.consumerNo)||""),r.append("grievanceLocation",(e==null?void 0:e.grievanceLocation)||"");let y=h.createComplaintApplication;N&&(r.append("id",N),y=h.updateComplaintApplication);const a=await ke.mutateAsync({api:y,data:r});if((b=a.data)!=null&&b.success){if(k.success((g=a==null?void 0:a.data)==null?void 0:g.message),N)return _e(),E(`/grievance/dashboard/workflow-details?complaintId=${N}`);E(`/grievance/dashboard/management-complaint-success?complaintRefNo=${(u=(t=a==null?void 0:a.data)==null?void 0:t.data)==null?void 0:u.complaintRefNo}&complaintId=${(v=(w=a==null?void 0:a.data)==null?void 0:w.data)==null?void 0:v._id}`)}else k.error("Grievance not created successfully");l.reset({ulbId:"",moduleId:""})}catch(r){console.log(r)}};d.useEffect(()=>{var e,b,g,t,u,w,v,r,y,a,te,me,Ne,xe,ue,he,be,ge,je;N&&s?l.reset({ulbId:((e=s==null?void 0:s.data)==null?void 0:e.ulbId)||"",moduleId:((b=s==null?void 0:s.data)==null?void 0:b.moduleId)||"",fixedNo:((g=s==null?void 0:s.data)==null?void 0:g.fixedNo)||"",tempNo:((t=s==null?void 0:s.data)==null?void 0:t.tempNo)||"",citizenName:((u=s==null?void 0:s.data)==null?void 0:u.citizenName)||"",mobileNo:((w=s==null?void 0:s.data)==null?void 0:w.mobileNo)||"",email:((v=s==null?void 0:s.data)==null?void 0:v.email)||"",complaintTypeId:((r=s==null?void 0:s.data)==null?void 0:r.complaintTypeId)||"",priorityId:((y=s==null?void 0:s.data)==null?void 0:y.priorityId)||"",targetTypeId:((a=s==null?void 0:s.data)==null?void 0:a.targetTypeId)||"",complaintTitle:((te=s==null?void 0:s.data)==null?void 0:te.complaintTitle)||"",complaintDescription:((me=s==null?void 0:s.data)==null?void 0:me.complaintDescription)||"",problemTypeId:((Ne=s==null?void 0:s.data)==null?void 0:Ne.problemTypeId)||"",wardNo:((xe=s==null?void 0:s.data)==null?void 0:xe.wardNo)||"",area:((ue=s==null?void 0:s.data)==null?void 0:ue.area)||"",holdingNo:((he=s==null?void 0:s.data)==null?void 0:he.holdingNo)||"",safNo:((be=s==null?void 0:s.data)==null?void 0:be.safNo)||"",consumerNo:((ge=s==null?void 0:s.data)==null?void 0:ge.consumerNo)||"",grievanceLocation:((je=s==null?void 0:s.data)==null?void 0:je.grievanceLocation)||""}):(l.reset({ulbId:""}),l.reset({moduleId:""}),l.reset({citizenName:""}),l.reset({mobileNo:""}),l.reset({email:""}),l.reset({complaintTypeId:""}),l.reset({priorityId:""}),l.reset({targetTypeId:""}),l.reset({complaintTitle:""}),l.reset({complaintDescription:""}),l.reset({problemTypeId:""}),l.reset({wardNo:""}),l.reset({area:""}),l.reset({holdingNo:""}),l.reset({safNo:""}),l.reset({consumerNo:""}),l.reset({grievanceLocation:""}))},[N,s]);const x=j({api:`${($=h)==null?void 0:$.getAllUlbDirect}?page=1&limit=10000`,key:"getAllUlb",options:{enabled:!0}}),D=j({api:`${(G=h)==null?void 0:G.getAllModule}?page=1&limit=10000`,key:"geAllModules",options:{enabled:!0}}),T=j({api:`${(M=h)==null?void 0:M.getAllComplaintType}?page=1&limit=10000`,key:"getAllComplaintTypes",options:{enabled:!0}}),L=j({api:`${(B=h)==null?void 0:B.getAllPriority}?page=1&limit=10000`,key:"getAllPriority",options:{enabled:!0}}),A=j({api:`${(P=h)==null?void 0:P.getAllTarget}?page=1&limit=10000`,key:"getAllTargetTypes",options:{enabled:!0}}),De=j({api:`${h.getAllProblemDirect}?page=1&limit=10000`,key:"getProblemData",options:{enabled:!0,refetchOnMount:!1}}),S=[{wardNo:"1"},{wardNo:"2"},{wardNo:"3"},{wardNo:"4"},{wardNo:"5"},{wardNo:"6"},{wardNo:"7"},{wardNo:"8"},{wardNo:"9"},{wardNo:"10"},{wardNo:"11"},{wardNo:"12"},{wardNo:"13"},{wardNo:"14"},{wardNo:"15"},{wardNo:"16"},{wardNo:"17"},{wardNo:"18"},{wardNo:"19"},{wardNo:"20"},{wardNo:"21"},{wardNo:"22"},{wardNo:"23"},{wardNo:"24"},{wardNo:"25"},{wardNo:"26"},{wardNo:"27"},{wardNo:"28"},{wardNo:"29"},{wardNo:"30"},{wardNo:"31"},{wardNo:"32"},{wardNo:"33"},{wardNo:"34"},{wardNo:"35"},{wardNo:"36"},{wardNo:"37"},{wardNo:"38"},{wardNo:"39"},{wardNo:"40"},{wardNo:"41"},{wardNo:"42"},{wardNo:"43"},{wardNo:"44"},{wardNo:"45"},{wardNo:"46"},{wardNo:"47"},{wardNo:"48"},{wardNo:"49"},{wardNo:"50"}];return d.useEffect(()=>{var e,b,g;if(l.watch("moduleId")){const t=(g=(b=(e=D.data)==null?void 0:e.data)==null?void 0:b.docs)==null?void 0:g.find(u=>(u==null?void 0:u._id)===(l==null?void 0:l.watch("moduleId")));ye(t==null?void 0:t.fixedNoLabel),ve(t==null?void 0:t.tempNoLabel)}},[l.watch("moduleId")]),d.useEffect(()=>{Ae(l.watch("extraInfo"))},[l.watch("extraInfo")]),d.useEffect(()=>{Fe(l.watch("extraBasicInfo"))},[l.watch("extraBasicInfo")]),d.useEffect(()=>{we(l.watch("isTransactionIssue"))},[l.watch("isTransactionIssue")]),d.useEffect(()=>{Te(n==null?void 0:n.role)},[]),o.jsx(Je,{methods:l,onSubmit:l.handleSubmit(Ee),children:o.jsxs("div",{className:"grid grid-cols-4 gap-x-2 gap-y-4 bg-background p-10",children:[o.jsxs("div",{className:`${((n==null?void 0:n.roleId)===Oe||(n==null?void 0:n.roleId)===Ke||(n==null?void 0:n.roleId)===Qe||(n==null?void 0:n.roleId)===We)&&"hidden"}`,children:[o.jsxs(i,{htmlFor:"ulbId",children:[o.jsx("span",{className:"text-red-500",children:"*"}),"ULB"]}),o.jsx("div",{className:"",children:o.jsx(I,{className:"cursor-pointer bg-background",name:"ulbId",disabled:(n==null?void 0:n.roleId)===Xe,data:Array.isArray((z=x==null?void 0:x.data)==null?void 0:z.data)&&((V=(U=x==null?void 0:x.data)==null?void 0:U.data)==null?void 0:V.length)!==0?(H=(q=x==null?void 0:x.data)==null?void 0:q.data)==null?void 0:H.map(e=>({value:e._id,label:e.ulbName})):[]})})]}),o.jsx("div",{className:"col-span-4"}),o.jsx("h1",{className:"text-xl font-bold uppercase text-blue-800",children:"Grievance Info"}),o.jsx(F,{className:"col-span-4"}),o.jsxs("div",{className:"col-span-3",children:[o.jsxs(i,{htmlFor:"complaintDescription",children:[o.jsx("span",{className:"text-red-500",children:"*"}),"Grievance Description"]}),o.jsx(Ye,{className:"h-20 w-full rounded-md border bg-background p-4",name:"complaintDescription",placeholder:"write Grievance"})]}),o.jsx("div",{className:"col-span-4"}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(p,{className:"h-5 w-5 cursor-pointer",type:"checkbox",name:"extraInfo",placeholder:""}),o.jsx(i,{className:"text-amber-600 opacity-80",children:"Give More Information"})]}),o.jsx("div",{className:"col-span-4"}),Le&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{children:[o.jsx(i,{children:"Grievance Location"}),o.jsx(p,{name:"grievanceLocation",inputValidation:["CapitalFirstLetter","removeDoubleSpace","string"],placeholder:""})]}),o.jsxs("div",{children:[o.jsx(i,{children:"Grievance Type"}),o.jsx(I,{selectedText:"problem",className:"cursor-pointer bg-background",name:"problemTypeId",data:((K=(O=(J=De.data)==null?void 0:J.data)==null?void 0:O.docs)==null?void 0:K.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.problem})))??[]})]}),o.jsxs("div",{children:[o.jsx(i,{htmlFor:"moduleId",children:"Module"}),o.jsx(I,{selectedText:"moduleName",className:"cursor-pointer bg-background",name:"moduleId",data:((X=(W=(Q=D.data)==null?void 0:Q.data)==null?void 0:W.docs)==null?void 0:X.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.moduleName})))??[]})]}),_&&o.jsxs("div",{children:[o.jsxs(i,{children:[_,o.jsx("span",{className:"text-xs opacity-80"})]}),o.jsx(p,{name:"fixedNo",placeholder:""})]}),R&&o.jsxs("div",{children:[o.jsxs(i,{children:[R,o.jsx("span",{className:"text-xs opacity-80"})]}),o.jsx(p,{name:"tempNo",placeholder:""})]}),o.jsxs("div",{children:[o.jsx(i,{htmlFor:"complaintTypeId",children:"Grievance Type"}),o.jsx(I,{className:"cursor-pointer bg-background",name:"complaintTypeId",data:((ee=(Z=(Y=T==null?void 0:T.data)==null?void 0:Y.data)==null?void 0:Z.docs)==null?void 0:ee.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.complaintTypeName})))??[]})]}),o.jsxs("div",{children:[o.jsx(i,{htmlFor:"priorityId",children:"Priority"}),o.jsx(I,{className:"cursor-pointer bg-background",name:"priorityId",data:((le=(se=(oe=L==null?void 0:L.data)==null?void 0:oe.data)==null?void 0:se.docs)==null?void 0:le.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.priorityName})))??[]})]}),o.jsxs("div",{children:[o.jsx(i,{htmlFor:"targetTypeId",children:"Target Type"}),o.jsx(I,{className:"cursor-pointer bg-background",name:"targetTypeId",data:((ie=(ne=(re=A==null?void 0:A.data)==null?void 0:re.data)==null?void 0:ne.docs)==null?void 0:ie.map(e=>({value:e._id,label:e==null?void 0:e.targetType})))??[]})]}),o.jsxs("div",{className:"col-span-2 flex",children:[o.jsxs("div",{children:[o.jsxs(i,{children:["Grievance Document",o.jsx("span",{className:"text-xs opacity-80",children:"(acceptable formats are jpg, jpeg, png, pdf)"})]}),o.jsx(Ze,{className:"cursor-pointer",accept:"image/jpeg,image/jpg,image/png,application/pdf",name:"complaintDocument",placeholder:"Select document"})]}),o.jsxs("div",{className:"",children:[(((ce=l.watch("complaintDocument"))==null?void 0:ce.type)=="image/png"||((pe=l.watch("complaintDocument"))==null?void 0:pe.type)=="image/jpg"||((ae=l.watch("complaintDocument"))==null?void 0:ae.type)=="image/jpeg")&&o.jsx(Ie,{className:"w-28",src:URL.createObjectURL(l.watch("complaintDocument"))}),((de=l.watch("complaintDocument"))==null?void 0:de.type)=="application/pdf"&&o.jsx(Ie,{className:"w-16 cursor-pointer hover:scale-105",src:"/images/pdf.png"})]})]})]}),o.jsx("div",{className:"col-span-4"}),o.jsx("h1",{className:"text-xl font-bold uppercase text-blue-800",children:"Basic Info"}),o.jsx(F,{className:"col-span-4"}),o.jsxs("div",{children:[o.jsx(i,{htmlFor:"citizenName",children:"Citizen Name"}),o.jsx(p,{className:"bg-background",name:"citizenName",inputValidation:["CapitalFirstLetter","removeDoubleSpace","string"],placeholder:""})]}),o.jsxs("div",{children:[o.jsxs(i,{children:[(f==="Telecaller"||f==="State Jsk/Ivr/Calling")&&o.jsx("span",{className:"text-red-500",children:"*"})," Mobile No."]}),o.jsx(p,{name:"mobileNo",inputValidation:["mobile","number"],placeholder:""})]}),o.jsx("div",{className:"col-span-4"}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(p,{className:"h-5 w-5 cursor-pointer",type:"checkbox",name:"extraBasicInfo",placeholder:""}),o.jsx(i,{className:"text-amber-600 opacity-80",children:"Give More Information"})]}),o.jsx("div",{className:"col-span-4"}),Se&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{children:[o.jsx(i,{children:"Email"}),o.jsx(p,{inputValidation:["email"],name:"email",placeholder:""})]}),o.jsxs("div",{children:[o.jsx(i,{children:"Ward"}),o.jsx(I,{selectedText:"ward",className:"cursor-pointer bg-background",name:"wardNo",data:(S==null?void 0:S.map(e=>({value:e==null?void 0:e.wardNo,label:e==null?void 0:e.wardNo})))??[]})]}),o.jsxs("div",{children:[o.jsx(i,{children:"Area"}),o.jsx(p,{name:"area",inputValidation:["CapitalFirstLetter","removeDoubleSpace"],placeholder:""})]}),o.jsxs("div",{children:[o.jsx(i,{children:"Holding No."}),o.jsx(p,{name:"holdingNo",maxLength:20,placeholder:""})]}),o.jsxs("div",{children:[o.jsx(i,{children:"Saf No."}),o.jsx(p,{name:"safNo",maxLength:20,placeholder:""})]}),o.jsxs("div",{children:[o.jsx(i,{children:"Consumer No."}),o.jsx(p,{name:"consumerNo",maxLength:20,placeholder:""})]})]}),o.jsx("div",{className:"col-span-4"}),o.jsx("h1",{className:"text-xl font-bold uppercase text-blue-800",children:"Financial Info"}),o.jsx(F,{className:"col-span-4"}),o.jsxs("div",{className:"col-span-2  flex items-center space-x-2",children:[o.jsx(p,{className:"h-5 w-5 cursor-pointer",type:"checkbox",name:"isTransactionIssue",placeholder:""}),o.jsx(i,{className:"text-amber-600 opacity-80",children:"Is issue related with financial transaction"})]}),o.jsx("div",{className:"col-span-4"}),fe&&o.jsxs("div",{children:[o.jsx(i,{children:"Transaction No."}),o.jsx(p,{name:"transactionNo",placeholder:""})]}),o.jsx("div",{className:"col-span-4"}),o.jsx("div",{className:"col-span-4",children:o.jsx(eo,{isLoading:l.formState.isSubmitting,type:"submit",className:" float-right w-auto rounded-xl px-10",children:N?"Update":"Submit"})})]})})}function ao(){return o.jsx(so,{title:"Grievance Details",subTitle:"Grievance Registration Form",children:o.jsx("div",{className:"",children:o.jsx(lo,{})})})}export{ao as default};
