import{u as ee,r as l,b as te,S as b,a8 as L,A as y,e as m,R as ae,j as t,B as ne,aa as re,ab as ce,ai as w,c as P,du as se,a as de,g as oe}from"./index-21aade66.js";import{B as le}from"./BottomErrorCard-c4e8289a.js";import{u as ie}from"./useErrorAutoFocusField-39db6dc1.js";let pe=P().shape({attendance:se().of(P().shape({description:de().when("attendanceStatus",{is:i=>i=="2",then:i=>i.required("Description is required").min(3,"Must be at least 3 characters").max(100,"Must be at most 100 characters"),otherwise:i=>i.notRequired()})}))});function Ne(){var C,I,A,$,E,F,Y,B;ee();const{AutoFocusErrorField:i}=ie(),{api_retrieve_all_student:xe,api_getactiveClassData:q,api_getSectionData:ue,api_student_attendance:T,api_section_group_map:he,api_fetch_student_attendance:V}=oe(),[O,d]=l.useState(!1),[x,S]=l.useState([]),[J,z]=l.useState(!1),[H,U]=l.useState(null),[N,G]=l.useState([]),[fe,k]=l.useState([]),K=()=>{d(!0),y.post(q,{},m()).then(function(e){var a,r,s,f;console.log("Class Data..312312",(a=e==null?void 0:e.data)==null?void 0:a.data),(r=e==null?void 0:e.data)!=null&&r.status?G((s=e==null?void 0:e.data)==null?void 0:s.data):(h(!0,(f=e==null?void 0:e.data)==null?void 0:f.message),k([])),d(!1)}).catch(function(e){console.log("==2 error list...",e),h(!0,"Error occured while fetching data."),k([]),d(!1)})},Q=()=>{if(x){const e=x==null?void 0:x.map(a=>({studentId:a==null?void 0:a.id,admissionNo:a==null?void 0:a.admission_no,classId:a==null?void 0:a.class_id,sectionId:a==null?void 0:a.section_id,rollNo:a==null?void 0:a.roll_no,fullName:a==null?void 0:a.full_name,className:a==null?void 0:a.class_name,sectionName:a==null?void 0:a.section_name,attendanceStatus:"1",description:"",date:L().format("YYYY-MM-DD"),isCheck:!1}));g.setFieldValue("attendance",e)}},g=te({enableReinitialize:!0,initialValues:{class_id:"",section_id:"",attendance:[{studentId:"",admissionNo:"",classId:"",sectionId:"",rollNo:"",fullName:"",className:"",sectionName:"",attendanceStatus:"",description:"",date:""}]},validationSchema:pe,onSubmit:e=>{var f;if(console.log("values",e),(f=e==null?void 0:e.attendance)==null?void 0:f.some(c=>(c==null?void 0:c.attendanceStatus)=="")){b.fire({icon:"error",title:"Oops...",text:"Please select attendance present, absent or leave for all students!"});return}const s={attendance:e==null?void 0:e.attendance.map(c=>({studentId:c==null?void 0:c.studentId,admissionNo:c==null?void 0:c.admissionNo,classId:e==null?void 0:e.class_id,sectionId:e==null?void 0:e.section_id,attendanceStatus:parseInt(c==null?void 0:c.attendanceStatus),description:c==null?void 0:c.description,attendanceDate:c==null?void 0:c.date})),classId:parseInt(e==null?void 0:e.class_id),sectionId:parseInt(e==null?void 0:e.section_id),attendanceDate:L().format("YYYY-MM-DD")};b.fire({title:"Are you sure?",text:"You want to submit attendance!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, submit it!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(c=>{c.isConfirmed?(d(!0),y.post(T,{...s},m()).then(function(o){var M,R;console.log("Class Data..",o),((M=o==null?void 0:o.data)==null?void 0:M.status)==!0?(b.fire("Submitted!","Attendance has been submitted.","success"),g.resetForm()):h(!0,(R=o==null?void 0:o.data)==null?void 0:R.message),d(!1)}).catch(function(o){console.log("==2 error list...",o),h(!0,"Error occured while fetching data."),d(!1)})):c.dismiss===b.DismissReason.cancel&&b.fire("Cancelled","Your form data is safe :)","error")})}}),{values:n,handleSubmit:W,getFieldProps:X,setFieldValue:p,errors:u,touched:j,isValid:Z,isSubmitting:_,submitCount:D}=g,v=()=>{d(!0),y.post(V,{classId:n==null?void 0:n.class_id,id:n==null?void 0:n.section_id},m()).then(function(e){var a,r,s;console.log("Student Data..Atten",(a=e==null?void 0:e.data)==null?void 0:a.data),(r=e==null?void 0:e.data)!=null&&r.status?S((s=e==null?void 0:e.data)==null?void 0:s.data):S([]),d(!1)}).catch(function(e){console.log("==2 error list...",e),h(!0,"Error occured while fetching data."),d(!1)})};l.useEffect(()=>{K()},[]),l.useEffect(()=>{n!=null&&n.class_id&&v()},[n==null?void 0:n.class_id]),l.useEffect(()=>{x&&Q()},[x]);const h=(e,a)=>{U(a),z(e)};return ae.useEffect(()=>{i({isValid:Z,submitCount:D,isSubmitting:_,errors:u})},[u,D,_]),t.jsxs(t.Fragment,{children:[O&&t.jsx(ne,{}),J&&t.jsx(le,{activateBottomErrorCard:h,errorTitle:H}),t.jsx(re,{value:n,children:t.jsx(ce,{onSubmit:W,children:t.jsx("div",{className:"w-full col-span-10 2xl:py-3 2xl:px-6 px-6 py-2",children:t.jsxs("div",{className:"border-[2px] border-gray-200 rounded-md h-[82vh] 2xl:p-6 p-4 overflow-y-auto",children:[t.jsx("div",{className:"",children:t.jsxs("div",{className:"flex w-full justify-between items-center max-[870px]:block",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-3xl text-center font-semibold text-gray-600 flex flex-start",children:"Add Attendance"}),t.jsx("span",{className:"text-sm text-center font-medium text-teal-600",children:"Unlock Your Potential. Join Our Journey Of Education And Excellence"})]}),t.jsxs("div",{className:"flex gap-6 mt-4 md:mt-0 flex-col lg:flex-row",children:[t.jsx("input",{disabled:!0,type:"text",className:"mt-7 h-8 w-full lg:w-40 form-control block  px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md ",value:Date().toLocaleString().slice(0,15)}),t.jsxs("div",{className:"form-group  md:col-span-2 mb-6 md:px-4",children:[t.jsxs("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold",children:["Class",t.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),t.jsxs("select",{className:"form-control block w-full lg:w-40 px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",...X("class_id"),children:[t.jsx("option",{value:"",children:"Select"}),N==null?void 0:N.map(e=>t.jsx("option",{value:e==null?void 0:e.id,children:e==null?void 0:e.class_name}))]}),t.jsx("span",{className:"text-red-600 text-xs",children:j.class_id&&u.class_id?u.class_id:null})]})]})]})}),((C=n==null?void 0:n.attendance)==null?void 0:C.length)>0?t.jsx("div",{className:"flex flex-col",children:t.jsx("div",{className:"overflow-x-auto sm:-mx-6 lg:-mx-8",children:t.jsx("div",{className:"inline-block min-w-full py-2 sm:px-6 lg:px-8",children:t.jsxs("div",{className:"overflow-hidden",children:[t.jsxs("table",{className:"min-w-full border text-center text-sm font-light dark:border-neutral-500",children:[t.jsx("thead",{className:"border-b font-medium dark:border-neutral-500",children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 font-medium dark:border-neutral-500",children:"sl.no"}),t.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:"Admission no"}),t.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:"Class"}),t.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:"Roll No"}),t.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:"Full name"}),t.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:t.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Present",t.jsx("input",{type:"checkbox",className:"h-[18px] w-[18px]",onChange:e=>{var r;const a=(r=n==null?void 0:n.attendance)==null?void 0:r.map(s=>({...s,attendanceStatus:e.target.checked?"1":""}));p("attendance",a)},checked:((I=n==null?void 0:n.attendance)==null?void 0:I.filter(e=>(e==null?void 0:e.attendanceStatus)=="1").length)===((A=n==null?void 0:n.attendance)==null?void 0:A.length)})]})}),t.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:t.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Absent",t.jsx("input",{type:"checkbox",className:"h-[18px] w-[18px]",onChange:e=>{var r;const a=(r=n==null?void 0:n.attendance)==null?void 0:r.map(s=>({...s,attendanceStatus:e.target.checked?"0":""}));p("attendance",a)},checked:(($=n==null?void 0:n.attendance)==null?void 0:$.filter(e=>(e==null?void 0:e.attendanceStatus)=="0").length)===((E=n==null?void 0:n.attendance)==null?void 0:E.length)})]})}),t.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:t.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Leave",t.jsx("input",{type:"checkbox",className:"h-[18px] w-[18px]",onChange:e=>{var r;const a=(r=n==null?void 0:n.attendance)==null?void 0:r.map(s=>({...s,attendanceStatus:e.target.checked?"2":""}));p("attendance",a)},checked:((F=n==null?void 0:n.attendance)==null?void 0:F.filter(e=>(e==null?void 0:e.attendanceStatus)==="2").length)===((Y=n==null?void 0:n.attendance)==null?void 0:Y.length)})]})}),t.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-4 py-4 dark:border-neutral-500",children:"Description"})]})}),t.jsx("tbody",{children:(B=n==null?void 0:n.attendance)==null?void 0:B.map((e,a)=>t.jsxs("tr",{className:"border-b dark:border-neutral-500",children:[t.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 font-medium dark:border-neutral-500",children:a+1}),t.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:(e==null?void 0:e.admissionNo)||"N/A"}),t.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:e==null?void 0:e.className}),t.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:e==null?void 0:e.rollNo}),t.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:e==null?void 0:e.fullName}),t.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:t.jsx("input",{className:"h-[18px] w-[18px]  ",type:"checkbox",value:"1",name:`attendance[${a}].attendanceStatus`,onChange:r=>{p(`attendance[${a}].attendanceStatus`,r.target.value)},checked:(e==null?void 0:e.attendanceStatus)=="1"})}),t.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:t.jsx("input",{className:"h-[18px] w-[18px]",type:"checkbox",value:"0",name:`attendance[${a}].attendanceStatus`,onChange:r=>{p(`attendance[${a}].attendanceStatus`,r.target.value)},checked:(e==null?void 0:e.attendanceStatus)=="0"})}),t.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:t.jsx("input",{className:"h-[18px] w-[18px]",type:"checkbox",value:"2",name:`attendance[${a}].attendanceStatus`,onChange:r=>{p(`attendance[${a}].attendanceStatus`,r.target.value)},checked:(e==null?void 0:e.attendanceStatus)=="2"})}),t.jsxs("td",{className:"whitespace-nowrap border-r px-4 py-4 dark:border-neutral-500",children:[t.jsx("input",{disabled:(e==null?void 0:e.attendanceStatus)=="1"||(e==null?void 0:e.attendanceStatus)=="0",type:"text",className:`form-control block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid ${w(j,`attendance[${a}].description`)&&w(u,`attendance[${a}].description`)?"border-red-300 bg-red-50":"border-gray-300 bg-white"} rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 `,name:`attendance[${a}].description`,onChange:r=>{p(`attendance[${a}].description`,r.target.value),(`attendance[${a}].attendanceStatus`=="1"||`attendance[${a}].attendanceStatus`=="0")&&g.setTouched({[`attendance[${a}].description`]:!0})},value:e==null?void 0:e.description}),t.jsx("h1",{className:"text-red-500 text-[11px]",children:w(j,`attendance[${a}].description`)&&w(u,`attendance[${a}].description`)})]})]}))})]}),t.jsx("div",{className:"flex justify-end w-full gap-4 mt-4",children:t.jsx("button",{type:"submit",className:"bg-[#0F766E] text- text-white px-4 py-2 rounded-md mt-4",children:"Submit"})})]})})})}):t.jsx("h1",{className:"text-gray-600 text-center mt-56 text-2xl",children:"No Data Found! please select class and section"})]})})})})]})}export{Ne as default};
