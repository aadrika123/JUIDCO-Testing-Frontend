import{r as o,u as W,O as X,c as Z,a as p,b as ee,j as s,B as se,A as d,e as m,o as w,g as te}from"./index-21aade66.js";import{B as le}from"./BottomErrorCard-c4e8289a.js";import{T as ae}from"./Tabs-65330aff.js";function ue(){const[I,M]=o.useState(!1),[E,F]=o.useState(null),[S,i]=o.useState(!1),[x,_]=o.useState([]),[f,C]=o.useState([]);o.useState([]);const[b,A]=o.useState([]);o.useState([]);const[j,T]=o.useState(),[re,P]=o.useState(),[g,L]=o.useState(),{api_getActiveExamTermData:V,api_getactiveClassData:B,api_finance_year:O,api_section_group_map:oe,api_markstabulationCrudStore:D,api_getMarksEntryData:ie,api_marksEntrySection:y,api_subject_map:ce}=te(),h=W(),{id:N}=X(),$=Z({classId:p().required("Select Class"),termId:p().required("Select Term"),admissionNo:p().required("Enter admission no")}),t=ee({initialValues:{classId:"",sectionId:"",termId:"",admissionNo:"",isMainSubject:!0,isOptionalSubject:!1,fullMarks:"",passMarks:"",totalMarks:0,totalObtainedMarks:0,percentage:0,marks:[]},onSubmit:(e,l)=>{console.log("at submit ",e),q(e)},validationSchema:$}),q=e=>{console.log("wow",e),i(!0);let l,r,n={admissionNo:e==null?void 0:e.admissionNo,tabulation:e.marks.map(a=>({fy:a==null?void 0:a.fy_name,admissionNo:a==null?void 0:a.admissionNo,termId:a==null?void 0:a.termId,classId:a==null?void 0:a.classId,sectionId:a==null?void 0:a.sectionId,marksEntryId:a==null?void 0:a.marks_entry_id,obtainedMarks:a==null?void 0:a.obtMarks}))};l=D,r=n,d.post(l,r,m()).then(function(a){var u,v,k;console.log("view discount group master..",(u=a==null?void 0:a.data)==null?void 0:u.data),(v=a==null?void 0:a.data)!=null&&v.status?h("/marks-tabulation"):c(!0,`${(k=a==null?void 0:a.data)==null?void 0:k.message}`),i(!1)}).catch(function(a){console.log("==2 error list...",a),c(!0,"Error occured in submitting form."),i(!1)})},R=()=>{i(!0),d.post(O,{},m()).then(function(e){e!=null&&e.data?(console.log(e==null?void 0:e.data),_(e==null?void 0:e.data)):c(!0,"Error occured while fetching data."),i(!1)}).catch(function(e){console.log("==2 error list...",e),c(!0,"Error occured while fetching data."),i(!1)})},J=()=>{i(!0),d.post(B,{},m()).then(function(e){e!=null&&e.data?(console.log(e==null?void 0:e.data),C(e==null?void 0:e.data.data)):c(!0,"Error occured while fetching data."),i(!1)}).catch(function(e){console.log("==2 error list...",e),c(!0,"Error occured while fetching data."),i(!1)})},U=e=>{i(!0),d.post(y,{classId:e},m()).then(function(l){var r,n;l!=null&&l.data?(console.log((r=l==null?void 0:l.data.data)==null?void 0:r.subject),t.setFieldValue("marks",(n=l==null?void 0:l.data)==null?void 0:n.data.map(a=>({...a,obtMarks:0,classId:t.values.classId,sectionId:t.values.sectionId,termId:t.values.termId,admissionNo:t.values.admissionNo})))):c(!0,"Error occured while fetching data."),i(!1)}).catch(function(l){console.log("==2 error list...",l),c(!0,"Error occured while fetching data."),i(!1)})},Y=()=>{i(!0),d.post(V,{},m()).then(function(e){e!=null&&e.data?(console.log(e==null?void 0:e.data),A(e==null?void 0:e.data.data)):c(!0,"Error occured while fetching data."),i(!1)}).catch(function(e){console.log("==2 error list...",e),c(!0,"Error occured while fetching data."),i(!1)})};console.log(t.values.fy);const G=()=>{i(!0),d.post(y,{classId:t.values.classId,sectionId:t.values.sectionId},m()).then(function(e){var l,r,n,a;(l=e==null?void 0:e.data)!=null&&l.status?(console.log((r=e==null?void 0:e.data)==null?void 0:r.data),t.setFieldValue("marks",(n=e==null?void 0:e.data)==null?void 0:n.data.map(u=>({...u,obtMarks:0,classId:t.values.classId,sectionId:t.values.sectionId,termId:t.values.termId,admissionNo:t.values.admissionNo})))):c(!0,`${(a=e==null?void 0:e.data)==null?void 0:a.message}`),i(!1)}).catch(function(e){console.log("==2 error list...",e),c(!0,"Error occured while fetching data.")})},H=()=>{let e=t.values.marks.reduce((l,r)=>l+(r==null?void 0:r.full_marks),0);T(e)},K=()=>{let e=t.values.marks.reduce((l,r)=>parseInt(l)+parseInt(r==null?void 0:r.obtMarks),0);console.log(e),L(e)},z=(e,l)=>{t.setFieldValue(`marks.${l}.obtMarks`,e),console.log(l,e,`marks.${l}.obtMarks`),P(l)};console.log(t.values.marks),o.useEffect(()=>{K()},[t.values.marks]),o.useEffect(()=>{H()},[t.values.marks]),o.useEffect(()=>{t.setFieldValue("totalMarks",j)},[j]),o.useEffect(()=>{R(),J(),Y()},[]),o.useEffect(()=>{t.values.classId&&U(t.values.classId)},[t.values.classId]),o.useEffect(()=>{t.values.classId&&t.values.sectionId&&G()},[t.values.classId,t.values.sectionId]),o.useEffect(()=>{let e=(g/t.values.totalMarks*100).toFixed(2);t.setFieldValue("percentage",e)},[g,t.values.totalMarks]);const Q=e=>{let l=e.target.name,r=e.target.value;l=="fullMarks"&&t.setFieldValue("fullMarks",w(r.trim(),t.values.fullMarks,3)),l=="passMarks"&&t.setFieldValue("passMarks",w(r.trim(),t.values.passMarks,3))},c=(e,l)=>{F(l),M(e)};return s.jsx(s.Fragment,{children:s.jsx("div",{className:"main-div",children:s.jsxs("div",{className:"main-inner-div",children:[S&&s.jsx(se,{}),I&&s.jsx(le,{activateBottomErrorCard:c,errorTitle:E}),s.jsxs("div",{className:"main-sub-div",children:[s.jsx("div",{className:"main-sub-inner-div",children:s.jsxs("div",{className:"text-div",children:[s.jsx("div",{className:"big-text",children:"Marks Tabulation Master Form"}),s.jsx("div",{className:"common-header-smalltext",children:"Unlock Your Potential. Join Our Journey Of Education And Excellence"})]})}),N===void 0?s.jsx("div",{className:"tab-div",children:s.jsx("div",{className:"add-button-master-div",children:s.jsxs("button",{onClick:()=>h("/marks-tabulation-form"),type:"submit",className:" add-button-master bg-[#0F766E] hover:[#0F766E]",children:["Add"," "]})})}):null]}),s.jsx(ae,{listRoute:"/marks-tabulation",formRoute:"/marks-tabulation-form"}),s.jsx("div",{className:"details-div",children:s.jsx("span",{className:"detailes text-[#0F766E]",children:"Marks Tabulation Form"})}),s.jsx("div",{className:"form-div",children:s.jsx("form",{onSubmit:t.handleSubmit,onChange:Q,children:s.jsxs("div",{className:"form",children:[s.jsxs("div",{className:"col-span-4 grid grid-cols-12",children:[s.jsxs("div",{className:"form-group mb-6 col-span-12 md:col-span-2 md:pr-4 relative",children:[s.jsxs("label",{className:"form-label inline-block mb-1 text-teal-900 text-sm font-semibold",children:["Financial Year",s.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),s.jsx("select",{...t.getFieldProps("fy"),type:"number",className:"form-control block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 h-10 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",placeholder:"Select class",children:x==null?void 0:x.map((e,l)=>s.jsx("option",{value:e==null?void 0:e.fy,children:e==null?void 0:e.fy}))}),s.jsx("span",{className:"text-red-600 absolute text-xs",children:t.touched.fy&&t.errors.fy?t.errors.fy:null})]}),s.jsxs("div",{className:"form-group mb-6 col-span-12 md:col-span-2 md:pr-4",children:[s.jsxs("label",{className:"form-label inline-block mb-1 text-teal-900 text-sm font-semibold",children:["Term",s.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),s.jsxs("select",{...t.getFieldProps("termId"),type:"text",className:"form-control bg-white h-10 block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",placeholder:"Select Discount Group",children:[s.jsx("option",{value:"",children:"Select"}),b==null?void 0:b.map((e,l)=>s.jsx("option",{value:e==null?void 0:e.id,children:e==null?void 0:e.term_name}))]}),s.jsx("span",{className:"text-red-600  text-xs",children:t.touched.termId&&t.errors.termId?t.errors.termId:null})]}),s.jsxs("div",{className:"form-group mb-6 col-span-12 md:col-span-2 md:pr-4",children:[s.jsxs("label",{className:"form-label inline-block mb-1 text-teal-900 text-sm font-semibold",children:["Class",s.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),s.jsxs("select",{...t.getFieldProps("classId"),type:"number",className:"form-control bg-white h-10 block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",placeholder:"Select Class",children:[s.jsx("option",{value:"",children:"Select"}),f==null?void 0:f.map((e,l)=>s.jsx("option",{value:e==null?void 0:e.id,children:e==null?void 0:e.class_name}))]}),s.jsx("span",{className:"text-red-600  text-xs",children:t.touched.classId&&t.errors.classId?t.errors.classId:null})]}),s.jsxs("div",{className:"form-group mb-6 col-span-12 md:col-span-2 md:pr-4",children:[s.jsxs("label",{className:"form-label inline-block mb-1 text-teal-900 text-sm font-semibold",children:["Admission no",s.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),s.jsx("input",{...t.getFieldProps("admissionNo"),type:"text",className:"form-control h-10 block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md",placeholder:"Enter admission no"}),s.jsx("span",{className:"text-red-600 text-xs",children:t.touched.admissionNo&&t.errors.admissionNo?t.errors.admissionNo:null})]})]}),t.values.classId!=""&&s.jsxs("div",{className:"col-span-12 mt-4 ",children:[s.jsx("div",{className:"overflow-x-auto shadow-lg border",children:s.jsxs("table",{className:"min-w-full divide-y divide-gray-200 max-[820px]:w-[820px]",children:[s.jsx("thead",{className:"bg-[#E7EFFC] ",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3  text-sm font-bold   tracking-wider",children:"Subject"}),s.jsx("th",{className:"px-6 py-3  text-sm font-bold   tracking-wider",children:"Full Marks"}),s.jsx("th",{className:"px-6 py-3  text-sm font-bold   tracking-wider",children:"Passing Marks"}),s.jsx("th",{className:"px-6 py-3  text-sm font-bold   tracking-wider",children:"Obtained Marks"})]})}),t.values.marks.map((e,l)=>s.jsx("tbody",{className:" divide-y divide-gray-200 ",children:s.jsxs("tr",{children:[s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e==null?void 0:e.subject_name}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e==null?void 0:e.full_marks}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e==null?void 0:e.pass_marks}),s.jsx("td",{className:"px-6 py-3 whitespace-nowrap",children:s.jsx("input",{...t.getFieldProps(`marks.${l}.obtMarks`),onChange:r=>z(r.target.value,l),onKeyDown:r=>["e","E","+","-"].includes(r.key)&&r.preventDefault(),className:"  text-center form-control h-10  w-1/2 px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md",type:"number"})})]})}))]})}),s.jsxs("div",{className:"mt-9",children:[" ",s.jsx("div",{className:"flex justify-start",children:s.jsxs("div",{className:"w-full grid-cols-12 col-span-12 grid mt-1 max-[464px]:grid-cols-6",children:[s.jsx("div",{className:"form-group mb-6 col-span-5 md:pr-4 flex justify-start max-[464px]:col-span-6",children:s.jsxs("label",{className:"form-check-label text-gray-800 ml-2 w-full",children:[" ",s.jsxs("span",{className:"inline text-gray-700",children:["Total Marks",s.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]})]})})," ",s.jsxs("div",{className:"form-group mb-6 col-span-2 md:pr-4 flex max-[464px]:col-span-6",children:[s.jsx("input",{...t.getFieldProps("totalMarks"),type:"number",disabled:!0,className:"form-control block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md ",placeholder:"0"}),s.jsx("span",{className:"text-red-600 absolute text-xs",children:t.touched.totalMarks&&t.errors.totalMarks?t.errors.totalMarks:null})]})]})}),s.jsx("div",{className:"flex justify-start",children:s.jsxs("div",{className:"w-full grid-cols-12 col-span-12 grid mt-1 max-[464px]:grid-cols-6",children:[s.jsx("div",{className:"form-group mb-6 col-span-5 md:pr-4 flex justify-start max-[464px]:col-span-6",children:s.jsxs("label",{className:"form-check-label text-gray-800 ml-2 w-full",children:[" ",s.jsxs("span",{className:"inline text-gray-700",children:["Obtained marks",s.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]})]})})," ",s.jsxs("div",{className:"form-group mb-6 col-span-2 md:pr-4 flex max-[464px]:col-span-6",children:[s.jsx("input",{...t.getFieldProps("totalObtainedMarks"),type:"number",disabled:!0,value:g,className:"form-control block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md ",placeholder:"0"}),s.jsx("span",{className:"text-red-600 absolute text-xs",children:t.touched.feeAmount&&t.errors.feeAmount?t.errors.feeAmount:null})]})]})}),s.jsx("div",{className:"flex justify-start",children:s.jsxs("div",{className:"w-full grid-cols-12 col-span-12 grid mt-1 max-[464px]:grid-cols-6",children:[s.jsx("div",{className:"form-group mb-6 col-span-5 md:pr-4 flex justify-start max-[464px]:col-span-6",children:s.jsxs("label",{className:"form-check-label text-gray-800 ml-2 w-full",children:[" ",s.jsxs("span",{className:"inline text-gray-700",children:["Percentage",s.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]})]})})," ",s.jsxs("div",{className:"form-group mb-6 col-span-2 md:pr-4 flex max-[464px]:col-span-6",children:[s.jsx("input",{...t.getFieldProps("percentage"),type:"number",disabled:!0,className:"form-control block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md ",placeholder:"0"}),s.jsx("span",{className:"text-red-600 absolute text-xs",children:t.touched.feeAmount&&t.errors.feeAmount?t.errors.feeAmount:null})]})]})})]})]}),s.jsxs("div",{className:"cancel-button-div",children:[s.jsx("div",{className:"    ",children:s.jsx("button",{onClick:()=>h("/marks-tabulation"),type:"button",className:"deactivate-button-master bg-red-500 text-white py-3",children:"Back to List"})}),s.jsx("div",{className:"submit-button-div",children:s.jsx("button",{type:"submit",className:"save-button",children:N!==void 0?"Update":"Save"})})]})]})})})]})})})}export{ue as default};
