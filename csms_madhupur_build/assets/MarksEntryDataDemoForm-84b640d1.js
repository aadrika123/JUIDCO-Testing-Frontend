import{r as u,u as T,O as J,c as U,a as Y,b as z,j as a,B as G,A as x,e as f,o as N,g as H}from"./index-21aade66.js";import{B as Q}from"./BottomErrorCard-c4e8289a.js";import{T as W}from"./Tabs-65330aff.js";function st(){var v,k;const[w,p]=u.useState(!1),[E,F]=u.useState(null),[M,c]=u.useState(!1),[b,I]=u.useState([]),[g,S]=u.useState([]);u.useState([]),u.useState([]),u.useState([]);const{api_getactiveSubjectData:X,api_getactiveClassData:C,api_finance_year:_,api_mapsectionData:j,api_getMarksEntryByID:$,api_postMarksEntryData:B,api_editMarksEntryData:V,api_getMarksEntryData:Z}=H(),y=T(),{id:m}=J(),D=U({classId:Y().required("Select Class")}),s=z({enableReinitialize:!0,initialValues:{classId:"",sectionData:[],marksEntries:[]},onSubmit:(t,e)=>{var r;console.log("at submit ",t);const n={marksEntries:[...(r=t==null?void 0:t.marksEntries)==null?void 0:r.map(i=>({classId:t==null?void 0:t.classId,sectionId:i==null?void 0:i.sectionId,subjectId:i==null?void 0:i.subjectId,isMainSubject:(i==null?void 0:i.mainoptional)=="main"?1:0,isOptionalSubject:(i==null?void 0:i.mainoptional)=="main"?0:1,fullMarks:i==null?void 0:i.fullMarks,passMarks:i==null?void 0:i.passMarks}))]};console.log("submitDataForm",n),L(n)},validationSchema:D}),L=t=>{c(!0);let e,l,n={marksEntries:t.marksEntries};m!==void 0?(e=V,l=n,l.id=m):(e=B,l=n),x.post(e,l,f()).then(function(r){var i,h,o;console.log("view discount group master..",(i=r==null?void 0:r.data)==null?void 0:i.data),(h=r==null?void 0:r.data)!=null&&h.status?y("/marks-entry-demo"):d(!0,`${(o=r==null?void 0:r.data)==null?void 0:o.message}`),c(!1)}).catch(function(r){console.log("==2 error list...",r),d(!0,"Error occured in submitting form."),c(!1)})},P=()=>{c(!0);let t={id:m};x.post($,t,f()).then(function(e){var l,n,r,i;console.log("fetch edit data response..",(l=e==null?void 0:e.data)==null?void 0:l.data),(n=e==null?void 0:e.data)!=null&&n.status?DiscountGroupEdit((r=e==null?void 0:e.data)==null?void 0:r.data):d(!0,`${(i=e==null?void 0:e.data)==null?void 0:i.message}`),c(!1)}).catch(function(e){console.log("= edit data error...",e),p(!0),c(!1)})},A=()=>{c(!0),x.post(_,{},f()).then(function(t){t!=null&&t.data?(console.log(t==null?void 0:t.data),I(t==null?void 0:t.data)):d(!0,"Error occured while fetching data."),c(!1)}).catch(function(t){console.log("==2 error list...",t),d(!0,"Error occured while fetching data."),c(!1)})},O=()=>{c(!0),x.post(C,{},f()).then(function(t){var e,l,n;((e=t==null?void 0:t.data)==null?void 0:e.status)===!0?(console.log(t==null?void 0:t.data),S((l=t==null?void 0:t.data)==null?void 0:l.data)):d(!0,`${(n=t==null?void 0:t.data)==null?void 0:n.message}`),c(!1)}).catch(function(t){console.log("==2 error list...",t),d(!0,"Error occured while fetching data."),c(!1)})},q=t=>{c(!0),x.post(j,{classId:t},f()).then(function(e){var l,n,r;((l=e==null?void 0:e.data)==null?void 0:l.status)===!0?(console.log(e==null?void 0:e.data),s.setFieldValue("sectionData",(r=(n=e==null?void 0:e.data)==null?void 0:n.data)==null?void 0:r.section.map(i=>({sectionName:i==null?void 0:i.sectionData,value:!0})))):d(!0,"Error occured while fetching data."),c(!1)}).catch(function(e){console.log("==2 error list...",e),d(!0,"Error occured while fetching data."),c(!1)})},K=t=>{c(!0),x.post(j,{classId:t},f()).then(function(e){var l,n,r,i,h;((l=e==null?void 0:e.data)==null?void 0:l.status)===!0?(console.log((n=e==null?void 0:e.data)==null?void 0:n.data),console.log((r=e==null?void 0:e.data)==null?void 0:r.data),s.setFieldValue("marksEntries",(h=(i=e==null?void 0:e.data)==null?void 0:i.data)==null?void 0:h.subject.map(o=>({className:o==null?void 0:o.class_name,sectionName:o==null?void 0:o.section_name,classId:o==null?void 0:o.class_id,sectionId:o==null?void 0:o.section_group_map_id,subjectId:o==null?void 0:o.id,subjectName:o==null?void 0:o.subject_name,fullMarks:100,passMarks:30,mainoptional:!1,optData:0})))):d(!0,"Error occured while fetching datas."),c(!1)}).catch(function(e){console.log("==2 error list...",e),d(!0,"Error occured while fetching dataes."),c(!1)})};console.log(s.values.sectionData),u.useEffect(()=>{s.values.classId!=""&&q(parseInt(s.values.classId))},[s.values.classId]),u.useEffect(()=>{s.values.classId!=""&&K(parseInt(s.values.classId))},[s.values.classId,s.values.sectionData.length>=0]),u.useEffect(()=>{A(),O(),m!==void 0&&P()},[]);const R=t=>{let e=t.target.name,l=t.target.value;e=="fullMarks"&&s.setFieldValue("fullMarks",N(l.trim(),s.values.fullMarks,3)),e=="passMarks"&&s.setFieldValue("passMarks",N(l.trim(),s.values.passMarks,3))},d=(t,e)=>{F(e),p(t)};return console.log(s.values.sectionData),u.useEffect(()=>{s.values.marksEntries.map((t,e)=>{(t==null?void 0:t.mainoptional)=="main"?s.setFieldValue(`marksEntries.${e}.optData`,0):s.setFieldValue(`marksEntries.${e}.optData`,1)})},[(v=s==null?void 0:s.values)==null?void 0:v.marksEntries]),a.jsx(a.Fragment,{children:a.jsx("div",{className:"main-div",children:a.jsxs("div",{className:"main-inner-div",children:[M&&a.jsx(G,{}),w&&a.jsx(Q,{activateBottomErrorCard:d,errorTitle:E}),a.jsxs("div",{className:"main-sub-div",children:[a.jsx("div",{className:"main-sub-inner-div",children:a.jsxs("div",{className:"text-div",children:[a.jsx("div",{className:"big-text",children:"Marks Entry Master Form"}),a.jsx("div",{className:"common-header-smalltext",children:"Unlock Your Potential. Join Our Journey Of Education And Excellence"})]})}),m===void 0?a.jsx("div",{className:"tab-div",children:a.jsx("div",{className:"add-button-master-div",children:a.jsxs("button",{onClick:()=>y("/marks-entry-demo-form"),type:"submit",className:" add-button-master bg-[#0F766E] hover:bg-[#0F766E]",children:["Add"," "]})})}):null]}),a.jsx(W,{listRoute:"/marks-entry-demo",formRoute:"/marks-entry-demo-form"}),a.jsx("div",{className:"details-div",children:a.jsx("span",{className:"detailes text-[#0F766E]",children:"Marks Entry Form"})}),a.jsx("div",{className:"form-div",children:a.jsx("form",{onSubmit:s.handleSubmit,onChange:R,children:a.jsxs("div",{className:"form",children:[a.jsxs("div",{className:"col-span-4 grid grid-cols-12",children:[a.jsxs("div",{className:"form-group mb-6 col-span-12 md:col-span-2 md:pr-4 relative",children:[a.jsxs("label",{className:"form-label inline-block mb-1 text-teal-900 text-sm font-semibold",children:["Academic Year",a.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),a.jsx("select",{...s==null?void 0:s.getFieldProps("fy"),type:"number",className:"form-control block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 h-10 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",placeholder:"Select class",children:b==null?void 0:b.map((t,e)=>a.jsx("option",{value:t==null?void 0:t.fy,children:t==null?void 0:t.fy}))}),a.jsx("span",{className:"text-red-600 absolute text-xs",children:s.touched.fy&&s.errors.fy?s.errors.fy:null})]}),a.jsxs("div",{className:"form-group mb-6 col-span-12 md:col-span-2 md:pr-4",children:[a.jsxs("label",{className:"form-label inline-block mb-1 text-teal-900 text-sm font-semibold",children:["Class",a.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),a.jsxs("select",{...s.getFieldProps("classId"),type:"number",className:"form-control h-10 block bg-white w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",placeholder:"Select Class",children:[a.jsx("option",{value:"",children:"Select"}),g==null?void 0:g.map((t,e)=>a.jsx("option",{value:t==null?void 0:t.id,children:t==null?void 0:t.class_name}))]}),a.jsx("span",{className:"text-red-600  text-xs",children:s.touched.classId&&s.errors.classId?s.errors.classId:null})]})]}),((k=s.values.sectionData)==null?void 0:k.length)!==0&&a.jsx("div",{className:"col-span-12 mt-4",children:a.jsx("div",{className:"overflow-x-auto pt-4 ",children:a.jsx("div",{className:"w-full flex items-center  justify-center border border-teal-300 p-4",children:a.jsxs("div",{className:"w-full block",children:[a.jsx("div",{className:"w-full items-start justify-start bg-white px-2 relative",children:a.jsxs("h1",{className:"absolute bg-white items-start justify-start px-2 mt-[-25px] ",children:[" ","Subject"," ",a.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]})}),a.jsx("div",{children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-200 max-[820px]:w-[820px]",children:[a.jsx("thead",{className:"bg-[#E7EFFC] ",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3  text-sm font-bold   tracking-wider",children:"Class Name"}),a.jsx("th",{className:"px-6 py-3  text-sm font-bold   tracking-wider",children:"Subject Name"}),a.jsx("th",{className:"px-6 py-3  text-sm font-bold   tracking-wider",children:"Full Marks"}),a.jsx("th",{className:"px-6 py-3  text-sm font-bold   tracking-wider",children:"Passing Marks"}),a.jsx("th",{className:"px-6 py-3  text-sm font-bold   tracking-wider",children:"Main"}),a.jsx("th",{className:"px-6 py-3  text-sm font-bold   tracking-wider",children:"Optional"})]})}),a.jsx("tbody",{className:" divide-y divide-gray-200 ",children:s.values.marksEntries&&s.values.marksEntries.map((t,e)=>a.jsxs("tr",{children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t==null?void 0:t.className}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t==null?void 0:t.subjectName}),a.jsx("td",{className:"px-6 py-3 whitespace-nowrap",children:a.jsx("input",{...s.getFieldProps(`marksEntries.${e}.fullMarks`),type:"number",onChange:l=>s.setFieldValue(`marksEntries.${e}.fullMarks`,l.target.value),onKeyDown:l=>["e","E","+","-"].includes(l.key)&&l.preventDefault(),className:"  text-center form-control h-10  w-1/2 px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md"})}),a.jsx("td",{className:"px-6 py-3 whitespace-nowrap",children:a.jsx("input",{...s.getFieldProps(`marksEntries.${e}.passMarks`),type:"number",onChange:l=>s.setFieldValue(`marksEntries.${e}.passMarks`,l.target.value),onKeyDown:l=>["e","E","+","-"].includes(l.key)&&l.preventDefault(),className:"text-center form-control h-10  w-1/2 px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md"})}),a.jsx("td",{className:"px-6 py-3 whitespace-nowrap",children:a.jsx("input",{...s.getFieldProps(`marksEntries.${e}.mainoptional`),type:"checkbox",value:"main",onChange:l=>s.setFieldValue(`marksEntries.${e}.mainoptional`,l.target.value),onKeyDown:l=>["e","E","+","-"].includes(l.key)&&l.preventDefault(),checked:(t==null?void 0:t.mainoptional)=="main",className:"text-center form-control  h-5  w-5 px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md"})}),a.jsxs("td",{className:"px-6 py-3 whitespace-nowrap",children:[a.jsx("input",{...s.getFieldProps(`marksEntries.${e}.mainoptional`),type:"checkbox",value:"optional",onChange:l=>s.setFieldValue(`marksEntries.${e}.mainoptional`,l.target.value),onKeyDown:l=>["e","E","+","-"].includes(l.key)&&l.preventDefault(),checked:(t==null?void 0:t.mainoptional)=="optional",className:"text-center form-control h-5 w-5 px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md"}),a.jsx("input",{type:"hidden",name:`marksEntries.${e}.optData`,value:(t==null?void 0:t.mainoptional)=="optional"?0:1})]})]}))})]})})]})})})}),a.jsxs("div",{className:"cancel-button-div",children:[a.jsx("div",{className:"    ",children:a.jsx("button",{onClick:()=>y("/marks-entry-demo"),type:"button",className:"deactivate-button-master py-2 bg-red-500 text-white",children:"Back to List"})}),a.jsx("div",{className:"submit-button-div",children:a.jsx("button",{type:"submit",className:" save-button",children:m!==void 0?"Update":"Save"})})]})]})})})]})})})}export{st as default};
