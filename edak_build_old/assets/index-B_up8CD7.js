import{r as R,a as q,u as U,A as H,f as B,s as T,b as V,o as O,U as G,V as Q,S as z,W as J,j as e,F as K,H as C,X as c,R as b,M as u,G as M,N as W,I as f,B as P,c as X,d as l,k as Y,_ as i,z as x}from"./index-BM0oc_dR.js";import{P as Z}from"./index-lAQ15i_6.js";import"./badge-272lERzh.js";import"./index-CeYUPDYe.js";import"./circle-check-big-DCfAJpH9.js";const ee=X().shape({receivedDate:l().required("Date is required").test("not-future","Date Must be Today or Earlier",function(r){const d=new Date().toISOString().split("T")[0];return r<=d}),receivedFrom:l().trim().required("Received From is required").test("no-extra-spaces","Please do not enter leading or trailing spaces.",r=>r===(r==null?void 0:r.trim())).max(50,"Received From be exactly 50 digits"),category:l().required("Add Category"),departmentAlloted:l(),sendTo:l(),subject:l().required("Add Subject").transform(r=>r==null?void 0:r.trim()).max(500,"Subject be exactly 25 digits"),content:l().required("Add Content").max(500,"Must be exactly 10000 digits"),remark:l().required("Add Content").transform(r=>r==null?void 0:r.trim()).max(25,"Remark be exactly 25 digits")});function se(){var D,v,y,F,S,w,A;const[r,d]=R.useState(!1),{user:o}=q(),L=U({}),_=H({}),N=B(),k=new URLSearchParams(Y().search),p=k.get("refNo"),j=k.get("page"),{data:t}=T({api:`${x.getEdakById}/${p}`,key:"getApplicationDetails",options:{enabled:!!p}}),h=T({api:`${x.getAllModule}`,key:"departmentList",value:[],options:{enabled:!0}}),n=V({resolver:O(ee),defaultValues:(t==null?void 0:t.data)||{ulbId:(o==null?void 0:o.roleId)===G||(o==null?void 0:o.roleId)===Q||(o==null?void 0:o.roleId)===z||(o==null?void 0:o.roleId)===J?"":o==null?void 0:o.userUlbId,moduleName:""}});R.useEffect(()=>{j==="edit"&&(t!=null&&t.data)&&n.reset(t.data)},[t==null?void 0:t.data,n,j]);const g=async(s,m)=>{var E,I;if(!r){if(d(!0),!(s!=null&&s.uploadedDocument)){i.error("Please select E-Dak Document First"),d(!1);return}try{const a=new FormData;a.append("receivedDate",s==null?void 0:s.receivedDate),a.append("receivedFrom",s==null?void 0:s.receivedFrom),a.append("category",s==null?void 0:s.category),a.append("departmentAlloted",(s==null?void 0:s.departmentAlloted)||""),a.append("sendTo",(s==null?void 0:s.sendTo)||""),a.append("subject",s==null?void 0:s.subject),a.append("content",s==null?void 0:s.content),a.append("remark",s==null?void 0:s.remark),a.append("document",s==null?void 0:s.uploadedDocument),a.append("ulbId",s==null?void 0:s.ulbId),a.append("priority",s==null?void 0:s.priority),m?a.append("draft","true"):a.append("draft","false"),j=="edit"?(E=(await _.mutateAsync({api:`${x.updateDraftEdakById}/${p}`,data:a})).data)!=null&&E.success?(i.success("E-Dak Updated!"),N(`/e-dak/dashboard/workflow-details?refNo=${p}&page=edakdraft`)):i.error("E-Dak Not Updated!"):(I=(await L.mutateAsync({api:x.createEdak,data:a})).data)!=null&&I.success?(i.success("E-Dak Created!"),N("/e-dak/dashboard/e-dak-workflow")):i.error("E-Dak Not Created!")}catch(a){console.log(a),i.error("Error while creating E-Dak")}finally{d(!1)}}};return e.jsx(K,{methods:n,onSubmit:n.handleSubmit(g),children:e.jsxs("div",{className:"grid grid-cols-4 gap-x-2 gap-y-4 rounded-md border bg-background p-10 shadow",children:[e.jsx("h1",{className:"text-xl font-bold uppercase text-blue-800",children:"Basic Info"}),e.jsx(C,{className:"col-span-4"}),e.jsxs("div",{children:[e.jsxs(c,{htmlFor:"date",children:[e.jsx("span",{className:"text-red-500",children:"*"}),"Received Date"]}),e.jsx(b,{name:"receivedDate",type:"date",className:""})]}),e.jsxs("div",{children:[e.jsxs(c,{htmlFor:"receivedFrom",children:[e.jsx("span",{className:"text-red-500",children:"*"}),"Received From."]}),e.jsx(b,{className:"bg-background",name:"receivedFrom",inputValidation:["string"],placeholder:""})]}),e.jsxs("div",{children:[e.jsxs(c,{htmlFor:"category",children:[e.jsx("span",{className:"text-red-500",children:"*"}),"Category"]}),e.jsx(u,{className:"cursor-pointer bg-background",name:"category",data:[{value:"e_mail",label:"E-Mail"},{value:"mail",label:"Mail"}]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"departmentAlloted",children:"Department Alloted (Module)"}),e.jsx(u,{className:"cursor-pointer bg-background",name:"departmentAlloted",data:((v=(D=h==null?void 0:h.data)==null?void 0:D.data)==null?void 0:v.map(s=>({value:`${s.uniqueString}`,label:`${s.moduleName}`})))||[]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"assignTo",children:"Send to"}),e.jsx(u,{className:"cursor-pointer bg-background",name:"sendTo",data:[{value:"dmc",label:"DMC"},{value:"rmc",label:"RMC"}]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"priority",children:"Priority"}),e.jsx(u,{className:"cursor-pointer bg-background",name:"priority",data:[{value:"important",label:"Important"},{value:"normal",label:"Normal"}]})]}),e.jsx("div",{className:"col-span-4"}),e.jsx("h1",{className:"text-xl font-bold uppercase text-blue-800",children:"E-Dak Info"}),e.jsx(C,{className:"col-span-4"}),e.jsx("div",{className:"col-span-4"}),e.jsxs("div",{children:[e.jsxs(c,{htmlFor:"subject",children:[e.jsx("span",{className:"text-red-500",children:"*"}),"Subject"]}),e.jsx(b,{className:"bg-background",name:"subject",inputValidation:["string","CapitalFirstLetter"],placeholder:""})]}),e.jsx("div",{className:"col-span-4"}),e.jsxs("div",{className:"col-span-3",children:[e.jsxs(c,{htmlFor:"remark",children:[e.jsx("span",{className:"text-red-500",children:"*"}),"Content"]}),e.jsx(M,{className:"h-20 w-full rounded-md border bg-background p-4",name:"content",placeholder:"write content"})]}),e.jsx("div",{className:"col-span-4"}),e.jsxs("div",{className:"col-span-3",children:[e.jsxs(c,{htmlFor:"remark",children:[e.jsx("span",{className:"text-red-500",children:"*"}),"Remark"]}),e.jsx(M,{className:"h-20 w-full rounded-md border bg-background p-4",name:"remark",placeholder:"write remark"})]}),e.jsx("div",{className:"col-span-4"}),e.jsxs("div",{className:"col-span-2",children:[e.jsxs(c,{children:[" ",e.jsx("span",{className:"text-red-500",children:"*"}),"Scanned E-Dak Document"," ",e.jsx("span",{className:"text-xs text-gray-500",children:"(acceptable formats are jpg, jpeg,png, pdf)"})]}),e.jsx(W,{className:"cursor-pointer",accept:"image/jpeg,image/jpg,image/png,application/pdf",name:"uploadedDocument",placeholder:"Select document"})]}),e.jsxs("div",{className:"col-span-1 mt-1",children:[(((y=n.watch("uploadedDocument"))==null?void 0:y.type)=="image/png"||((F=n.watch("uploadedDocument"))==null?void 0:F.type)=="image/jpg"||((S=n.watch("uploadedDocument"))==null?void 0:S.type)=="image/jpeg")&&e.jsx(f,{className:"w-28",src:URL.createObjectURL(n.watch("uploadedDocument"))}),((w=n.watch("uploadedDocument"))==null?void 0:w.type)=="application/pdf"&&e.jsx(f,{className:"w-16 cursor-pointer hover:scale-105",src:"/images/pdf.png"})]}),(t==null?void 0:t.data)&&e.jsxs("div",{className:"",children:[e.jsx(f,{className:"w-28",src:(A=t==null?void 0:t.data)==null?void 0:A.document}),e.jsx("h1",{className:"text-xs",children:"Previous Uploaded Document"})]}),e.jsx("div",{className:"col-span-4"}),e.jsxs("div",{className:"col-span-4",children:[e.jsx(P,{isLoading:r,onClick:s=>{s.preventDefault(),n.handleSubmit(m=>g(m,!1))()},disabled:r,className:"float-left w-auto rounded-xl px-10",children:"Send to Nodal Officer"}),e.jsx(P,{isLoading:r,onClick:s=>{s.preventDefault(),n.handleSubmit(m=>g(m,!0))()},disabled:r,className:"float-left mx-10 w-auto rounded-xl px-10",children:"Draft"})]})]})})}function le(){return e.jsx(Z,{title:"E-Dak",subTitle:"Creation of E-Dak Form",children:e.jsx("div",{className:"",children:e.jsx(se,{})})})}export{le as default};
