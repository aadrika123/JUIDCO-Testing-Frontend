import{u as re,G as le,v as O,g as y,r as n,b as ne,o as ce,J as oe,N as ie,T as ue,j as e,D as he,F as me,O as ae,R as xe,A as te,B as fe,c as je,d as U,k as de,_ as N,f as be,K as Q,w as pe,x as Ne,M as ge,y as Se,S as ve,z as Ie}from"./index-DOg5tZ0E.js";import{P as ye}from"./index-CgOOQbWr.js";import{T as we,a as Pe,b as se,c as b,d as ke,e as p}from"./table-DEeRP3-S.js";import{g as $e}from"./services-KQnp_8oA.js";import{P as Me}from"./index-BnjuEhHp.js";import{S as Ae}from"./index-B83ozfU4.js";import{q as Ce}from"./switch-DKSODox6.js";const Le=je().shape({ulbId:U().notRequired(),moduleId:U().notRequired(),workFlowName:U().required("workFlow Name is required"),parentId:U().notRequired(),levelSerial:U().notRequired()});function Re({open:c,setOpen:m,title:v,id:x,edit:g,setEdit:w,refetch:Y}){var H,M,A,C;const B=re({}),P=le({}),F=new URLSearchParams(de().search);let o=F.get("parentId"),k=F.get("levelSerial");const s=O({api:`${y.getWorkFlowById}?id=${x}`,key:"getWorkFlowById",options:{enabled:g}}),[V,I]=n.useState(),[_,$]=n.useState(),f=ne({resolver:ce(Le)}),G=async l=>{var i,u,j,L,R,q,a,S;let h=parseInt(k);try{if(g&&l){const d=await P.mutateAsync({api:`${y.updateWorkFlow}/${x}`,data:{ulbId:l.ulbId||"",moduleId:l.moduleId||"",workFlowName:l.workFlowName,parentId:(u=(i=s==null?void 0:s.data)==null?void 0:i.data)==null?void 0:u.parentId,levelSerial:(L=(j=s==null?void 0:s.data)==null?void 0:j.data)==null?void 0:L.levelSerial}});(R=d.data)!=null&&R.success?N.success((q=d==null?void 0:d.data)==null?void 0:q.message):N.error("Workflow not updated successfully")}else{const d=await B.mutateAsync({api:y.createWorkFlow,data:{ulbId:l.ulbId||"",moduleId:l.moduleId||"",workFlowName:l.workFlowName,parentId:o,levelSerial:h}});(a=d.data)!=null&&a.success?N.success((S=d==null?void 0:d.data)==null?void 0:S.message):N.error("Workflow not created successfully"),f.reset({ulbId:"",moduleId:"",workFlowName:"",parentId:"",levelSerial:""})}m(!1),w(!1),Y()}catch(d){console.log(d)}};n.useEffect(()=>{var l,h,i,u,j;g&&(s!=null&&s.data)?f.reset({ulbId:(l=s==null?void 0:s.data)==null?void 0:l.data.ulbId,moduleId:(h=s==null?void 0:s.data)==null?void 0:h.data.moduleId,workFlowName:(i=s==null?void 0:s.data)==null?void 0:i.data.workFlowName,parentId:(u=s==null?void 0:s.data.data)==null?void 0:u.parentId,levelSerial:(j=s==null?void 0:s.data.data)==null?void 0:j.levelSerial}):f.reset({ulbId:"",moduleId:"",workFlowName:"",parentId:o??"",levelSerial:k??""})},[g,s==null?void 0:s.data]);const J=async()=>{var h,i,u;const l=await B.mutateAsync({api:y.checkWfModulePermission,data:{workflowId:o=="null"?Number(o):o,ulbId:o=="null"?Number(o):o}});(h=l.data)!=null&&h.success&&(I((i=l.data)==null?void 0:i.canSelectModule),$((u=l.data)==null?void 0:u.canSelectUlb))};n.useEffect(()=>{c===!0&&J()},[c]);const t=oe({api:ie,key:"getAllModuleList",options:{enabled:!0}}),K=O({api:ue,options:{enabled:!0}});return e.jsxs(he,{open:c,setOpen:m,title:v,setEdit:w,edit:g,isLoading:s==null?void 0:s.isFetching,children:[e.jsx(me,{methods:f,onSubmit:f.handleSubmit(G),children:e.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[_&&e.jsxs("div",{children:["Select ULB Name",e.jsx(ae,{name:"ulbId",data:((M=(H=K.data)==null?void 0:H.data)==null?void 0:M.map(l=>({value:l.id,label:l.ulb_name})))??[]})]}),V&&e.jsxs("div",{children:["Select Module Name",e.jsx(ae,{name:"moduleId",data:((C=(A=t.data)==null?void 0:A.data)==null?void 0:C.map(l=>({value:l.id,label:l.module_name})))??[]})]}),e.jsx("div",{children:e.jsx(xe,{name:"workFlowName",placeholder:"Enter your WorkFlow Name"})}),e.jsx(te,{}),e.jsx("div",{children:e.jsx(fe,{isLoading:f.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})}),";"]})}function qe(c){var M,A,C,l,h,i,u,j,L,R,q;const[m,v]=n.useState(1),[x,g]=n.useState(50),[w,Y]=n.useState(""),[B,P]=n.useState(!1),[z,F]=n.useState(""),[o,k]=n.useState(!1),s=le({}),I=new URLSearchParams(de().search),_=be(),$=I.get("parentId"),f=I.get("levelSerial"),G=I.get("parentName"),J=I.get("moduleName"),t=O({api:`${y.getAllWorkFlow}?page=${m}&limit=${x}&q=${w}&parentId=${$}&levelSerial=${f}`,key:"getAllWorkFlow",value:[m,x,$],options:{enabled:!0}}),K=a=>{k(!0),P(!0),F(a)},H=async a=>{var S,d,E,T,X,Z,W,D,ee;try{const r=await s.mutateAsync({api:`${(S=y)==null?void 0:S.updateWorkFlowStatus}/${a}`,data:{id:z}});(d=r==null?void 0:r.data)!=null&&d.success?(t.refetch(),((T=(E=r==null?void 0:r.data)==null?void 0:E.data)==null?void 0:T.status)==1&&N.success((X=r.data)==null?void 0:X.message),((W=(Z=r==null?void 0:r.data)==null?void 0:Z.data)==null?void 0:W.status)==0&&N.error((D=r.data)==null?void 0:D.message)):N.error((ee=r.data)==null?void 0:ee.message)}catch(r){N.error($e(r))}};return n.useEffect(()=>{c==null||c.settitle(G),c==null||c.setSubtitle(J)},[$]),e.jsxs("main",{className:"grid items-start",children:[e.jsx(Re,{open:B,setOpen:P,title:o?"Edit Workflow":"Add Workflow",id:z,edit:o,setEdit:k,refetch:t.refetch}),e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[e.jsxs("div",{className:"flex w-full justify-between gap-2",children:[e.jsx("div",{children:e.jsx(Ae,{search:w,setPage:v,setSearch:Y,refetch:t.refetch,isFetching:t.isLoading})}),e.jsx("div",{children:e.jsx(Q,{className:"flex items-center gap-2",onClick:()=>{P(!0)},children:"Add New"})})]}),e.jsxs(pe,{children:[e.jsx(Ne,{className:"px-7",children:e.jsxs(ge,{children:["Work Flow Role List (",(A=(M=t.data)==null?void 0:M.data)==null?void 0:A.totalDocs,")"]})}),e.jsx(Se,{children:t.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(ve,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(we,{children:[e.jsx(Pe,{children:e.jsxs(se,{children:[e.jsx(b,{className:"",children:"#"}),e.jsx(b,{className:"",children:"Work Flow Name"}),e.jsx(b,{className:"",children:"Ulb Name"}),e.jsx(b,{className:"",children:"Module Name"}),e.jsx(b,{className:"",children:"Level Serial"}),e.jsx(b,{className:"",children:"Created at"}),e.jsx(b,{className:"",children:"Status"}),e.jsx(b,{children:"Action"})]})}),e.jsx(ke,{children:(h=(l=(C=t==null?void 0:t.data)==null?void 0:C.data)==null?void 0:l.docs)==null?void 0:h.map((a,S)=>{var d,E;return e.jsxs(se,{children:[e.jsx(p,{children:S+1}),e.jsx(p,{children:a==null?void 0:a.workFlowName}),e.jsx(p,{children:(d=a==null?void 0:a.ulbDetails)==null?void 0:d.name}),e.jsx(p,{children:(E=a==null?void 0:a.moduleDetails)==null?void 0:E.name}),e.jsx(p,{children:a==null?void 0:a.levelSerial}),e.jsx(p,{children:Ie(a.createdAt).format("DD-MM-YYYY")}),e.jsx(p,{children:e.jsxs(Ce,{checked:(a==null?void 0:a.status)==1,onChange:()=>H(a._id),className:`${a!=null&&a.status?"bg-primary":"bg-gray-200"} relative inline-flex h-6 w-11 items-center rounded-full`,children:[e.jsx("span",{className:"sr-only",children:"Enable notifications"}),e.jsx("span",{className:`${a!=null&&a.status?"translate-x-6":"translate-x-1"} inline-block h-4 w-4 transform rounded-full bg-white`})]})}),e.jsxs(p,{className:"space-x-2",children:[e.jsx(Q,{variant:"secondary",onClick:()=>K(a._id),children:"Edit"}),e.jsx(Q,{variant:"secondary",onClick:()=>{_(`/grievance/dashboard/members-details?parentId=${a==null?void 0:a._id}`)},children:"Members"}),e.jsx(Q,{className:"bg-primary md:ml-5",onClick:()=>{var T;_(`/grievance/dashboard/workflow-master?parentId=${a==null?void 0:a._id}&levelSerial=${(a==null?void 0:a.levelSerial)+1}&parentName=${a.workFlowName}&moduleName=${(T=a==null?void 0:a.module)==null?void 0:T.moduleName}`)},children:"View"})]})]},a._id)})})]}),e.jsx(te,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(Me,{page:m,perPage:x,totalPage:(u=(i=t==null?void 0:t.data)==null?void 0:i.data)==null?void 0:u.totalDocs,hasNextPage:(L=(j=t==null?void 0:t.data)==null?void 0:j.data)==null?void 0:L.hasNextPage,hasPrevPage:(q=(R=t==null?void 0:t.data)==null?void 0:R.data)==null?void 0:q.hasPrevPage,setPage:v,setPerPage:g})})]})})]})]})]})}function Qe(){const[c,m]=n.useState("Workflow Master List"),[v,x]=n.useState("");return e.jsx(ye,{title:c||"Workflow Master List",subTitle:v||"Manage all the work Flow here",children:e.jsx("div",{className:"",children:e.jsx(qe,{settitle:m,setSubtitle:x})})})}export{Qe as default};
