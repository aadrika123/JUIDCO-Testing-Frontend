import{u as O,G as V,v as D,g as f,b as Q,o as W,r as i,j as e,D as X,F as Z,R as ee,A as J,B as ae,c as se,d as te,_ as l,K,w as re,x as ne,M as ce,y as le,S as de,z as ie}from"./index-Di_aGywo.js";import{P as oe}from"./index-skYvmoQE.js";import{T as pe,a as he,b as U,c as p,d as ue,e as h}from"./table-Dsc_-o8o.js";import{g as xe}from"./services-KQnp_8oA.js";import{P as ge}from"./index-BZMvf5fs.js";import{S as je}from"./index-BlXwAL63.js";import{q as me}from"./switch-srrB9iMr.js";const fe=se().shape({complaintTypeName:te().required("Grievance type name is required")});function ye({open:u,setOpen:y,title:C,id:o,edit:d,setEdit:x,refetch:P}){const S=O({}),g=V({}),{data:c,isFetching:w}=D({api:`${f.getComplaintTypeById}/${o}`,key:"getComplaintSourceById",options:{enabled:d}}),n=Q({defaultValues:{complaintTypeName:""},resolver:W(fe)}),N=async s=>{var T,v,j,m;try{if(d&&s){const t=await g.mutateAsync({api:`${f.updateComplaintType}/${o}`,data:s});(T=t.data)!=null&&T.success?l.success((v=t==null?void 0:t.data)==null?void 0:v.message):l.error("Grievance Source not updated successfully")}else{const t=await S.mutateAsync({api:f.createComplaintType,data:s});(j=t.data)!=null&&j.success?l.success((m=t==null?void 0:t.data)==null?void 0:m.message):l.error("Grievance Source not created successfully"),n.reset({complaintTypeName:""})}y(!1),x(!1),P()}catch(t){console.log(t)}};return i.useEffect(()=>{var s;d&&c?n.reset({complaintTypeName:(s=c==null?void 0:c.data)==null?void 0:s.complaintTypeName}):n.reset({complaintTypeName:""})},[d,c]),e.jsx(X,{open:u,setOpen:y,title:C,setEdit:x,edit:d,isLoading:w,children:e.jsx(Z,{methods:n,onSubmit:n.handleSubmit(N),children:e.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[e.jsx("div",{children:e.jsx(ee,{name:"complaintTypeName",placeholder:"Enter Grievance Type "})}),e.jsx(J,{}),e.jsx("div",{children:e.jsx(ae,{isLoading:n.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}function Ne(){var j,m,t,$,A,G,E,F,M,B,k;const[u,y]=i.useState(1),C=V({}),[o,d]=i.useState(5),[x,P]=i.useState(""),[S,g]=i.useState(!1),[c,w]=i.useState(""),[n,N]=i.useState(!1),s=D({api:`${f.getAllComplaintType}?page=${u}&limit=${o}&q=${x}`,key:"getAllComplaintSource",value:[u,o],options:{enabled:!0}}),T=a=>{N(!0),g(!0),w(a)},v=async a=>{var b,L,_,q,I,H,R,Y,z;try{const r=await C.mutateAsync({api:`${(b=f)==null?void 0:b.updateComplaintTypeStatus}/${a}`,data:{id:c}});(L=r==null?void 0:r.data)!=null&&L.success?(s.refetch(),((q=(_=r==null?void 0:r.data)==null?void 0:_.data)==null?void 0:q.status)==1&&l.success((I=r.data)==null?void 0:I.message),((R=(H=r==null?void 0:r.data)==null?void 0:H.data)==null?void 0:R.status)==0&&l.error((Y=r.data)==null?void 0:Y.message)):l.error((z=r.data)==null?void 0:z.message)}catch(r){l.error(xe(r))}};return e.jsxs("main",{className:"grid items-start",children:[e.jsx(ye,{open:S,setOpen:g,title:n?"Edit Grievance Type":"Add Grievance Type",id:c,edit:n,setEdit:N,refetch:s.refetch}),e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[e.jsxs("div",{className:"flex w-full justify-between gap-2",children:[e.jsx("div",{children:e.jsx(je,{search:x,setSearch:P,refetch:s.refetch,isFetching:s.isLoading})}),e.jsx("div",{children:e.jsx(K,{className:"flex items-center gap-2",onClick:()=>g(!0),children:"Add New"})})]}),e.jsxs(re,{children:[e.jsx(ne,{className:"px-7",children:e.jsxs(ce,{children:["Complaint Type List (",(m=(j=s.data)==null?void 0:j.data)==null?void 0:m.totalDocs,")"]})}),e.jsx(le,{children:s.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(de,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(pe,{children:[e.jsx(he,{children:e.jsxs(U,{children:[e.jsx(p,{className:"",children:"#"}),e.jsx(p,{className:"",children:" Grievance Type Name"}),e.jsx(p,{className:"",children:"Id"}),e.jsx(p,{className:"",children:"Created at"}),e.jsx(p,{className:"",children:"Status"}),e.jsx(p,{children:"Action"})]})}),e.jsx(ue,{children:(A=($=(t=s==null?void 0:s.data)==null?void 0:t.data)==null?void 0:$.docs)==null?void 0:A.map((a,b)=>e.jsxs(U,{children:[e.jsx(h,{children:b+1}),e.jsx(h,{children:a==null?void 0:a.complaintTypeName}),e.jsx(h,{children:a==null?void 0:a._id}),e.jsx(h,{children:ie(a==null?void 0:a.createdAt).format("DD-MM-YYYY")}),e.jsx(h,{children:e.jsxs(me,{checked:(a==null?void 0:a.status)==1,onChange:()=>v(a._id),className:`${a!=null&&a.status?"bg-primary":"bg-gray-200"} relative inline-flex items-center h-6 rounded-full w-11`,children:[e.jsx("span",{className:"sr-only",children:"Enable notifications"}),e.jsx("span",{className:`${a!=null&&a.status?"translate-x-6":"translate-x-1"} inline-block w-4 h-4 transform bg-white rounded-full`})]})}),e.jsx(h,{children:e.jsx(K,{onClick:()=>T(a==null?void 0:a._id),children:"Edit"})})]},a==null?void 0:a._id))})]}),e.jsx(J,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(ge,{page:u,perPage:o,totalPage:(E=(G=s==null?void 0:s.data)==null?void 0:G.data)==null?void 0:E.totalDocs,hasNextPage:(M=(F=s==null?void 0:s.data)==null?void 0:F.data)==null?void 0:M.hasNextPage,hasPrevPage:(k=(B=s==null?void 0:s.data)==null?void 0:B.data)==null?void 0:k.hasPrevPage,setPage:y,setPerPage:d})})]})})]})]})]})}function $e(){return e.jsx(oe,{title:"Grievance Types",subTitle:"Manage all the Grievance Types here",children:e.jsx("div",{className:"",children:e.jsx(Ne,{})})})}export{$e as default};
