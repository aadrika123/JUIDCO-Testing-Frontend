import{u as W,G as J,v as R,g as p,b as X,o as Z,r as u,j as e,D as ee,F as se,R as E,O as ae,A as Q,B as te,c as ie,d as y,_ as h,K as U,w as de,x as ne,M as ce,y as re,S as le,z as me}from"./index-CtV24Q57.js";import{P as he}from"./index-BYiFiVfg.js";import{T as oe,a as ue,b as V,c as n,d as xe,e as c}from"./table-CZIjl9tM.js";import{g as pe}from"./services-KQnp_8oA.js";import{P as je}from"./index-Bowmb8FB.js";import{S as ge}from"./index-BXPuUs73.js";import{q as fe}from"./switch-Cd5U_YED.js";const be=ie().shape({problem:y().required("Role name is required"),departmentId:y().required("Description is required"),sla1:y().required("Description is required"),sla2:y().required("Description is required"),sla3:y().required("Description is required")});function Pe({open:x,setOpen:j,title:I,id:m,edit:o,setEdit:g,refetch:L}){var $,w,b;const C=W({}),f=J({}),{data:d,isFetching:A}=R({api:`${p.getProblemById}/${m}`,key:"getRoleById",options:{enabled:o}}),r=X({defaultValues:{problem:"",departmentId:"",sla1:"",sla2:"",sla3:""},resolver:Z(be)}),F=async l=>{var P,S,v,N;try{if(o&&l){const t=await f.mutateAsync({api:`${p.updateProblem}/${m}`,data:l});(P=t.data)!=null&&P.success?h.success((S=t==null?void 0:t.data)==null?void 0:S.message):h.error("Role not updated successfully")}else{const t=await C.mutateAsync({api:p.createProblem,data:l});(v=t.data)!=null&&v.success?h.success((N=t==null?void 0:t.data)==null?void 0:N.message):h.error("Role not created successfully"),r.reset({problem:"",departmentId:"",sla1:"",sla2:"",sla3:""})}j(!1),g(!1),L()}catch(t){console.log(t)}};u.useEffect(()=>{o&&d?r.reset({problem:d.data.problem,departmentId:d.data.departmentId,sla1:d.data.sla1,sla2:d.data.sla2,sla3:d.data.sla3}):r.reset({problem:"",departmentId:"",sla1:"",sla2:"",sla3:""})},[o,d]);const a=R({api:`${p.getAllDepartment}?page=1&limit=1000`,key:"getAllDepartment",options:{enabled:!0}});return e.jsx(ee,{open:x,setOpen:j,title:I,setEdit:g,edit:o,isLoading:A,children:e.jsx(se,{methods:r,onSubmit:r.handleSubmit(F),children:e.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[e.jsx("div",{children:e.jsx(E,{name:"problem",placeholder:"Enter problem name"})}),e.jsx("div",{children:e.jsx(ae,{name:"departmentId",data:((b=(w=($=a.data)==null?void 0:$.data)==null?void 0:w.docs)==null?void 0:b.map(l=>({value:l._id,label:l.department})))??[]})}),e.jsx("div",{children:e.jsx(E,{name:"sla1",placeholder:"Enter SLA 1"})}),e.jsx("div",{children:e.jsx(E,{name:"sla2",placeholder:"Enter SLA 2"})}),e.jsx("div",{children:e.jsx(E,{name:"sla3",placeholder:"Enter SLA 3"})}),e.jsx(Q,{}),e.jsx("div",{children:e.jsx(te,{isLoading:r.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}function Se(){var b,l,P,S,v,N,t,M,T,k,B;const[x,j]=u.useState(1),I=J({}),[m,o]=u.useState(10),[g,L]=u.useState(""),[C,f]=u.useState(!1),[d,A]=u.useState(!1),[r,F]=u.useState(""),a=R({api:`${p.getAllProblem}?page=${x}&limit=${m}&q=${g}`,key:"getAllProblem",value:[x,m],options:{enabled:!0}}),$=async s=>{var q,D,G,_,H,Y,z,K,O;try{const i=await I.mutateAsync({api:`${(q=p)==null?void 0:q.updateProblemStatus}/${s}`,data:{id:r}});(D=i==null?void 0:i.data)!=null&&D.success?(a.refetch(),((_=(G=i==null?void 0:i.data)==null?void 0:G.data)==null?void 0:_.status)==1&&h.success((H=i.data)==null?void 0:H.message),((z=(Y=i==null?void 0:i.data)==null?void 0:Y.data)==null?void 0:z.status)==0&&h.error((K=i.data)==null?void 0:K.message)):h.error((O=i.data)==null?void 0:O.message)}catch(i){h.error(pe(i))}},w=s=>{A(!0),f(!0),F(s)};return e.jsxs("main",{className:"grid items-start",children:[e.jsx(Pe,{open:C,setOpen:f,title:d?"Edit Gr Problem":"Add Gr Problem",id:r,edit:d,setEdit:A,refetch:a.refetch}),e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[e.jsxs("div",{className:"flex w-full justify-between gap-2",children:[e.jsx("div",{children:e.jsx(ge,{search:g,setSearch:L,setPage:j,refetch:a.refetch,isFetching:a.isLoading})}),e.jsx("div",{children:e.jsx(U,{className:"flex items-center gap-2",onClick:()=>f(!0),children:"Add New"})})]}),e.jsxs(de,{children:[e.jsx(ne,{className:"px-7",children:e.jsxs(ce,{children:["Grievance Problem List (",(l=(b=a.data)==null?void 0:b.data)==null?void 0:l.totalDocs,")"]})}),e.jsx(re,{children:a.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(le,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(oe,{children:[e.jsx(ue,{children:e.jsxs(V,{children:[e.jsx(n,{className:"",children:"#"}),e.jsx(n,{className:"",children:"Gr Problem"}),e.jsx(n,{className:"",children:"Department"}),e.jsx(n,{className:"",children:"SLA 1"}),e.jsx(n,{className:"",children:"SLA 2"}),e.jsx(n,{className:"",children:"SLA 3"}),e.jsx(n,{className:"",children:"Id"}),e.jsx(n,{className:"",children:"Created at"}),e.jsx(n,{className:"",children:"Status"}),e.jsx(n,{children:"Action"})]})}),e.jsx(xe,{children:(v=(S=(P=a==null?void 0:a.data)==null?void 0:P.data)==null?void 0:S.docs)==null?void 0:v.map((s,q)=>e.jsxs(V,{children:[e.jsx(c,{children:x*m-m+q+1}),e.jsx(c,{children:s==null?void 0:s.problem}),e.jsx(c,{children:s==null?void 0:s.departmentName}),e.jsx(c,{children:s==null?void 0:s.sla1}),e.jsx(c,{children:s==null?void 0:s.sla2}),e.jsx(c,{children:s==null?void 0:s.sla3}),e.jsx(c,{children:s==null?void 0:s._id}),e.jsx(c,{children:me(s==null?void 0:s.createdAt).format("DD-MM-YYYY")}),e.jsx(c,{children:e.jsxs(fe,{checked:(s==null?void 0:s.status)==1,onChange:()=>$(s._id),className:`${s!=null&&s.status?"bg-primary":"bg-gray-200"} relative inline-flex items-center h-6 rounded-full w-11`,children:[e.jsx("span",{className:"sr-only",children:"Enable notifications"}),e.jsx("span",{className:`${s!=null&&s.status?"translate-x-6":"translate-x-1"} inline-block w-4 h-4 transform bg-white rounded-full`})]})}),e.jsx(c,{children:e.jsx(U,{onClick:()=>w(s==null?void 0:s._id),children:"Edit"})})]},s==null?void 0:s._id))})]}),e.jsx(Q,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(je,{page:x,perPage:m,totalPage:(t=(N=a==null?void 0:a.data)==null?void 0:N.data)==null?void 0:t.totalDocs,hasNextPage:(T=(M=a==null?void 0:a.data)==null?void 0:M.data)==null?void 0:T.hasNextPage,hasPrevPage:(B=(k=a==null?void 0:a.data)==null?void 0:k.data)==null?void 0:B.hasPrevPage,setPage:j,setPerPage:o})})]})})]})]})]})}function Ee(){return e.jsx(he,{title:"Grievance Problem",subTitle:"Manage all the Grievance Problem here",children:e.jsx("div",{children:e.jsx(Se,{})})})}export{Ee as default};
