import{U as je,u as ge,r as t,b as J,o as Z,v as H,g as y,j as e,F as ee,w as se,x as ae,M as re,y as te,S as le,z as oe,V as pe,A as O,c as ne,d as I,k as ce,_ as k,W as de,X as fe,D as be,O as ye,B as Me,K as z,Y as Ne}from"./index-CtV24Q57.js";import{P as we}from"./index-BYiFiVfg.js";import{T as ie,a as he,b as V,c as m,d as me,e as u}from"./table-CZIjl9tM.js";import{g as ke}from"./services-KQnp_8oA.js";import{P as ue}from"./index-Bowmb8FB.js";import{S as xe}from"./index-BXPuUs73.js";import{D as ve}from"./index-BpJTjD7I.js";/**
 * @license lucide-react v0.428.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=je("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Se=ne().shape({ulbId:I().required("ulb is required"),moduleId:I().required("Module  is required"),workFlowName:I().required("workFlow Name is required"),parentId:I().notRequired(),levelSerial:I().notRequired()});function Ae({open:x,setOpen:i,title:v,edit:M,setEdit:R,refetch:p}){var s,c,D,$,U,L,q,C,_,B;const P=ge({}),[f,N]=t.useState(1),[l,h]=t.useState(10),[S,F]=t.useState(""),j=new URLSearchParams(ce().search).get("parentId"),g=J({resolver:Z(Se)}),n=async()=>{},a=H({api:`${y.getAllUser}?page=${f}&limit=${l}&q=${S}`,key:"getAllUserData",value:[f,l],options:{enabled:!0}}),w=r=>{if(!r){console.error("Error: User ID is null or undefined!"),k.error("Invalid User ID!");return}de("Are you sure?","Please confirm",async()=>{var T,Y;console.log("User ID before API call:",r);const d=await P.mutateAsync({api:y.createWFUserMapping,data:{workflowId:j,userId:r}});console.log("API Response:",d),(T=d==null?void 0:d.data)!=null&&T.success?(p(),k.success((Y=d==null?void 0:d.data)==null?void 0:Y.message)):k.error("Workflow user not created successfully")}),i(!1)};return e.jsx(ve,{open:x,setOpen:i,title:v,setEdit:R,edit:M,isLoading:a==null?void 0:a.isFetching,children:e.jsx(ee,{methods:g,onSubmit:g.handleSubmit(n),children:e.jsx("div",{className:"grid gap-x-2 gap-y-4",children:e.jsxs(se,{children:[e.jsx("div",{className:"mx-5 p-2",children:e.jsx(xe,{search:S,setPage:N,setSearch:F,refetch:a.refetch,isFetching:a.isLoading})}),e.jsx(ae,{className:"px-7",children:e.jsxs(re,{children:["Workflow Member List (",(c=(s=a.data)==null?void 0:s.data)==null?void 0:c.totalDocs,")"]})}),e.jsx(te,{children:a.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(le,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(ie,{children:[e.jsx(he,{children:e.jsxs(V,{children:[e.jsx(m,{children:"#"}),e.jsx(m,{children:"User Name"}),e.jsx(m,{children:"Role"}),e.jsx(m,{children:"Created at"}),e.jsx(m,{children:"Action"})]})}),e.jsx(me,{children:($=(D=a==null?void 0:a.data)==null?void 0:D.data)==null?void 0:$.map((r,d)=>e.jsxs(V,{children:[e.jsx(u,{children:d+1}),e.jsx(u,{children:r.user_name}),e.jsx(u,{children:r.role}),e.jsx(u,{children:oe(r.createdAt).format("DD-MM-YYYY")}),e.jsx(u,{children:e.jsx(pe,{className:"bg-primary",onClick:()=>w(r==null?void 0:r.id),children:"Add Member"})})]},r._id))})]}),e.jsx(O,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(ue,{page:f,perPage:l,totalPage:(L=(U=a==null?void 0:a.data)==null?void 0:U.data)==null?void 0:L.totalDocs,hasNextPage:(C=(q=a==null?void 0:a.data)==null?void 0:q.data)==null?void 0:C.hasNextPage,hasPrevPage:(B=(_=a==null?void 0:a.data)==null?void 0:_.data)==null?void 0:B.hasPrevPage,setPage:N,setPerPage:h})})]})})]})})})})}const Ie=ne().shape({roleName:I().required("Role Name is required")});function Re({open:x,setOpen:i,title:v,id:M,wrkId:R,edit:p,setEdit:P,refetch:f}){var A,W,j,g;const N=fe({}),{data:l}=H({api:`${y.getWFUserMappingById}/${R}`,key:"getWFUserMappingById",options:{enabled:p}}),h=J({defaultValues:{roleName:((A=l==null?void 0:l.data)==null?void 0:A._id)||""},resolver:Z(Ie)}),S=async n=>{var a,w;try{const s=await N.mutateAsync({api:`${y.updateWFUserAndMemberMapping}/${M}`,data:{workflowUserMappingId:M,workflowRoleId:n==null?void 0:n.roleName}});(a=s.data)!=null&&a.success?k.success((w=s==null?void 0:s.data)==null?void 0:w.message):k.error("Member Role not updated successfully"),i(!1),P(!1),f()}catch(s){console.log(s)}};t.useEffect(()=>{var n;p?h.reset({roleName:(n=l==null?void 0:l.data)==null?void 0:n._id}):h.reset({roleName:""})},[p,l]);const F=H({api:`${y.getAllWorkFlowRole}?page=1&limit=1000`,key:"getAllWorkFlowRole",options:{enabled:!0}});return e.jsx(be,{open:x,setOpen:i,title:v,setEdit:P,edit:p,children:e.jsx(ee,{methods:h,onSubmit:h.handleSubmit(S),children:e.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[e.jsx("div",{children:e.jsx(ye,{name:"roleName",data:((g=(j=(W=F.data)==null?void 0:W.data)==null?void 0:j.docs)==null?void 0:g.map(n=>({value:n._id,label:n.workFlowRoleName})))??[]})}),e.jsx(O,{}),e.jsx("div",{children:e.jsx(Me,{isLoading:h.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}function Fe(x){var $,U,L,q,C,_,B,r,d,T,Y,G,K,X;const[i,v]=t.useState(1),[M,R]=t.useState(10),[p,P]=t.useState(""),[f,N]=t.useState(!1),[l,h]=t.useState(!1),[S,F]=t.useState(""),[A,W]=t.useState(""),[j,g]=t.useState(!1),w=new URLSearchParams(ce().search).get("parentId"),s=H({api:`${y.getAllWFUserMapping}?workflowId=${w}`,key:"getAllWFUserMapping",value:[i,M,w],options:{enabled:!0}}),c=H({api:`${y.checkGeneralActions}`,key:"generalActionPermission",options:{enabled:!0}});t.useEffect(()=>{x==null||x.settitle()},[]);const D=o=>{de("Are you sure ?","Please confirm",async()=>{var Q;Ne.post(`${(Q=y)==null?void 0:Q.deleteWFUserMapping}/${o}`).then(b=>{var E;k.success((E=b==null?void 0:b.data)==null?void 0:E.message),s.refetch()}).catch(b=>{k.error(ke(b))})})};return e.jsxs("main",{className:"grid items-start",children:[f&&e.jsx(Ae,{open:f,setOpen:N,title:j?"Edit Workflow Member":"Add Workflow Member",id:A,edit:j,setEdit:g,refetch:s.refetch}),e.jsx(Re,{open:l,setOpen:h,title:j?"Edit Workflow Member Role":"Add Workflow Member Role",id:A,wrkId:S,edit:j,setEdit:g,refetch:s.refetch}),e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[e.jsxs("div",{className:"flex w-full justify-between gap-2",children:[e.jsx("div",{children:e.jsx(xe,{search:p,setPage:v,setSearch:P,refetch:s.refetch,isFetching:s.isLoading})}),((U=($=c==null?void 0:c.data)==null?void 0:$.permission)==null?void 0:U.canModifyMembers)&&e.jsx("div",{children:e.jsx(z,{className:"flex items-center gap-2",onClick:()=>N(!0),children:"Add New"})})]}),e.jsxs(se,{children:[e.jsx(ae,{className:"px-7",children:e.jsxs(re,{children:["Workflow Member List (",(q=(L=s.data)==null?void 0:L.data)==null?void 0:q.totalDocs,")"]})}),e.jsx(te,{children:s.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(le,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(ie,{children:[e.jsx(he,{children:e.jsxs(V,{children:[e.jsx(m,{className:"",children:"#"}),e.jsx(m,{className:"",children:"Workflow Member"}),e.jsx(m,{className:"",children:"Role"}),((_=(C=c==null?void 0:c.data)==null?void 0:C.permission)==null?void 0:_.canModifyMembers)&&e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"",children:"Created at"}),e.jsx(m,{children:"Action"})]})]})}),e.jsx(me,{children:(r=(B=s==null?void 0:s.data)==null?void 0:B.data)==null?void 0:r.map((o,Q)=>{var b,E;return e.jsxs(V,{children:[e.jsxs(u,{children:[Q+1," "]}),e.jsx(u,{className:"font-semibold",children:o.user_name}),e.jsx(u,{children:o.workflowRoleName||"N/A"}),((E=(b=c==null?void 0:c.data)==null?void 0:b.permission)==null?void 0:E.canModifyMembers)&&e.jsxs(e.Fragment,{children:[e.jsx(u,{children:oe(o.createdAt).format("DD-MM-YYYY")}),e.jsxs(u,{className:"space-x-5 ",children:[e.jsx(z,{type:"button",className:"",variant:"secondary",onClick:()=>{W(o._id),F(o==null?void 0:o.workflowRoleId),h(!0),g(!!o.workflowRoleId)},children:o.workflowRoleName?e.jsx("div",{children:" Update Member Role "}):e.jsx("div",{className:"ml-5",children:"Add Member Role"})}),e.jsx(z,{className:"bg-red-500 hover:bg-red-700  pt-2",onClick:()=>D(o._id),children:e.jsx(Pe,{size:18})})]})]})]},o._id)})})]}),e.jsx(O,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(ue,{page:i,perPage:M,totalPage:(T=(d=s==null?void 0:s.data)==null?void 0:d.data)==null?void 0:T.totalDocs,hasNextPage:(G=(Y=s==null?void 0:s.data)==null?void 0:Y.data)==null?void 0:G.hasNextPage,hasPrevPage:(X=(K=s==null?void 0:s.data)==null?void 0:K.data)==null?void 0:X.hasPrevPage,setPage:v,setPerPage:R})})]})})]})]})]})}function Be(){const[x,i]=t.useState("Workflow Member List");return e.jsx(we,{title:x||"Workflow Member List",subTitle:"Manage all the work Flow List here",children:e.jsx("div",{className:"py-12",children:e.jsx(Fe,{settitle:i})})})}export{Be as default};
