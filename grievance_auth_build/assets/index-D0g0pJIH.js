import{r as m,a as ke,u as De,f as _e,v as j,g as b,b as Re,o as Ee,T as Ge,j as o,F as Ce,Z as i,O as g,A,H as $e,R as p,P as Be,I as he,B as Me,c as Pe,d as c,Q as ze,k as Ue,_ as be}from"./index-CtV24Q57.js";import{S as Ve,a as He,b as qe,c as Oe,U as Je,d as Qe,J as Ke,N as We}from"./roles.config-DTZWg84h.js";import{P as Ze}from"./index-BYiFiVfg.js";const Xe=Pe().shape({ulbId:c().required("ULB  is required"),moduleId:c(),citizenName:c(),mobileNo:c(),email:c(),complaintTypeId:c(),priorityId:c(),targetTypeId:c(),complaintTitle:c(),complaintDescription:c().required("complaint description is required"),complaintDocument:ze().nullable(),tempNo:c(),fixedNo:c(),isTransactionIssue:c(),transactionNo:c(),extraInfo:c(),extraBasicInfo:c()});function Ye(){var _,R,E,G,C,$,B,M,P,z,U,V,H,q,O,J,Q,K,W,Z,X,Y,ee,oe,se,re,le,ne,ie;const[je,ge]=m.useState(!1),[F,Ie]=m.useState(""),[S,fe]=m.useState(""),[we,ve]=m.useState(!1),[ye,Te]=m.useState(!1),{user:n}=ke(),Le=De({}),k=_e(),d=new URLSearchParams(Ue().search).get("complaintId"),{data:s,refetch:Ae}=j({api:`${(_=b)==null?void 0:_.getComplaintDetailsById}/${d}`,key:"getApplicationDetails",options:{enabled:!!d}}),r=Re({resolver:Ee(Xe),defaultValues:{ulbId:(n==null?void 0:n.roleId)===Ve||(n==null?void 0:n.roleId)===He||(n==null?void 0:n.roleId)===qe||(n==null?void 0:n.roleId)===Oe?"":n==null?void 0:n.userUlbId,moduleName:""}}),Fe=async e=>{var u,h,t,x,I,f;try{const l=new FormData;l.append("citizenName",(e==null?void 0:e.citizenName)||""),l.append("email",(e==null?void 0:e.email)||""),l.append("mobileNo",(e==null?void 0:e.mobileNo)||""),l.append("complaintTitle",(e==null?void 0:e.complaintTitle)||""),l.append("complaintDescription",e==null?void 0:e.complaintDescription),l.append("ulb_name",e==null?void 0:e.ulb_name),e!=null&&e.moduleId&&l.append("moduleId",e==null?void 0:e.moduleId),l.append("ulbId",e==null?void 0:e.ulbId),l.append("imageUrl",e==null?void 0:e.complaintDocument),(e==null?void 0:e.tempNo)!==""&&(e==null?void 0:e.tempNo)!==void 0&&l.append("tempNo",e==null?void 0:e.tempNo),(e==null?void 0:e.fixedNo)!==""&&(e==null?void 0:e.fixedNo)!==void 0&&l.append("fixedNo",e==null?void 0:e.fixedNo),(e==null?void 0:e.tempNoLabel)!==""&&(e==null?void 0:e.tempNoLabel)!==void 0&&l.append("tempNoLabel",e==null?void 0:e.tempNoLabel),(e==null?void 0:e.fixedNoLabel)!==""&&(e==null?void 0:e.fixedNoLabel)!==void 0&&l.append("fixedNoLabel",e==null?void 0:e.fixedNoLabel),e!=null&&e.complaintTypeId&&l.append("complaintTypeId",e==null?void 0:e.complaintTypeId),e!=null&&e.priorityId&&l.append("priorityId",e==null?void 0:e.priorityId),e!=null&&e.targetTypeId&&l.append("targetTypeId",e==null?void 0:e.targetTypeId),l.append("isCitizen","2"),l.append("moduleName",(e==null?void 0:e.moduleName)||""),l.append("problemTypeId",(e==null?void 0:e.problemTypeId)||""),l.append("wardNo",(e==null?void 0:e.wardNo)||""),l.append("area",(e==null?void 0:e.area)||""),l.append("latitude",(e==null?void 0:e.latitude)||""),l.append("longitude",(e==null?void 0:e.longitude)||""),l.append("holdingNo",(e==null?void 0:e.holdingNo)||""),l.append("safNo",(e==null?void 0:e.safNo)||""),l.append("consumerNo",(e==null?void 0:e.consumerNo)||""),l.append("grievanceLocation",(e==null?void 0:e.grievanceLocation)||"");let w=b.createComplaintApplication;d&&(l.append("id",d),w=b.updateComplaintApplication);const a=await Le.mutateAsync({api:w,data:l});if((u=a.data)!=null&&u.success){if(be.success((h=a==null?void 0:a.data)==null?void 0:h.message),d)return Ae(),k(`/grievance/dashboard/workflow-details?complaintId=${d}`);k(`/grievance/dashboard/management-complaint-success?complaintRefNo=${(x=(t=a==null?void 0:a.data)==null?void 0:t.data)==null?void 0:x.complaintRefNo}&complaintId=${(f=(I=a==null?void 0:a.data)==null?void 0:I.data)==null?void 0:f._id}`)}else be.error("Grievance not created successfully");r.reset({ulbId:"",moduleId:""})}catch(l){console.log(l)}};m.useEffect(()=>{var e,u,h,t,x,I,f,l,w,a,ce,pe,ae,te,me,de,Ne,xe,ue;d&&s?r.reset({ulbId:((e=s==null?void 0:s.data)==null?void 0:e.ulbId)||"",moduleId:((u=s==null?void 0:s.data)==null?void 0:u.moduleId)||"",fixedNo:((h=s==null?void 0:s.data)==null?void 0:h.fixedNo)||"",tempNo:((t=s==null?void 0:s.data)==null?void 0:t.tempNo)||"",citizenName:((x=s==null?void 0:s.data)==null?void 0:x.citizenName)||"",mobileNo:((I=s==null?void 0:s.data)==null?void 0:I.mobileNo)||"",email:((f=s==null?void 0:s.data)==null?void 0:f.email)||"",complaintTypeId:((l=s==null?void 0:s.data)==null?void 0:l.complaintTypeId)||"",priorityId:((w=s==null?void 0:s.data)==null?void 0:w.priorityId)||"",targetTypeId:((a=s==null?void 0:s.data)==null?void 0:a.targetTypeId)||"",complaintTitle:((ce=s==null?void 0:s.data)==null?void 0:ce.complaintTitle)||"",complaintDescription:((pe=s==null?void 0:s.data)==null?void 0:pe.complaintDescription)||"",problemTypeId:((ae=s==null?void 0:s.data)==null?void 0:ae.problemTypeId)||"",wardNo:((te=s==null?void 0:s.data)==null?void 0:te.wardNo)||"",area:((me=s==null?void 0:s.data)==null?void 0:me.area)||"",holdingNo:((de=s==null?void 0:s.data)==null?void 0:de.holdingNo)||"",safNo:((Ne=s==null?void 0:s.data)==null?void 0:Ne.safNo)||"",consumerNo:((xe=s==null?void 0:s.data)==null?void 0:xe.consumerNo)||"",grievanceLocation:((ue=s==null?void 0:s.data)==null?void 0:ue.grievanceLocation)||""}):(r.reset({ulbId:""}),r.reset({moduleId:""}),r.reset({citizenName:""}),r.reset({mobileNo:""}),r.reset({email:""}),r.reset({complaintTypeId:""}),r.reset({priorityId:""}),r.reset({targetTypeId:""}),r.reset({complaintTitle:""}),r.reset({complaintDescription:""}),r.reset({problemTypeId:""}),r.reset({wardNo:""}),r.reset({area:""}),r.reset({holdingNo:""}),r.reset({safNo:""}),r.reset({consumerNo:""}),r.reset({grievanceLocation:""}))},[d,s]);const N=j({api:Ge,key:"getAllUlb",options:{enabled:!0}}),D=j({api:`${(R=b)==null?void 0:R.getAllModule}?page=1&limit=10000`,key:"geAllModules",options:{enabled:!0}}),v=j({api:`${(E=b)==null?void 0:E.getAllComplaintType}?page=1&limit=10000`,key:"getAllComplaintTypes",options:{enabled:!0}}),y=j({api:`${(G=b)==null?void 0:G.getAllPriority}?page=1&limit=10000`,key:"getAllPriority",options:{enabled:!0}}),T=j({api:`${(C=b)==null?void 0:C.getAllTarget}?page=1&limit=10000`,key:"getAllTargetTypes",options:{enabled:!0}}),Se=j({api:`${b.getAllProblemDirect}?page=1&limit=10000`,key:"getProblemData",options:{enabled:!0,refetchOnMount:!1}}),L=[{wardNo:"1"},{wardNo:"2"},{wardNo:"3"},{wardNo:"4"},{wardNo:"5"},{wardNo:"6"},{wardNo:"7"},{wardNo:"8"},{wardNo:"9"},{wardNo:"10"},{wardNo:"11"},{wardNo:"12"},{wardNo:"13"},{wardNo:"14"},{wardNo:"15"},{wardNo:"16"},{wardNo:"17"},{wardNo:"18"},{wardNo:"19"},{wardNo:"20"},{wardNo:"21"},{wardNo:"22"},{wardNo:"23"},{wardNo:"24"},{wardNo:"25"},{wardNo:"26"},{wardNo:"27"},{wardNo:"28"},{wardNo:"29"},{wardNo:"30"},{wardNo:"31"},{wardNo:"32"},{wardNo:"33"},{wardNo:"34"},{wardNo:"35"},{wardNo:"36"},{wardNo:"37"},{wardNo:"38"},{wardNo:"39"},{wardNo:"40"},{wardNo:"41"},{wardNo:"42"},{wardNo:"43"},{wardNo:"44"},{wardNo:"45"},{wardNo:"46"},{wardNo:"47"},{wardNo:"48"},{wardNo:"49"},{wardNo:"50"}];return m.useEffect(()=>{var e,u,h;if(r.watch("moduleId")){const t=(h=(u=(e=D.data)==null?void 0:e.data)==null?void 0:u.docs)==null?void 0:h.find(x=>(x==null?void 0:x._id)===(r==null?void 0:r.watch("moduleId")));fe(t==null?void 0:t.fixedNoLabel),Ie(t==null?void 0:t.tempNoLabel)}},[r.watch("moduleId")]),m.useEffect(()=>{ve(r.watch("extraInfo"))},[r.watch("extraInfo")]),m.useEffect(()=>{Te(r.watch("extraBasicInfo"))},[r.watch("extraBasicInfo")]),m.useEffect(()=>{ge(r.watch("isTransactionIssue"))},[r.watch("isTransactionIssue")]),o.jsx(Ce,{methods:r,onSubmit:r.handleSubmit(Fe),children:o.jsxs("div",{className:"grid grid-cols-4 gap-x-2 gap-y-4 bg-background p-10",children:[o.jsxs("div",{className:`${((n==null?void 0:n.roleId)===Je||(n==null?void 0:n.roleId)===Qe||(n==null?void 0:n.roleId)===Ke||(n==null?void 0:n.roleId)===We)&&"hidden"}`,children:[o.jsxs(i,{htmlFor:"ulbId",children:[o.jsx("span",{className:"text-red-500",children:"*"}),"ULB"]}),o.jsx(g,{className:"bg-background cursor-pointer",name:"ulbId",data:Array.isArray(($=N==null?void 0:N.data)==null?void 0:$.data)&&((M=(B=N==null?void 0:N.data)==null?void 0:B.data)==null?void 0:M.lenght)!==0?(z=(P=N==null?void 0:N.data)==null?void 0:P.data)==null?void 0:z.map(e=>({value:e.id,label:e.ulb_name})):[]})]}),o.jsx("div",{className:"col-span-4"}),o.jsx("h1",{className:"text-xl font-bold text-blue-800 uppercase",children:"Grievance Info"}),o.jsx(A,{className:"col-span-4"}),o.jsxs("div",{className:"col-span-3",children:[o.jsxs(i,{htmlFor:"complaintDescription",children:[o.jsx("span",{className:"text-red-500",children:"*"}),"Grievance Description"]}),o.jsx($e,{className:"bg-background w-full rounded-md p-4 h-20 border",name:"complaintDescription",placeholder:"write Grievance"})]}),o.jsx("div",{className:"col-span-4"}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(p,{className:"cursor-pointer h-5 w-5",type:"checkbox",name:"extraInfo",placeholder:""}),o.jsx(i,{className:"text-amber-600 opacity-80",children:"Give More Information"})]}),o.jsx("div",{className:"col-span-4"}),we&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{children:[o.jsx(i,{children:"Grievance Location"}),o.jsx(p,{name:"grievanceLocation",inputValidation:["CapitalFirstLetter","removeDoubleSpace","string"],placeholder:""})]}),o.jsxs("div",{children:[o.jsx(i,{children:"Grievance Type"}),o.jsx(g,{selectedText:"problem",className:"bg-background cursor-pointer",name:"problemTypeId",data:((H=(V=(U=Se.data)==null?void 0:U.data)==null?void 0:V.docs)==null?void 0:H.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.problem})))??[]})]}),o.jsxs("div",{children:[o.jsx(i,{htmlFor:"moduleId",children:"Module"}),o.jsx(g,{selectedText:"moduleName",className:"bg-background cursor-pointer",name:"moduleId",data:((J=(O=(q=D.data)==null?void 0:q.data)==null?void 0:O.docs)==null?void 0:J.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.moduleName})))??[]})]}),S&&o.jsxs("div",{children:[o.jsxs(i,{children:[S,o.jsx("span",{className:"text-xs opacity-80"})]}),o.jsx(p,{name:"fixedNo",placeholder:""})]}),F&&o.jsxs("div",{children:[o.jsxs(i,{children:[F,o.jsx("span",{className:"text-xs opacity-80"})]}),o.jsx(p,{name:"tempNo",placeholder:""})]}),o.jsxs("div",{children:[o.jsx(i,{htmlFor:"complaintTypeId",children:"Grievance Type"}),o.jsx(g,{className:"bg-background cursor-pointer",name:"complaintTypeId",data:((W=(K=(Q=v==null?void 0:v.data)==null?void 0:Q.data)==null?void 0:K.docs)==null?void 0:W.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.complaintTypeName})))??[]})]}),o.jsxs("div",{children:[o.jsx(i,{htmlFor:"priorityId",children:"Priority"}),o.jsx(g,{className:"bg-background cursor-pointer",name:"priorityId",data:((Y=(X=(Z=y==null?void 0:y.data)==null?void 0:Z.data)==null?void 0:X.docs)==null?void 0:Y.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.priorityName})))??[]})]}),o.jsxs("div",{children:[o.jsx(i,{htmlFor:"targetTypeId",children:"Target Type"}),o.jsx(g,{className:"bg-background cursor-pointer",name:"targetTypeId",data:((se=(oe=(ee=T==null?void 0:T.data)==null?void 0:ee.data)==null?void 0:oe.docs)==null?void 0:se.map(e=>({value:e._id,label:e==null?void 0:e.targetType})))??[]})]}),o.jsxs("div",{className:"col-span-2 flex",children:[o.jsxs("div",{children:[o.jsxs(i,{children:["Grievance Document",o.jsx("span",{className:"text-xs opacity-80",children:"(acceptable formats are jpg, jpeg, png, pdf)"})]}),o.jsx(Be,{className:"cursor-pointer",accept:"image/jpeg,image/jpg,image/png,application/pdf",name:"complaintDocument",placeholder:"Select document"})]}),o.jsxs("div",{className:"",children:[(((re=r.watch("complaintDocument"))==null?void 0:re.type)=="image/png"||((le=r.watch("complaintDocument"))==null?void 0:le.type)=="image/jpg"||((ne=r.watch("complaintDocument"))==null?void 0:ne.type)=="image/jpeg")&&o.jsx(he,{className:"w-28",src:URL.createObjectURL(r.watch("complaintDocument"))}),((ie=r.watch("complaintDocument"))==null?void 0:ie.type)=="application/pdf"&&o.jsx(he,{className:"w-16 cursor-pointer hover:scale-105",src:"/images/pdf.png"})]})]})]}),o.jsx("div",{className:"col-span-4"}),o.jsx("h1",{className:"text-xl font-bold text-blue-800 uppercase",children:"Basic Info"}),o.jsx(A,{className:"col-span-4"}),o.jsxs("div",{children:[o.jsx(i,{htmlFor:"citizenName",children:"Citizen Name"}),o.jsx(p,{className:"bg-background",name:"citizenName",inputValidation:["CapitalFirstLetter","removeDoubleSpace","string"],placeholder:""})]}),o.jsxs("div",{children:[o.jsx(i,{children:"Mobile No."}),o.jsx(p,{name:"mobileNo",inputValidation:["mobile","number"],placeholder:""})]}),o.jsx("div",{className:"col-span-4"}),o.jsxs("div",{className:"flex items-center space-x-2",children:[o.jsx(p,{className:"cursor-pointer h-5 w-5",type:"checkbox",name:"extraBasicInfo",placeholder:""}),o.jsx(i,{className:"text-amber-600 opacity-80",children:"Give More Information"})]}),o.jsx("div",{className:"col-span-4"}),ye&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{children:[o.jsx(i,{children:"Email"}),o.jsx(p,{inputValidation:["email"],name:"email",placeholder:""})]}),o.jsxs("div",{children:[o.jsx(i,{children:"Ward"}),o.jsx(g,{selectedText:"ward",className:"bg-background cursor-pointer",name:"wardNo",data:(L==null?void 0:L.map(e=>({value:e==null?void 0:e.wardNo,label:e==null?void 0:e.wardNo})))??[]})]}),o.jsxs("div",{children:[o.jsx(i,{children:"Area"}),o.jsx(p,{name:"area",inputValidation:["CapitalFirstLetter","removeDoubleSpace"],placeholder:""})]}),o.jsxs("div",{children:[o.jsx(i,{children:"Holding No."}),o.jsx(p,{name:"holdingNo",maxLength:20,placeholder:""})]}),o.jsxs("div",{children:[o.jsx(i,{children:"Saf No."}),o.jsx(p,{name:"safNo",maxLength:20,placeholder:""})]}),o.jsxs("div",{children:[o.jsx(i,{children:"Consumer No."}),o.jsx(p,{name:"consumerNo",maxLength:20,placeholder:""})]})]}),o.jsx("div",{className:"col-span-4"}),o.jsx("h1",{className:"text-xl font-bold text-blue-800 uppercase",children:"Financial Info"}),o.jsx(A,{className:"col-span-4"}),o.jsxs("div",{className:"col-span-2  flex items-center space-x-2",children:[o.jsx(p,{className:"cursor-pointer h-5 w-5",type:"checkbox",name:"isTransactionIssue",placeholder:""}),o.jsx(i,{className:"text-amber-600 opacity-80",children:"Is issue related with financial transaction"})]}),o.jsx("div",{className:"col-span-4"}),je&&o.jsxs("div",{children:[o.jsx(i,{children:"Transaction No."}),o.jsx(p,{name:"transactionNo",placeholder:""})]}),o.jsx("div",{className:"col-span-4"}),o.jsx("div",{className:"col-span-4",children:o.jsx(Me,{isLoading:r.formState.isSubmitting,type:"submit",className:" w-auto rounded-xl px-10 float-right",children:d?"Update":"Submit"})})]})})}function no(){return o.jsx(Ze,{title:"Grievance Details",subTitle:"Grievance Registration Form",children:o.jsx("div",{className:"",children:o.jsx(Ye,{})})})}export{no as default};
