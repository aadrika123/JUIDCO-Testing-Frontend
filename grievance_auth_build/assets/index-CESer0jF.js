import{u as W,G as J,v as T,g as j,b as X,o as Z,r as h,j as a,D as aa,F as ea,O as sa,R as M,A as Q,B as ta,c as da,d as A,_ as o,K as O,w as ra,x as la,M as na,y as ca,S as ia,z as oa}from"./index-Di_aGywo.js";import{P as ua}from"./index-skYvmoQE.js";import{T as ha,a as xa,b as V,c as i,d as ga,e as c}from"./table-Dsc_-o8o.js";import{g as ja}from"./services-KQnp_8oA.js";import{P as fa}from"./index-BZMvf5fs.js";import{S as pa}from"./index-BlXwAL63.js";import{q as ba}from"./switch-srrB9iMr.js";const Na=da().shape({latitude:A().required("titleName Name is required"),longitude:A().required("Longitude is required"),radius:A().required("Radius is required"),ulbId:A().required("Ulb id is required")});function ya({open:I,setOpen:x,title:q,id:g,edit:u,setEdit:f,refetch:E}){var P,$,b;const F=W({}),p=J({}),{data:r,isFetching:C}=T({api:`${j.getLocationById}/${g}`,key:"getLocationById",options:{enabled:u}}),l=X({defaultValues:{latitude:"",longitude:"",radius:"",ulbId:""},resolver:Z(Na)}),m=async n=>{var N,y,L,v;try{if(u&&n){const t=await p.mutateAsync({api:`${j.updateLocation}/${g}`,data:n});(N=t.data)!=null&&N.success?o.success((y=t==null?void 0:t.data)==null?void 0:y.message):o.error("Location not updated successfully")}else{const t=await F.mutateAsync({api:j.createLocation,data:n});(L=t.data)!=null&&L.success?o.success((v=t==null?void 0:t.data)==null?void 0:v.message):o.error("Location not created successfully"),l.reset({latitude:"",longitude:"",radius:"",ulbId:""})}x(!1),f(!1),E()}catch(t){console.log(t)}};h.useEffect(()=>{u&&r?l.reset({latitude:r.data.latitude,longitude:r.data.longitude,radius:r.data.radius,ulbId:r.data.ulbId}):l.reset({latitude:"",longitude:"",radius:"",ulbId:""})},[u,r]);const s=T({api:`${j.getAllUlb}?page=1&limit=1000`,key:"getAllUlb",options:{enabled:!0}});return a.jsx(aa,{open:I,setOpen:x,title:q,setEdit:f,edit:u,isLoading:C,children:a.jsx(ea,{methods:l,onSubmit:l.handleSubmit(m),children:a.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[a.jsx("div",{children:a.jsx(sa,{name:"ulbId",data:((b=($=(P=s.data)==null?void 0:P.data)==null?void 0:$.docs)==null?void 0:b.map(n=>({value:n._id,label:n.ulb_name})))??[]})}),a.jsx("div",{children:a.jsx(M,{name:"latitude",placeholder:"Enter latitude"})}),a.jsx("div",{children:a.jsx(M,{name:"longitude",placeholder:"Enter longitude"})}),a.jsx("div",{children:a.jsx(M,{name:"radius",placeholder:"Enter radius"})}),a.jsx(Q,{}),a.jsx("div",{children:a.jsx(ta,{isLoading:l.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}function La(){var b,n,N,y,L,v,t,k,B,_,R;const I=J({}),[x,q]=h.useState(1),[g,u]=h.useState(10),[f,E]=h.useState(""),[F,p]=h.useState(!1),[r,C]=h.useState(""),[l,m]=h.useState(!1),s=T({api:`${j.getAllLocation}?page=${x}&limit=${g}&q=${f}`,key:"getAllLocation",value:[x,g],options:{enabled:!0}}),P=e=>{m(!0),p(!0),C(e)},$=async e=>{var w,S,H,U,Y,z,D,G,K;try{const d=await I.mutateAsync({api:`${(w=j)==null?void 0:w.updateLocationStatus}/${e}`,data:{id:r}});(S=d==null?void 0:d.data)!=null&&S.success?(s.refetch(),((U=(H=d==null?void 0:d.data)==null?void 0:H.data)==null?void 0:U.status)==1&&o.success((Y=d.data)==null?void 0:Y.message),((D=(z=d==null?void 0:d.data)==null?void 0:z.data)==null?void 0:D.status)==0&&o.error((G=d.data)==null?void 0:G.message)):o.error((K=d.data)==null?void 0:K.message)}catch(d){o.error(ja(d))}};return a.jsxs("main",{className:"grid items-start",children:[a.jsx(ya,{open:F,setOpen:p,title:l?"Edit Location":"Add Location",id:r,edit:l,setEdit:m,refetch:s.refetch}),a.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[a.jsxs("div",{className:"flex w-full justify-between gap-2",children:[a.jsx("div",{children:a.jsx(pa,{search:f,setSearch:E,refetch:s.refetch,isFetching:s.isLoading})}),a.jsx("div",{children:a.jsx(O,{className:"flex items-center gap-2",onClick:()=>p(!0),children:"Add New"})})]}),a.jsxs(ra,{children:[a.jsx(la,{className:"px-7",children:a.jsxs(na,{children:["Location List (",(n=(b=s.data)==null?void 0:b.data)==null?void 0:n.totalDocs,")"]})}),a.jsx(ca,{children:s.isLoading?a.jsx("div",{className:"flex h-32 items-center justify-center",children:a.jsx(ia,{})}):a.jsxs(a.Fragment,{children:[a.jsxs(ha,{children:[a.jsx(xa,{children:a.jsxs(V,{children:[a.jsx(i,{className:"",children:"#"}),a.jsx(i,{className:"",children:"Ulb"}),a.jsx(i,{className:"",children:"Latitude"}),a.jsx(i,{className:"",children:"Longitude"}),a.jsx(i,{className:"",children:"Radius(In Meter)"}),a.jsx(i,{className:"",children:"Id"}),a.jsx(i,{className:"",children:"Status"}),a.jsx(i,{children:"Action"})]})}),a.jsx(ga,{children:(L=(y=(N=s==null?void 0:s.data)==null?void 0:N.data)==null?void 0:y.docs)==null?void 0:L.map((e,w)=>{var S;return a.jsxs(V,{children:[a.jsx(c,{children:w+1}),a.jsx(c,{children:(S=e==null?void 0:e.ulb)==null?void 0:S.ulbName}),a.jsx(c,{children:e==null?void 0:e.latitude}),a.jsx(c,{children:e==null?void 0:e.longitude}),a.jsx(c,{children:e==null?void 0:e.radius}),a.jsx(c,{children:e==null?void 0:e._id}),a.jsx(c,{children:oa(e==null?void 0:e.createdAt).format("DD-MM-YYYY")}),a.jsx(c,{children:a.jsxs(ba,{checked:(e==null?void 0:e.status)==1,onChange:()=>$(e==null?void 0:e._id),className:`${e!=null&&e.status?"bg-primary":"bg-gray-200"} relative inline-flex items-center h-6 rounded-full w-11`,children:[a.jsx("span",{className:"sr-only",children:"Enable notifications"}),a.jsx("span",{className:`${e!=null&&e.status?"translate-x-6":"translate-x-1"} inline-block w-4 h-4 transform bg-white rounded-full`})]})}),a.jsx(c,{children:a.jsx(O,{className:"bg-primary",onClick:()=>P(e==null?void 0:e._id),children:"Edit"})})]},e==null?void 0:e._id)})})]}),a.jsx(Q,{className:"mb-2 mt-4"}),a.jsx("div",{className:"flex w-full justify-end",children:a.jsx(fa,{page:x,perPage:g,totalPage:(t=(v=s==null?void 0:s.data)==null?void 0:v.data)==null?void 0:t.totalDocs,hasNextPage:(B=(k=s==null?void 0:s.data)==null?void 0:k.data)==null?void 0:B.hasNextPage,hasPrevPage:(R=(_=s==null?void 0:s.data)==null?void 0:_.data)==null?void 0:R.hasPrevPage,setPage:q,setPerPage:u})})]})})]})]})]})}function Ia(){return a.jsx(ua,{title:"Location List",subTitle:"Manage all the Location here",children:a.jsx("div",{className:"py-12",children:a.jsx(La,{})})})}export{Ia as default};
