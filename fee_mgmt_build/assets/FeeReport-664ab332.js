import{a as W,r as Q,j as s,R as T,b as y,A as U}from"./index-dd1288ad.js";import{u as Y,F as G,a as J}from"./formik.esm-5fbe598e.js";import{c as O,a as $}from"./index.esm-e655e2bf.js";import{C as X}from"./index-0f60d4d6.js";import{a as Z}from"./index.esm-a97a4a89.js";import{S as f,L as a}from"./LoadingButton-8b46375a.js";import"./TextField-b2648471.js";import{F as ee}from"./index.esm-50ab5176.js";import{P as se}from"./Page-c37fa378.js";import{B as re}from"./Breadcrumb-5eaf1e4d.js";import{u as j}from"./useQuery-53a02e0f.js";const De=()=>{var d,b,v,D,F,A,S,I;const{api_class:E,api_fy:M,api_fee_report:k,api_month_active_all:z}=U,B=W(),[N,K]=Q.useState(!1),P=(e,r,o,l)=>{B("/fee/fee-collection",{state:{fyId:e,classId:r,admissionNo:o,className:l}})},{data:u,isLoading:le,error:ne}=j({queryKey:["month"],queryFn:async()=>(await y.post(`${z}`,{})).data.data}),{data:h,isLoading:ce,error:oe}=j({queryKey:["fy"],queryFn:async()=>(await y.post(`${M}`,{})).data.data}),{data:p,isLoading:ie,error:me}=j({queryKey:["class"],queryFn:async()=>(await y.post(`${E}`,{})).data.data}),R=O({fyId:$().required("Required"),classId:$().required("Required")}),x=Y({initialValues:{fyId:"1",classId:"",monthId:""},onSubmit:async e=>{V()},validationSchema:R}),{data:n,isLoading:te,error:xe,refetch:V,isFetching:g}=j({queryKey:["feeReport"],queryFn:async()=>{const e=await y.post(`${k}`,{fyId:x.values.fyId,classId:x.values.classId,monthId:x.values.monthId});return{...e.data,data:e.data.data.flatMap(r=>r).filter(r=>(r==null?void 0:r.feeDtl.length)>0)}},enabled:!1});return console.log("asdas",n),s.jsxs(se,{title:"Class Wise Fee Report",pageName:"Class Wise Fee Report",children:[s.jsx(re,{list:[{title:"Home",path:"/home"},{title:"Class Wise Fee Report",path:"#"}]}),s.jsxs("div",{className:"px-5 py-1 flex justify-end cursor-pointer",children:[s.jsx(Z,{size:30,color:"green",onClick:()=>K(!N)}),N&&s.jsx(X,{data:[["Month Name","Class Name","Admission No","Student Name","Fee Head","Amount","Received Amount","Due Amount","Date"],...(d=n==null?void 0:n.flatMap(e=>e))==null?void 0:d.map(e=>{var r,o;return[e==null?void 0:e.monthName,e==null?void 0:e.class,(r=e==null?void 0:e.studentDtl)==null?void 0:r.admission_no,(o=e==null?void 0:e.studentDtl)==null?void 0:o.full_name,e==null?void 0:e.feeDtl.map(l=>l==null?void 0:l.feeHeadName),e==null?void 0:e.feeDtl.map(l=>l==null?void 0:l.amount).join(", "),e==null?void 0:e.feeDtl.map(l=>l==null?void 0:l.receivedAmount).join(", "),e==null?void 0:e.feeDtl.map(l=>l==null?void 0:l.dueAmount).join(", "),e==null?void 0:e.feeDtl.map(l=>l==null?void 0:l.dt).join(", ")]})],target:"_blank"})]}),s.jsx("div",{className:"border p-6 mx-auto w-[97%]",children:s.jsx(G,{value:x,children:s.jsx(J,{autoComplete:"off",onSubmit:x.handleSubmit,children:s.jsx("div",{className:"lg:px-52 mx-auto px-6 justify-center lg:ml-28",children:s.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-4 content-center",children:[s.jsx("div",{children:s.jsx(f,{name:"fyId",label:"Financial Year",formik:x,isRequiredLabel:!0,size:"xs",children:(h==null?void 0:h.length)>0&&(h==null?void 0:h.map(e=>s.jsx("option",{value:e==null?void 0:e.id,children:e==null?void 0:e.financial_year})))})}),s.jsx("div",{children:s.jsx(f,{name:"classId",label:"Select Class",formik:x,isRequiredLabel:!0,size:"xs",children:p&&(p==null?void 0:p.map(e=>s.jsx("option",{value:e==null?void 0:e.id,children:e==null?void 0:e.class_name})))})}),s.jsx("div",{children:s.jsxs(f,{name:"monthId",label:"Month",formik:x,isRequiredLabel:!0,size:"xs",isBlankSelect:!0,children:[s.jsx("option",{value:"",children:"Select All"}),u&&(u==null?void 0:u.map((e,r)=>s.jsx("option",{value:e==null?void 0:e.id,children:e==null?void 0:e.month_name},r)))]})}),s.jsx("div",{children:s.jsx("div",{className:"mt-7",children:s.jsxs(a,{color:"primary",type:"submit",className:"rounded-lg",isLoading:g,size:"xs",children:[" ","Search"," "]})})})]})})})})}),s.jsx("div",{className:"w-[24rem] lg:w-full overflow-x-auto px-6 mx-auto py-3",children:g?s.jsx("div",{role:"status",className:"animate-pulse",children:Array(10).fill("").map((e,r)=>s.jsxs(T.Fragment,{children:[s.jsx("div",{className:"h-8 bg-gray-200 rounded-xxl dark:bg-gray-700 w-full mb-4"}),s.jsx("span",{className:"sr-only",children:"Loading..."})]},r))}):s.jsx(s.Fragment,{children:n&&((b=n==null?void 0:n.data)==null?void 0:b.length)>0?s.jsxs("table",{className:"w-full",children:[s.jsx("thead",{className:"text-md ",children:s.jsxs("tr",{className:"text-white bg-[#0F766E]",children:[s.jsx("th",{scope:"col",className:" py-5  text-center ",children:"Sl No."}),s.jsx("th",{scope:"col",className:" py-5  text-center ",children:"Month Name"}),s.jsx("th",{scope:"col",className:" py-5  text-center ",children:"Class"}),s.jsx("th",{scope:"col",className:" py-5  text-center",children:"Admission No"}),s.jsx("th",{scope:"col",className:" py-5  text-center",children:"Student Name"}),s.jsx("th",{scope:"col",className:" py-5  text-center",children:"Fee Head"}),s.jsx("th",{scope:"col",className:" py-5  text-center",children:"Amount"}),s.jsx("th",{scope:"col",className:" py-5  text-center",children:"Received Amount"}),s.jsx("th",{scope:"col",className:" py-5  text-center",children:"Due Amount"}),s.jsx("th",{scope:"col",className:" py-5  text-center",children:"Updated Date"}),s.jsx("th",{scope:"col",className:" py-5  text-center",children:"Action"})]})}),s.jsxs("tbody",{children:[((v=n==null?void 0:n.data)==null?void 0:v.length)<=0&&s.jsx("tr",{children:s.jsx("td",{colSpan:"8",className:"text-center  text-gray-500",children:s.jsx("div",{className:"mt-6 text-xl font-semibold",children:"No data found..."})})}),((D=n==null?void 0:n.data)==null?void 0:D.length)>0&&((F=n==null?void 0:n.data)==null?void 0:F.map((e,r)=>{var o,l,m,L,_,q,H,w,C;return s.jsxs("tr",{className:` ${((l=(o=e==null?void 0:e.feeDtl)==null?void 0:o.map(c=>c==null?void 0:c.dueAmount))==null?void 0:l.reduce((c,i)=>c+i,0))>0?"bg-red-100":r%2===0?"bg-white":"bg-slate-100"} `,children:[s.jsx("td",{className:" py-5  text-center border border-gray-400 ",children:r+1}),s.jsx("td",{className:" py-5  text-center border border-gray-400",children:e==null?void 0:e.monthName}),s.jsx("td",{className:" py-5  text-center border border-gray-400",children:e==null?void 0:e.class}),s.jsx("td",{className:" py-5  text-center border border-gray-400",children:(m=e==null?void 0:e.studentDtl)==null?void 0:m.admission_no}),s.jsx("td",{className:" py-5  text-center border border-gray-400",children:(L=e==null?void 0:e.studentDtl)==null?void 0:L.full_name}),s.jsx("td",{className:" py-5  text-center border border-gray-400",children:(_=e==null?void 0:e.feeDtl)==null?void 0:_.map(c=>{var i,t;return s.jsx("div",{className:`${c.feeHeadName===((t=e==null?void 0:e.feeDtl[((i=e==null?void 0:e.feeDtl)==null?void 0:i.length)-1])==null?void 0:t.feeHeadName)?"":"border-b py-2"} `,children:c.feeHeadName})})}),s.jsx("td",{className:" py-5  text-center border border-gray-400",children:(q=e==null?void 0:e.feeDtl)==null?void 0:q.map(c=>{var i,t;return s.jsx("div",{className:`${c.feeHeadName===((t=e==null?void 0:e.feeDtl[((i=e==null?void 0:e.feeDtl)==null?void 0:i.length)-1])==null?void 0:t.feeHeadName)?"":"border-b py-2 border-gray-400"} `,children:c.amount})})}),s.jsx("td",{className:" py-5  text-center border border-gray-400",children:(H=e==null?void 0:e.feeDtl)==null?void 0:H.map(c=>{var i,t;return s.jsx("div",{className:`${c.feeHeadName===((t=e==null?void 0:e.feeDtl[((i=e==null?void 0:e.feeDtl)==null?void 0:i.length)-1])==null?void 0:t.feeHeadName)?"":"border-b py-2 border-gray-400"} `,children:c.receivedAmount})})}),s.jsx("td",{className:" py-5  text-center border border-gray-400",children:(w=e==null?void 0:e.feeDtl)==null?void 0:w.map(c=>{var i,t;return s.jsx("div",{className:`${c.feeHeadName===((t=e==null?void 0:e.feeDtl[((i=e==null?void 0:e.feeDtl)==null?void 0:i.length)-1])==null?void 0:t.feeHeadName)?"":"border-b py-2 border-gray-400"} `,children:c.dueAmount})})}),s.jsx("td",{className:" py-5  text-center border border-gray-400",children:(C=e==null?void 0:e.feeDtl)==null?void 0:C.map(c=>{var i,t;return s.jsx("div",{className:`${c.feeHeadName===((t=e==null?void 0:e.feeDtl[((i=e==null?void 0:e.feeDtl)==null?void 0:i.length)-1])==null?void 0:t.feeHeadName)?"":"border-b py-2 border-gray-400"} `,children:c==null?void 0:c.dt})})}),s.jsx("td",{className:" py-5  text-center border border-gray-400",children:s.jsx("div",{className:"flex justify-center",children:s.jsx(ee,{color:"green",size:20,onClick:()=>{P(e==null?void 0:e.fyId,e==null?void 0:e.classId,e==null?void 0:e.admissionNo,e==null?void 0:e.class)}})})})]},r)})),(n==null?void 0:n.length)>0&&s.jsxs("tr",{className:" border border-gray-400 hover:bg-slate-100 bg-slate-200",children:[s.jsx("td",{colSpan:"6",className:" py-5  text-center font-semibold border border-gray-400",children:"Total"}),s.jsx("td",{className:" py-5  text-center font-semibold border border-gray-400",children:(A=n==null?void 0:n.flatMap(e=>e))==null?void 0:A.reduce((e,r)=>{var o;return e+((o=r==null?void 0:r.feeDtl)==null?void 0:o.reduce((l,m)=>l+(m==null?void 0:m.amount),0))},0)}),s.jsx("td",{className:"py-5  text-center font-semibold border border-gray-400",children:(S=n==null?void 0:n.flatMap(e=>e))==null?void 0:S.reduce((e,r)=>{var o;return e+((o=r==null?void 0:r.feeDtl)==null?void 0:o.reduce((l,m)=>l+(m==null?void 0:m.receivedAmount),0))},0)}),s.jsx("td",{scope:"col",colSpan:"3",className:" py-5 text-start font-semibold border border-gray-400",children:s.jsx("div",{className:"ml-14",children:(I=n==null?void 0:n.flatMap(e=>e))==null?void 0:I.reduce((e,r)=>{var o;return e+((o=r==null?void 0:r.feeDtl)==null?void 0:o.reduce((l,m)=>l+(m==null?void 0:m.dueAmount),0))},0)})}),s.jsx("td",{}),s.jsx("td",{})]})]})]}):s.jsx("div",{className:"flex justify-center items-center",children:s.jsx("h1",{className:"text-xl text-gray-400",children:"No Data Found"})})})})]})};export{De as default};
