import{j as e}from"./mui-8bd1858b.js";import{f as te,r as l,u as oe,h as ae}from"./router-56e993c5.js";import{o as se,c as le,d as V,u as ie,R as ne,b as re,aq as C,p as L,i as de,C as ce}from"./index-44fe4f08.js";import{a as T}from"./axios-ab7cc016.js";import me from"./MobileNoCard-3f5a6fcd.js";import pe from"./OtpCard-43694ee7.js";import{C as ge}from"./CommonModal-f6cb1fda.js";import{S as xe}from"./ServerErrorCard-11df06de.js";import{E as ue}from"./EPramanLoginLoader-580dab38.js";import"./reactIcons-d26c0b2d.js";import"./materialTailwind-80676409.js";import"./moment-a9aaa855.js";import"./redux-a3f69129.js";import"./i18next-2edfafb0.js";import"./BarLoader-d40f3cdf.js";import"./BottomErrorCard-af61afc3.js";const be="/assets/login2-88f52aba.svg",_e=()=>{const{via:D}=te(),[I,h]=l.useState(!1),[O,j]=l.useState(!1),[A,N]=l.useState(!1),{api_citizenLogin2:R,api_ePramanLogin:P}=ce(),[q,B]=l.useState(null),[$,k]=l.useState(!1),{notify:w,setheartBeatCounter:Y}=l.useContext(se),r=oe(),[H,S]=l.useState();l.useState(!0);const U=()=>{window.localStorage.getItem("citizen_token")?r("/landingDashboard"):console.log("=========================not tooken")},v=ae(),W=()=>{let a=v==null?void 0:v.search,t=a==null?void 0:a.split("?")[1],i=t==null?void 0:t.split("&");const n={};i==null||i.forEach(o=>{const[d,c]=o.split("=");n[d]=c}),console.log(n),k(!0);let m={codeVerifier:window.localStorage.getItem("codeVerifier"),nonce:window.localStorage.getItem("nonce"),code:n==null?void 0:n.code,type:"citizen"};T.post(P,m,re()).then(o=>{var d,c,p,g,x,u,b,f,y,M,z,F,_;console.log(`E-Pramaan login response: 
`,o),(d=o==null?void 0:o.data)!=null&&d.status?(window.localStorage.removeItem("codeVerifier"),window.localStorage.removeItem("nonce"),window.localStorage.setItem("citizenMobile",(p=(c=o==null?void 0:o.data)==null?void 0:c.data)==null?void 0:p.mobile),window.localStorage.setItem("citizenName",(x=(g=o==null?void 0:o.data)==null?void 0:g.data)==null?void 0:x.userName),window.localStorage.setItem("citizen_token",(b=(u=o==null?void 0:o.data)==null?void 0:u.data)==null?void 0:b.token),window.localStorage.setItem("epramaanToken",(M=(y=(f=o==null?void 0:o.data)==null?void 0:f.data)==null?void 0:y.eparmanToken)==null?void 0:M.respose_json),window.localStorage.setItem("citizenId",(F=(z=o==null?void 0:o.data)==null?void 0:z.data)==null?void 0:F.id),r("/landingDashboard")):(C.error(L((_=o==null?void 0:o.data)==null?void 0:_.message,P,m)),C.error("Oops! Please try again later."),r("/"))}).catch(o=>{console.log(`E-Pramaan login error: 
`,o),C.error("Oops! Please try again later."),r("/")}).finally(()=>{k(!1)})};l.useEffect(()=>{D=="e-pramaan"?W():U()},[]);const Z=le().shape({mobile:V().required("Enter mobile no. !").min(10).max(10),password:V().min(6,"Minimum six character !").max(50,"Too Long!").required("Enter password no. !").matches(/^(?=.*\d)(?=.*[!@#$%^&*])(?=.*[a-z])(?=.*[A-Z]).{6,}$/,"Password Must Contains (Capital, Smail, Number, Special) eg - Abc123#.")}),s=ie({initialValues:{mobile:"",password:""},onSubmit:a=>{console.log("post data",a),G(a)},validationSchema:Z}),G=a=>{S(""),h(!0),E(!1),T.post(R,{mobile:a==null?void 0:a.mobile,password:a==null?void 0:a.password}).then(t=>{var i,n,m,o,d,c,p,g,x,u,b,f;console.log("response after login....",t==null?void 0:t.data),((i=t==null?void 0:t.data)==null?void 0:i.status)===!0?(localStorage.setItem("citizen_token",(m=(n=t==null?void 0:t.data)==null?void 0:n.data)==null?void 0:m.token),h(!1),w("Login Success","success"),window.localStorage.setItem("citizenMobile",(d=(o=t==null?void 0:t.data)==null?void 0:o.data)==null?void 0:d.mobile),window.localStorage.setItem("citizenName",(p=(c=t==null?void 0:t.data)==null?void 0:c.data)==null?void 0:p.userName),window.localStorage.setItem("citizenId",(x=(g=t==null?void 0:t.data)==null?void 0:g.data)==null?void 0:x.id),Y(y=>y+1),r("/landingDashboard")):(console.log("Login Failed",(u=t==null?void 0:t.data)==null?void 0:u.message),w(L((b=t==null?void 0:t.data)==null?void 0:b.message),"error"),h(!1)),console.log("=== Invalid Details",t),S(L((f=t==null?void 0:t.data)==null?void 0:f.message))}).catch(t=>{S("Oops! Please try again later."),console.log(t),console.log("-Exception--",t),h(!1),E(!0),w("something went wrong !!","error")})},J=a=>{let t=a.target.name,i=a.target.value;t=="mobile"&&s.setFieldValue("mobile",de(i,s.values.mobile,10))},K=()=>{w("Mobile no. has been verified successfully !","success"),r("/change-password/forgot")},Q=()=>{j(!1)},X=()=>{N(!1)},[ee,E]=l.useState(!1);return ee?e.jsx(ge,{children:e.jsx(xe,{title:"Server is busy",desc:"Server is too busy to respond. Please try again later.",buttonText:"View Dashboard",buttonUrl:"/propertyDashboard"})}):O?e.jsx(me,{cardFor:"Login",closeMobileModal:Q,headTitle:"Forgot Password",title:"Enter mobile to get OTP",desc:"Enter your mobile no, which is attached to your account.",setverifedMobileNo:B,setmobileCardStatus:j,setotpCardStatus:N}):A?e.jsx(pe,{verifedMobileNo:q,closeOtpModal:X,bottomNaviation:!0,headTitle:"Forgot OTP",callback:K,setotpCardStatus:N}):e.jsxs(e.Fragment,{children:[$&&e.jsx(ue,{message:"Login Via E-Pramaan"}),e.jsx("div",{className:" flex items-center justify-center text-center mt-6 md:p-0 mx-auto bg-white md:bg-none shadow-lg md:shadow-none w-full h-full",children:e.jsx("div",{className:" w-full h-full flex justify-center",children:e.jsx("form",{onChange:J,onSubmit:s.handleSubmit,className:"md:w-[60%] w-full md:h-[60%]",children:e.jsxs("div",{className:"grid grid-cols-12 px-6 md:px-0 drop-shadow-md w-full",children:[e.jsx("div",{className:"col-span-6 hidden md:py-10 bg-slate-100 p-5 md:flex justify-center items-center border-r",children:e.jsx("img",{src:be,className:"hue-rotate-[-30deg] w-[80%]"})}),e.jsx("div",{className:"w-full md:px-10 col-span-12 md:col-span-6 md:shadow-none bg-white py-10 px-4",children:e.jsxs("div",{className:"w-full  pb-6 pt-0 md:py-6 md:mt-10 text-gray-700",children:[e.jsx("h1",{className:"text-center text-md font-semibold md:my-1 capitalize w-full"}),e.jsx("h1",{className:"text-center font-semibold my-1 flex justify-center",children:e.jsxs("span",{className:"px-1 text-semibold text-2xl -mt-5 mb-4 border-b-2 border-b-[#99B37C]",children:["Log In"," "]})}),e.jsxs("div",{className:"my-3 relative text-sm",children:[e.jsxs("div",{className:"text-gray-600 static mb-1 font-semibold text-left px-8 md:px-10 ",children:["Mobile No.",e.jsx("span",{className:"text-red-500 font-bold",children:"*"})]}),e.jsx("input",{type:"text",min:0,...s.getFieldProps("mobile"),className:"cypress_mobile border-b border-b-gray-200 focus:border-b focus:border-b-indigo-500  pl-2 px-3 py-1 w-full md:w-5/6 shadow-sm h-10 outline-none border border-solid border-gray-300 rounded hover:bg-gray-100",placeholder:"Enter Your mobile"}),e.jsx("div",{children:e.jsx("span",{className:"text-red-600 absolute text-xs",children:s.touched.mobile&&s.errors.mobile?s.errors.mobile:null})})]}),e.jsxs("div",{className:"my-3 relative text-sm mt-4",children:[e.jsxs("div",{className:"text-gray-600 static mb-1 font-semibold text-left px-8 md:px-10",children:["Password"," ",e.jsx("span",{className:"text-red-500 font-bold",children:"*"})]}),e.jsx("input",{type:"password",...s.getFieldProps("password"),className:"cypress_password border-b border-b-gray-200 focus:border-b focus:border-b-indigo-500  pl-2 px-3 py-1 w-full md:w-5/6 shadow-sm h-10 outline-none border border-solid border-gray-300 rounded hover:bg-gray-100",placeholder:"Enter Your Password"}),e.jsx("div",{children:e.jsx("span",{className:"text-red-600 absolute text-xs",children:s.touched.password&&s.errors.password?s.errors.password:null})})]}),e.jsx("div",{className:" my-10"}),e.jsx("div",{className:"text-center mt-3 text-xs"}),e.jsxs("div",{className:"my-5 self-center justify-self-center relative",children:[e.jsxs("div",{className:"text-red-600 text-sm font-semibold my-3 ",children:[" ",e.jsxs("span",{className:"",children:[" ",H]})]}),I?e.jsx("div",{className:"flex justify-center",children:e.jsx(ne,{strokeColor:"grey",strokeWidth:"5",animationDuration:"0.75",width:"25",visible:!0})}):e.jsx("button",{type:"submit",disabled:I,className:"cypress_button_login bg-[#99B37C] hover:bg-[#99B37C] px-20 shadow-xl py-2  rounded-md text-white text-lg font-semibold",children:"Login"})]}),e.jsx("div",{className:"flex flex-row flex-wrap gapx-x-2 gap-y-2 w-full poppins justify-center",children:e.jsx("span",{className:"text-gray-700 text-sm font-semibold cursor-pointer md:w-[40%] w-full",onClick:()=>j(!0),children:"Forgot Password"})}),e.jsx("div",{className:"w-full flex justify-center mt-10",children:e.jsx("span",{onClick:()=>r("/register"),className:"hover:underline text-gray-700 font-semibold hover:bg-white px-3 py-1 cursor-pointer float-right",children:"Register"})})]})})]})})})})]})};export{_e as default};
