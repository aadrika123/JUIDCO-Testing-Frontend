import{j as e}from"./mui-8bd1858b.js";import{u as Y,r as g,f as ue,b as pe}from"./router-56e993c5.js";import{o as H,W as J,c as fe,d as q,u as ye,A as L,w as re,R as me,b as be,a2 as de,M as je}from"./index-44fe4f08.js";import"./RazorpayPaymentScreen-70677a63.js";import{i as Ne}from"./success-39308b33.js";import{a as Ie}from"./axios-ab7cc016.js";import{a as he}from"./index.esm-6017d94b.js";import{U as xe}from"./UseRazorpay-4579b10c.js";import{h as ge}from"./useRazorPayForApp-00a62b48.js";const ve="/assets/pending-daaf9508.png",we=c=>{var z,O,A,F,M,W,T,E,G;const{handlePayment:R}=xe(),_=Y(),[C,u]=g.useState(!1),[t,v]=g.useState(!1),[o,U]=g.useState(""),{notify:k}=g.useContext(H),{api_WaterGetDetailsById:m,header:y,api_rzpWaterOrderId:b,api_generatedreceipt:j}=J(),d=c==null?void 0:c.paymentData;console.log("props paymentData==>>",d);const p=n=>{if(!(n==null||n==""))return JSON.parse(n)},w=fe({isInstallment:q().required("Require"),installment:q().when([],{is:()=>s.values.isInstallment=="yes",then:q().required("Select Installment")})}),s=ye({enableReinitialize:!0,initialValues:{isInstallment:"no",installment:""},onSubmit:n=>{i(n)},validationSchema:w}),P=n=>{var I,V,B;const r=n.target.name,h=n.target.value;console.log("name",r,"vlue",h),h=="no"&&(console.log("Done.."),s.setFieldValue("installment","")),r=="installment"&&((I=p(h))==null?void 0:I.amount)==Number((V=o==null?void 0:o.calculation)==null?void 0:V.penalty)&&((B=o==null?void 0:o.calculation)==null?void 0:B.paidStatus)!=1&&(s.setFieldValue("installment",""),s.setFieldValue("isInstallment","no"))},l=()=>{c.closeModal()};g.useEffect(()=>{var n,r;((n=o==null?void 0:o.calculation)==null?void 0:n.paidStatus)==1&&((r=o==null?void 0:o.calculation)==null?void 0:r.chargeCatagoryId)==2&&s.setFieldValue("isInstallment","yes")},[o]);const f=()=>{var n;v(!0),console.log("before fetch property details in deactivation"),Ie.post(m,{applicationId:(n=d==null?void 0:d.connectionCharges)==null?void 0:n.applicationId},y).then(function(r){console.log("view water details by id...",r.data.data),U(r.data.data),v(!1)}).catch(function(r){console.log("==2 details by id error...",r),v(!1),k("Something Went Wrong","error")})};g.useEffect(()=>{f()},[d]);const x=async n=>{console.log("generateReceipt",n),console.log(n);let r={applicationId:n==null?void 0:n.applicationId,departmentId:n==null?void 0:n.departmentId,status:"",captured:"1",card_id:"",amount:n==null?void 0:n.amount,payment_method:"upi/netbanking",workflow_id:n==null?void 0:n.workflowId,user_id:n==null?void 0:n.userId,ulb_id:n==null?void 0:n.ulbId,user_id:localStorage.getItem("citizenId"),payment_order_id:n==null?void 0:n.razorpay_order_id,payment_id:n==null?void 0:n.razorpay_payment_id,created_at:""};console.log("Receipt",n),L.post(j,r,y).then(h=>{var I;console.log("genereted receipt",h),h.data.status==!0?(console.log("Oder ID Generated ++++dddddddddddddddddddddddd+++++",h.data),_(`/waterConnReceipt/${(I=h==null?void 0:h.data)==null?void 0:I.data}`,{replace:!0})):toast.error(h.data.message,"error")}).catch(h=>{console.log("Error genrating order id",h),toast.error(h.message,"error")})},i=n=>{var I,V,B;let r;n.isInstallment=="yes"&&(r=((I=p(n==null?void 0:n.installment))==null?void 0:I.ids).split(","));const h={id:(V=d==null?void 0:d.connectionCharges)==null?void 0:V.applicationId,applycationType:(B=d==null?void 0:d.connectionCharges)==null?void 0:B.type,isInstallment:n.isInstallment,penaltyIds:r};console.log("payment function hit..",h),u(!0),L.post(b,h,y).then(a=>{var Z,K,Q,X,D,ee,ne,te,se,oe,le,ie,ae,ce;console.log("Oder ID Generated",a),u(!1),window.ReactNativeWebView?ge({generatedOrder:(Z=a==null?void 0:a.data)==null?void 0:Z.data,payload:{applicationId:(Q=(K=a==null?void 0:a.data)==null?void 0:K.data)==null?void 0:Q.applicationId,departmentId:(D=(X=a==null?void 0:a.data)==null?void 0:X.data)==null?void 0:D.departmentId,status:"",captured:"1",card_id:"",amount:(ne=(ee=a==null?void 0:a.data)==null?void 0:ee.data)==null?void 0:ne.amount,payment_method:"upi/netbanking",workflow_id:(se=(te=a==null?void 0:a.data)==null?void 0:te.data)==null?void 0:se.workflowId,user_id:(le=(oe=a==null?void 0:a.data)==null?void 0:oe.data)==null?void 0:le.userId,ulb_id:(ae=(ie=a==null?void 0:a.data)==null?void 0:ie.data)==null?void 0:ae.ulbId,user_id:localStorage.getItem("citizenId"),created_at:""},api:j,returnUrl:"/citizen/waterConnReceipt",isParam:!1}):R((ce=a==null?void 0:a.data)==null?void 0:ce.data,x)}).catch(a=>{u(!1),console.log("Error generating order id",a),k(a.message,"error")})},$=n=>n==NaN||n==null?0:n;let S=0,N;return s.values.isInstallment=="yes"&&(N=0),s.values.isInstallment=="no"&&(N=Number((z=o==null?void 0:o.calculation)==null?void 0:z.penalty)/10),e.jsx(e.Fragment,{children:e.jsx("form",{onSubmit:s.handleSubmit,onChange:P,children:e.jsxs("div",{className:"bg-white #789fde shadow-2xl border border-red-200 p-5 rounded-md",children:[e.jsx("p",{onClick:l,className:"float-right absolute right-6 top-6 hover:bg-gray-300 bg-gray-200 p-1 cursor-pointer",children:e.jsx(he,{})}),e.jsxs("div",{className:"border-b-2  pl-3 font-semibold border-red-400 flex",children:[e.jsx(re,{size:20,className:"mt-0.5 mr-1"}),"Regularization Payment"]}),e.jsx("p",{className:"text-center text-green-800 font-semibold",children:"Note: 10% rebate on penalty in case the whole penalty is paid"}),e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("img",{src:"https://img.freepik.com/free-vector/hand-holding-phone-with-credit-card-screen-man-making-purchase-shopping-paying-online-using-banking-app-flat-vector-illustration-transaction-e-commerce-concept_74855-26014.jpg?w=1380&t=st=1686898919~exp=1686899519~hmac=4b0ddb44860ec647fa33a1a0416ea0c1cc8167693a13fdba3f09058d099f0e76",alt:"My Image",width:200,height:100})}),e.jsxs("div",{className:"flex items-center px-10",children:[e.jsx("div",{className:"font-semibold text-lg text-gray-500",children:e.jsx("p",{children:"Application No.-"})}),e.jsx("p",{className:"font-semibold text-lg text-gray-500",children:(O=d==null?void 0:d.connectionCharges)==null?void 0:O.applicationNo})]}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"font-semibold text-lg text-green-500",children:e.jsx("p",{children:"Total Amount ₹-"})}),e.jsxs("p",{className:"font-semibold text-lg text-green-500",children:[s.values.isInstallment==="yes"&&Number((A=o==null?void 0:o.calculation)==null?void 0:A.connectionFee)+Number($((F=p(s.values.installment))==null?void 0:F.amount))-N,s.values.isInstallment==="no"&&Number((M=o==null?void 0:o.calculation)==null?void 0:M.connectionFee)+Number((W=o==null?void 0:o.calculation)==null?void 0:W.penalty)-N]})]}),e.jsxs("div",{className:"grid grid-cols-12 px-4 py-2 text-sm gap-y-2",children:[e.jsx("div",{className:"col-span-12 mt-2 text-gray-800",children:e.jsxs("div",{className:"grid grid-cols-12 text-base rounded",children:[e.jsxs("div",{className:"col-span-6 space-y-2",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Payment For:"})," ",(T=o==null?void 0:o.calculation)==null?void 0:T.chargeCatagory]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Connection Fee:"})," ₹"," ",(E=o==null?void 0:o.calculation)==null?void 0:E.connectionFee]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Penalty:"})," ₹"," ",(G=o==null?void 0:o.calculation)==null?void 0:G.penalty]})]}),e.jsxs("div",{className:"col-span-6",children:[e.jsxs("p",{className:"font-semibold",children:["Rebate: ₹ ",N]}),e.jsx("div",{className:"flex",children:e.jsxs("div",{children:[e.jsxs("label",{children:[e.jsx("span",{className:"font-semibold",children:"Installment Payment"}),e.jsx("input",{type:"radio",name:"isInstallment",value:"yes",checked:s.values.isInstallment==="yes",onChange:s.handleChange,onBlur:s.handleBlur}),"Yes",e.jsx("input",{type:"radio",name:"isInstallment",value:"no",checked:s.values.isInstallment==="no",onChange:s.handleChange,onBlur:s.handleBlur}),"No"]}),e.jsx("p",{className:"text-red-500 text-xs font-semibold",children:s.touched.isInstallment&&s.errors.isInstallment?s.errors.isInstallment:null})]})}),e.jsxs("div",{className:`${s.values.isInstallment==="no"?"opacity-50":""} flex gap-2 disabled:opacity-60`,children:[e.jsx("p",{className:"font-semibold",children:"Select Installment"}),e.jsxs("select",{onChange:s.handleChange,disabled:s.values.isInstallment==="no",value:s.values.installment,name:"installment",className:"disabled:opacity-60 disabled:border-0 border border-gray-800 rounded shadow text-sm h-6",children:[e.jsx("option",{value:"",children:"Select"}),o&&(o==null?void 0:o.penaltyInstallments.map((n,r)=>(S+=Number(n.balance_amount),e.jsx("option",{value:JSON.stringify({ids:n.ids,amount:S}),children:S},r))))]})]}),e.jsx("p",{className:"text-red-500 text-xs text-center font-semibold",children:s.touched.installment&&s.errors.installment?s.errors.installment:null})]})]})}),e.jsx("div",{className:"col-span-12 mt-2",children:e.jsx("div",{className:"text-center font-light rounded",children:e.jsx("p",{children:"Note: You can pay using Card / UPI / Netbanking / Wallet etc."})})}),e.jsx("div",{className:"col-span-12 mt-2",children:e.jsx("div",{className:"flex justify-center",children:C?e.jsx(me,{strokeColor:"grey",strokeWidth:"5",animationDuration:"0.75",width:"30",visible:!0}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:c.closeModal,className:"mx-3 bg-red-600 hover:bg-red-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm rounded-sm shadow-xl",children:"Cancel"}),e.jsx("button",{type:"submit",className:"mx-3 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm rounded-sm shadow-xl",children:"Pay Now"})]})})})]})]})})})},_e=c=>{var d,p,w,s,P;const{handlePayment:R}=xe(),_=Y(),[C,u]=g.useState(!1);g.useState();const t=c==null?void 0:c.paymentData;ue();const{notify:v}=g.useContext(H),{api_rzpWaterOrderId:o,api_getTranNo:U,header:k,api_generatedreceipt:m}=J(),y=()=>{c.closeModal()},b=async l=>{console.log("generateReceipt",l),console.log(l);let f={applicationId:l==null?void 0:l.applicationId,departmentId:l==null?void 0:l.departmentId,status:"",captured:"1",card_id:"",amount:l==null?void 0:l.amount,payment_method:"upi/netbanking",workflow_id:l==null?void 0:l.workflowId,user_id:l==null?void 0:l.userId,ulb_id:l==null?void 0:l.ulbId,user_id:localStorage.getItem("citizenId"),payment_order_id:l==null?void 0:l.razorpay_order_id,payment_id:l==null?void 0:l.razorpay_payment_id,created_at:""};console.log("Receipt",l),L.post(m,f,be()).then(x=>{console.log("genereted receipt",x),x.data.status==!0?(console.log("Oder ID Generated ++++dddddddddddddddddddddddd+++++",x.data),_(`/application-payment-history/${l==null?void 0:l.applicationId}`,{replace:!0})):de.error(x.data.message,"error")}).catch(x=>{console.log("Error genrating order id",x),de.error(x.message,"error")})},j=()=>{var f,x;u(!0);const l={id:(f=t==null?void 0:t.connectionCharges)==null?void 0:f.applicationId,applycationType:(x=t==null?void 0:t.connectionCharges)==null?void 0:x.type};console.log("Payment Button Clicked..",l),L.post(o,l,k).then(i=>{var $,S,N,z,O,A,F,M,W,T,E,G,n,r;console.log("Oder ID Generated",i),u(!1),window.ReactNativeWebView?ge({generatedOrder:($=i==null?void 0:i.data)==null?void 0:$.data,payload:{applicationId:(N=(S=i==null?void 0:i.data)==null?void 0:S.data)==null?void 0:N.applicationId,departmentId:(O=(z=i==null?void 0:i.data)==null?void 0:z.data)==null?void 0:O.departmentId,status:"",captured:"1",card_id:"",amount:(F=(A=i==null?void 0:i.data)==null?void 0:A.data)==null?void 0:F.amount,payment_method:"upi/netbanking",workflow_id:(W=(M=i==null?void 0:i.data)==null?void 0:M.data)==null?void 0:W.workflowId,user_id:(E=(T=i==null?void 0:i.data)==null?void 0:T.data)==null?void 0:E.userId,ulb_id:(n=(G=i==null?void 0:i.data)==null?void 0:G.data)==null?void 0:n.ulbId,user_id:localStorage.getItem("citizenId"),created_at:""},api:m,returnUrl:"/citizen/waterConnReceipt",isParam:!1}):R((r=i==null?void 0:i.data)==null?void 0:r.data,b)}).catch(i=>{u(!1),console.log("Error genrating order id",i),v(i.message,"error")})};return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsxs("p",{onClick:y,className:"float-right absolute right-12 top-12 hover:bg-gray-300 bg-gray-200 p-1 cursor-pointer",children:[" ",e.jsx(he,{})," "]}),e.jsxs("div",{className:"bg-white shadow-2xl border border-blue-200 md:p-5 md:m-5 rounded-md",children:[e.jsxs("div",{className:" border-b-2 py-1 pl-3 font-semibold border-red-400 flex",children:[e.jsx(re,{size:20,className:"mt-0.5 mr-1"}),"Make Payment"," "]}),e.jsx("div",{className:"flex justify-center py-6",children:e.jsx("img",{src:"https://img.freepik.com/free-vector/hand-holding-phone-with-credit-card-screen-man-making-purchase-shopping-paying-online-using-banking-app-flat-vector-illustration-transaction-e-commerce-concept_74855-26014.jpg?w=1380&t=st=1686898919~exp=1686899519~hmac=4b0ddb44860ec647fa33a1a0416ea0c1cc8167693a13fdba3f09058d099f0e76",alt:"My Image",width:200,height:100})}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"font-semibold text-2xl text-gray-500",children:e.jsx("p",{children:"Application No:-"})}),e.jsx("p",{className:"font-semibold text-2xl text-gray-500",children:(d=t==null?void 0:t.connectionCharges)==null?void 0:d.applicationNo})]}),e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"font-semibold text-2xl text-green-500",children:e.jsx("p",{children:"Amount-Rs:"})}),e.jsx("p",{className:"font-semibold text-2xl text-green-500",children:((p=t==null?void 0:t.connectionCharges)==null?void 0:p.amount)||"N/A"})]}),e.jsx("h1",{className:"text-center font-semibold",children:"Amount Breakup"}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"col-span-3 ",children:[e.jsxs("h1",{children:["Payment For : ",(w=t==null?void 0:t.connectionCharges)==null?void 0:w.charge_category]}),e.jsxs("h1",{children:["Penalty : ₹ ",(s=t==null?void 0:t.connectionCharges)==null?void 0:s.penalty]}),e.jsxs("h1",{children:["Connection Fee : ₹ ",(P=t==null?void 0:t.connectionCharges)==null?void 0:P.conn_fee]})]})}),e.jsx("div",{className:"md:col-span-12 col-span-12 md:mt-5 mt-2",children:e.jsx("div",{className:"text-center font-extralight px-2 rounded",children:e.jsx("p",{children:"Note : You can pay using Card / UPI / Netbanking / Wallet etc."})})}),e.jsx("div",{className:"col-span-12 md:mt-5 mt-2 max-sm:mb-2",children:e.jsx("div",{className:"flex justify-center",children:C?e.jsx(me,{strokeColor:"grey",strokeWidth:"5",animationDuration:"0.75",width:"30",visible:!0}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:y,className:"mx-3 bg-red-600 hover:bg-red-700 transition duration-200 hover:scale-105 font-normal text-white px-6 py-2 text-sm rounded-sm shadow-xl",children:"Cancel"}),e.jsx("button",{onClick:j,className:"mx-3 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-5 py-2 text-sm  rounded-sm shadow-xl",children:"Pay Now"})]})})})]})]})})},Ce={content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",background:"transparent",border:"none"}};function We(c){var d,p,w;const[R,_]=pe.useState(!1),[C,u]=g.useState(!1),[t,v]=g.useState(),[o,U]=g.useState(),k=Y();g.useContext(H),J(),console.log(c==null?void 0:c.paymentData);const m=c.paymentData;console.log("paymentData==>",m),g.useEffect(()=>{_(!0)},[]);function y(){}function b(){_(!1),u(!1),v(!1),U(!1),c==null||c.openPaymentModal(!1)}const j=s=>{var l,f,x;s!=null&&s.status&&u(!0),console.log("fetchTransactionDetails",s);const P={orderId:(l=s==null?void 0:s.data)==null?void 0:l.razorpay_order_id,paymentId:(f=s==null?void 0:s.data)==null?void 0:f.razorpay_payment_id,signature:(x=s==null?void 0:s.data)==null?void 0:x.razorpay_signature};console.log("payload",P)};return e.jsx("div",{className:"",children:e.jsxs(je,{isOpen:R,onAfterOpen:y,onRequestClose:b,style:Ce,contentLabel:"Example Modal",children:[C&&e.jsxs("div",{className:`${t?"bg-green-200":"bg-yellow-50"} shadow-2xl border border-sky-200 md:p-5 md:m-5 rounded-md`,children:[e.jsxs("div",{className:"flex justify-center",children:[t&&e.jsx("img",{src:Ne,className:"h-16",alt:"Payment Success",srcset:""}),!t&&e.jsx("img",{src:ve,className:"h-12",alt:"Payment Pending",srcset:""})]}),e.jsxs("div",{className:"py-1 pl-3 font-semibold text-center text-2xl text-gray-800",children:[t?"Payment Completed Successfully":"Payment Under Processing"," "]}),(t==null?void 0:t.transectionNo)&&e.jsxs("p",{className:"text-center",children:[e.jsx("span",{className:"text-base",children:" Payment Transaction No"})," ",e.jsx("span",{className:"font-bold text-blue-700 text-xl",children:t==null?void 0:t.transectionNo})]}),!(t!=null&&t.transectionNo)&&e.jsxs("p",{className:"text-center font-semibold",children:[e.jsx("span",{className:"text-base",children:" Payment Status"})," ",e.jsx("span",{className:" text-blue-500 text-base",children:"Pending"})]}),e.jsx("p",{className:"border-b border-gray-300 mx-10 py-1"}),e.jsxs("div",{className:"grid grid-cols-12 px-8 py-3 leading-8 space-x-8 text-sm",children:[e.jsx("div",{className:"md:col-span-6 col-span-12",children:e.jsxs("div",{className:"grid grid-cols-12",children:[e.jsxs("div",{className:"col-span-6 font-semibold",children:[e.jsx("p",{children:"Application No"}),e.jsx("p",{children:"Transaction Type"})]}),e.jsxs("div",{className:"col-span-6 ml-3",children:[e.jsx("p",{children:((d=m==null?void 0:m.connectionCharges)==null?void 0:d.applicationNo)||"NA"}),e.jsx("p",{children:((p=m==null?void 0:m.connectionCharges)==null?void 0:p.charge_category)||"NA"})]})]})}),e.jsx("div",{className:"md:col-span-6 col-span-12",children:e.jsxs("div",{className:"grid grid-cols-12",children:[e.jsxs("div",{className:"col-span-6 font-semibold",children:[e.jsx("p",{children:"Amount"}),e.jsx("p",{children:"Payment Date"})]}),e.jsxs("div",{className:"col-span-6",children:[e.jsx("p",{children:(t==null?void 0:t.amount)||((w=m==null?void 0:m.connectionCharges)==null?void 0:w.amount)}),e.jsx("p",{children:(t==null?void 0:t.transectionDate)||"Pending"})]})]})}),e.jsx("div",{className:"col-span-12 md:mt-4 mt-10",children:e.jsxs("div",{className:"flex justify-center",children:[e.jsx("button",{onClick:b,className:"mx-2 bg-sky-600 hover:bg-sky-700 transition duration-200 hover:scale-105 font-normal text-white px-6 py-1 text-sm rounded-sm shadow-xl",children:"Dashboard"}),t&&e.jsx("button",{onClick:()=>k(`/waterConnReceipt/${t==null?void 0:t.transectionNo}`),className:"mx-2 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm  rounded-sm shadow-xl",children:"View Receipt"}),!t&&e.jsx("button",{onClick:()=>j(),className:"mx-2 bg-indigo-600 hover:bg-indigo-700 transition duration-200 hover:scale-105 font-normal text-white px-4 py-2 text-sm  rounded-sm shadow-xl",children:"Check Status"})]})})]})]}),!C&&((c==null?void 0:c.category)=="Regulaization"?e.jsx(we,{closeModal:b,fetchTransactionDetails:j,paymentData:m}):e.jsx(_e,{closeModal:b,fetchTransactionDetails:j,paymentData:m}))]})})}export{We as W};
