import{_ as E,c as T,j as e,P as X}from"./index-xq9jTTfh.js";import{r as Y,h as Z,d as _}from"./router-WshRxXk2.js";import{u as ee,F as ae,S as G,T as r,L as te}from"./TextArea-1v4UYNvG.js";import{r as v}from"./tailwind-Ucrx0-S6.js";import{c as ie,a as N}from"./index.esm-Wdru5IDi.js";import{a as se,b as $}from"./useCustomQuery-9edUl8Ze.js";import{u as oe}from"./useErrorFocusField-dZsYFtof.js";import{r as z}from"./resizeImage-6ax_puwt.js";import{C as ne,O as le}from"./CreateConfirmation-jcQEgTiu.js";import"./reactQuery-2daanlHr.js";import"./reactQueryDevtools-6dm9iask.js";import"./axios-YpSsR79r.js";import"./reactLazyLoadImageComponent-2lnvQYCj.js";import"./reactIcons-UnuJhE_7.js";import"./headlessui-oHdMYZDI.js";var J={};Object.defineProperty(J,"__esModule",{value:!0});var Q=J.useGeolocated=void 0;const n=Y;function re(w={}){const{positionOptions:h={enableHighAccuracy:!0,maximumAge:0,timeout:1/0},isOptimisticGeolocationEnabled:I=!0,userDecisionTimeout:g=void 0,suppressLocationOnMount:L=!1,watchPosition:x=!1,geolocationProvider:l=typeof navigator<"u"?navigator.geolocation:void 0,watchLocationPermissionChange:A=!1,onError:C,onSuccess:S}=w,d=(0,n.useRef)(0),j=(0,n.useRef)(!0),V=(0,n.useRef)(0),[O,t]=(0,n.useState)(I),[U,D]=(0,n.useState)(),[M,k]=(0,n.useState)(),[B,q]=(0,n.useState)(),[W,H]=(0,n.useState)(),b=(0,n.useCallback)(()=>{d.current&&window.clearTimeout(d.current)},[]),y=(0,n.useCallback)(s=>{b(),j.current&&(D(()=>{}),t(!1),q(s)),C==null||C(s)},[C,b]),F=(0,n.useCallback)(s=>{b(),j.current&&(D(s.coords),k(s.timestamp),t(!0),q(()=>{})),S==null||S(s)},[S,b]),R=(0,n.useCallback)(()=>{if(!l||!l.getCurrentPosition||!l.watchPosition)throw new Error("The provided geolocation provider is invalid");g&&(d.current=window.setTimeout(()=>{y()},g)),x?V.current=l.watchPosition(F,y,h):l.getCurrentPosition(F,y,h)},[l,x,g,y,F,h]);return(0,n.useEffect)(()=>{let s;return A&&l&&"permissions"in navigator&&navigator.permissions.query({name:"geolocation"}).then(P=>{s=P,s.onchange=()=>{H(s.state)}}).catch(P=>{console.error("Error updating the permissions",P)}),()=>{s&&(s.onchange=null)}},[]),(0,n.useEffect)(()=>(L||R(),()=>{b(),x&&V.current&&(l==null||l.clearWatch(V.current))}),[W]),{getPosition:R,coords:U,timestamp:M,isGeolocationEnabled:O,isGeolocationAvailable:!!l,positionError:B}}Q=J.useGeolocated=re;function de(){const{isGeolocationAvailable:w,isGeolocationEnabled:h,getPosition:I,coords:g,positionError:L,timestamp:x}=Q({positionOptions:{enableHighAccuracy:!0,timeout:1/0,maximumAge:localStorage.getItem("geoMaxAge")||1/0},watchPosition:!0,userDecisionTimeout:5e3});return{isGeolocationAvailable:w,isGeolocationEnabled:h,coords:g,positionError:L,timestamp:x,getPosition:I}}const ce=ie({fullName:N().required("Required"),wardId:N().required("Required"),address1:N().required("Required"),violationPlace:N().required("Required"),photo:N().required("Required"),challanType:N().required("Required"),mobileNo:N().min(10).max(10).label("Mobile")});function me(){var y,F,R,s,P,K;const w=Z(),[h,I]=_.useState(""),[g,L]=_.useState(""),[x,l]=_.useState(""),[A,C]=_.useState(""),{AutoFocusErrorField:S}=oe(),{coords:d}=de(),j=se({}),V=$({api:T.api_getWardlist,options:{enabled:!0}}),O=$({api:T.api_get_department_list,options:{enabled:!0}}),t=ee({initialValues:{challanType:"",fullName:"",guardianName:"",mobileNo:"",email:"",holdingNo:"",tradeLicenseNo:"",address1:"",violationPlace:"",witnessName:"",witnessMobileNo:"",city:"",region:"",violationId:"",postalCode:"",penaltyAmount:"",wardId:"",photo:"",photo2:"",photo3:"",pdf:"",latitude:"",longitude:"",audioVideo:""},validationSchema:ce,onSubmit:async a=>{await ne("Are you sure you want to generate challan?")?await b(a):E.error("Challan Generation Cancelled")}}),{isSubmitting:U,submitCount:D,errors:M}=t,k=async a=>{var c,m,u,p;const o=a.target.files[0];if(o){const i=await z(o),f=new File([i],(m=(c=a==null?void 0:a.target)==null?void 0:c.files[0])==null?void 0:m.name,{type:(p=(u=a==null?void 0:a.target)==null?void 0:u.files[0])==null?void 0:p.type});I(URL.createObjectURL(f)),t.setFieldValue("photo",f),t.setFieldValue("latitude",d==null?void 0:d.latitude),t.setFieldValue("longitude",d==null?void 0:d.longitude)}else t.setFieldValue("photo",null),t.setFieldValue("latitude",""),t.setFieldValue("longitude","")},B=async a=>{var c,m,u,p;const o=a.target.files[0];if(o){const i=await z(o),f=new File([i],(m=(c=a==null?void 0:a.target)==null?void 0:c.files[0])==null?void 0:m.name,{type:(p=(u=a==null?void 0:a.target)==null?void 0:u.files[0])==null?void 0:p.type});L(URL.createObjectURL(f)),t.setFieldValue("photo2",f)}else t.setFieldValue("photo2",null)},q=async a=>{var c,m,u,p;const o=a.target.files[0];if(o){const i=await z(o),f=new File([i],(m=(c=a==null?void 0:a.target)==null?void 0:c.files[0])==null?void 0:m.name,{type:(p=(u=a==null?void 0:a.target)==null?void 0:u.files[0])==null?void 0:p.type});l(URL.createObjectURL(f)),t.setFieldValue("photo3",f)}else t.setFieldValue("photo3",null)},W=async a=>{const o=a.target.files[0];t.setFieldValue("pdf",o),C(URL.createObjectURL(o))},H=$({api:T.api_department_type_by_department_id,config:{departmentId:t.values.violationId},value:[t.values.violationId],options:{enabled:!!t.values.violationId}}),b=async a=>{var o,c,m,u,p;try{const i=await j.mutateAsync({api:a.challanType=="onSpot"?T.api_save_on_spot:T.api_save_verification,data:a});(o=i==null?void 0:i.data)!=null&&o.status?(E.success((c=i==null?void 0:i.data)==null?void 0:c.message),a.challanType=="onSpot"?(w("/fines-app/today-challan"),t.resetForm()):(w("/fines-app/today-application"),t.resetForm())):E.error((m=i==null?void 0:i.data)==null?void 0:m.message)}catch(i){E.error((p=(u=i==null?void 0:i.response)==null?void 0:u.data)==null?void 0:p.message)}};return _.useEffect(()=>{S({formik:t})},[M,D,U]),e.jsxs(X,{title:"Generate Challan",meta:e.jsx(e.Fragment,{children:e.jsx("meta",{name:"description",content:"Generate Challan"})}),children:[j.isLoading&&e.jsx(le,{}),e.jsx("div",{className:"p-4",children:e.jsxs(ae,{formik:t,children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-sm font-semibold text-blue-gray-500 mb-2 ",children:"# Violator Information"}),e.jsx(v.Card,{className:"rounded-2xl",children:e.jsx(v.Card.Body,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-1 md:grid-cols-2",children:[e.jsxs(G,{name:"challanType",label:"Challan Type",formik:t,isRequiredLabel:!0,children:[e.jsx("option",{value:"",children:"Select Challan Type"}),e.jsx("option",{value:"onSpot",children:"On Spot"}),e.jsx("option",{value:"verification",children:"Verification"})]}),e.jsx(r,{formik:t,isRequiredLabel:!0,name:"fullName",label:"Full Name",inputValidation:["removeSpecialCharacterWithDoubleSpace","string"]}),e.jsx(r,{formik:t,name:"guardianName",label:"Guardian Name",inputValidation:["removeSpecialCharacterWithDoubleSpace","string","nocopy"]}),e.jsx(r,{formik:t,type:"number",name:"mobileNo",label:"Mobile No",inputValidation:["mobile"]}),e.jsx(r,{formik:t,name:"email",label:"Email"}),e.jsxs(G,{name:"wardId",label:"Ward",formik:t,isRequiredLabel:!0,children:[e.jsx("option",{value:"",children:"Select Ward"}),(F=(y=V.data)==null?void 0:y.data)==null?void 0:F.map(a=>e.jsx("option",{value:a.id,children:a.ward_name},a.id))]}),e.jsx(r,{formik:t,name:"holdingNo",label:"Holding No",inputValidation:["removeSpace"]}),e.jsx(r,{formik:t,name:"tradeLicenseNo",label:"Trade License No",inputValidation:["removeSpace"]})]})})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h1",{className:"text-sm font-semibold text-blue-gray-500 mb-2 ",children:"# Violator Address Information"}),e.jsx(v.Card,{className:"rounded-2xl",children:e.jsx(v.Card.Body,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-1 md:grid-cols-2",children:[e.jsx(r,{formik:t,name:"region",label:"Region",inputValidation:["removeDoubleSpace","string"]}),e.jsx(r,{formik:t,name:"address1",label:"Street Address",inputValidation:["removeDoubleSpace","string"]}),e.jsx(r,{isRequiredLabel:!0,formik:t,name:"violationPlace",label:"Place",inputValidation:["removeDoubleSpace","string"]})]})})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h1",{className:"text-sm font-semibold text-blue-gray-500 mb-2 ",children:"# Challan Details"}),e.jsx(v.Card,{className:"rounded-2xl",children:e.jsx(v.Card.Body,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-1 md:grid-cols-2",children:[e.jsxs(G,{name:"violationId",label:"Violation Department",formik:t,isRequiredLabel:!0,children:[e.jsx("option",{value:"",children:"Select Violation"}),(s=(R=O.data)==null?void 0:R.data)==null?void 0:s.map(a=>e.jsx("option",{value:a.id,children:a.department_name},a.id))]}),e.jsxs(G,{name:"violationType",label:"Violation Type",formik:t,isRequiredLabel:!0,children:[e.jsx("option",{value:"",children:"Select Violation Type"}),(K=(P=H.data)==null?void 0:P.data)==null?void 0:K.map(a=>e.jsx("option",{value:a.id,children:a.violation_name},a.id))]})]})})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h1",{className:"text-sm font-semibold text-blue-gray-500 mb-2 ",children:"# Document"}),e.jsx(v.Card,{className:"rounded-2xl",children:e.jsx(v.Card.Body,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-1 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(r,{isRequiredLabel:!0,accept:"image/*",type:"file",name:"photo",label:"Select Image",onChange:k}),t.errors.photo&&t.touched.photo&&e.jsx("span",{className:"text-red-600 text-xs -mt-7",children:t.errors.photo}),e.jsx("div",{className:"mt-4",children:h&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("img",{src:h,alt:"preview",className:"w-40 h-40 object-cover rounded-lg"})}),d&&t.values.photo&&e.jsxs("h1",{className:"text-sm font-semibold text-blue-gray-500 mt-2 ",children:["Latitude: ",t.values.latitude," | Longitude:"," ",t.values.longitude]}),e.jsx("hr",{className:"border-t border-gray-200 my-4"})]})})]}),e.jsxs("div",{children:[e.jsx(r,{accept:"image/*",type:"file",name:"photo2",label:"Select Image 2",onChange:B}),e.jsx("div",{className:"mt-4",children:g&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("img",{src:g,alt:"preview",className:"w-40 h-40 object-cover rounded-lg"})}),e.jsx("hr",{className:"border-t border-gray-200 my-4"})]})})]}),e.jsxs("div",{children:[e.jsx(r,{accept:"image/*",type:"file",name:"photo3",label:"Select Image 3",onChange:q}),e.jsx("div",{className:"mt-4",children:x&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("img",{src:x,alt:"preview",className:"w-40 h-40 object-cover rounded-lg"})}),e.jsx("hr",{className:"border-t border-gray-200 my-4"})]})})]}),e.jsxs("div",{children:[e.jsx(r,{accept:".pdf",type:"file",name:"pdf",label:"Select PDF",onChange:W}),e.jsx("div",{className:"mt-4",children:t.values.pdf&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("iframe",{src:A,width:"100%",height:"250px",children:"This browser does not support PDFs. Please download the PDF to view it: Download PDF"})}),e.jsx("hr",{className:"border-t border-gray-200 my-4"})]})})]})]})})})]}),e.jsx("div",{className:"py-8",children:e.jsx(te,{type:"submit",loading:j.isLoading,disabled:j.isLoading,className:"mt-4",children:"Generate Challan"})})]})})]})}function Pe(){return e.jsx(me,{})}export{Pe as default};
