import{_ as f,j as e,a as P}from"./index-xq9jTTfh.js";import{d as j,h as C,L as E}from"./router-WshRxXk2.js";import{u as q,F as R,T as v,L as I,S as M,P as D}from"./TextArea-1v4UYNvG.js";import{c as O,a as x,b as A}from"./index.esm-Wdru5IDi.js";import{u as T}from"./useCustomQuery-9edUl8Ze.js";import{r as V}from"./resizeImage-6ax_puwt.js";import{u as L}from"./useErrorFocusField-dZsYFtof.js";import"./reactQuery-2daanlHr.js";import"./reactQueryDevtools-6dm9iask.js";import"./axios-YpSsR79r.js";import"./tailwind-Ucrx0-S6.js";import"./reactLazyLoadImageComponent-2lnvQYCj.js";import"./reactIcons-UnuJhE_7.js";import"./headlessui-oHdMYZDI.js";const z=O().shape({mobile:x().required("Mobile is required").min(10).max(10)});function $({next:h,data:r,setData:i}){const{mutateAsync:l}=T({}),{sendOtp:u}=P,n=q({enableReinitialize:!0,initialValues:{mobile:r.mobileNo||""},validationSchema:z,onSubmit:async(c,{})=>{var m,t,g;try{const s=await l({api:u,data:{mobileNo:c.mobile,type:"Register"}});((m=s==null?void 0:s.data)==null?void 0:m.status)===!0?(h({...r,mobileNo:c.mobile}),f.success((t=s==null?void 0:s.data)==null?void 0:t.message)):f.error((g=s==null?void 0:s.data)==null?void 0:g.message)}catch(s){console.log(s)}}});return e.jsx(e.Fragment,{children:e.jsxs(R,{formik:n,children:[e.jsx("h2",{className:" font-semibold mt-8 mb-4",children:"Citizen Registration"}),e.jsx(v,{label:"Mobile",name:"mobile",type:"number",formik:n,onInput:c=>{c.target.value=Math.max(0,parseInt(c.target.value)).toString().slice(0,10)}}),e.jsx("div",{className:"text-center ",children:e.jsx(I,{type:"submit",loading:n==null?void 0:n.isSubmitting,disabled:n==null?void 0:n.isSubmitting,children:"Send OTP"})})]})})}const B=h=>{const[r,i]=j.useState(0),[l,u]=j.useState(!1);j.useEffect(()=>{let t;return l?(i(60*h),t=setInterval(()=>{i(g=>g-1)},1e3)):clearInterval(t),()=>clearInterval(t)},[l]),j.useEffect(()=>{r<0&&l&&(u(!1),i(0))},[r,l]);const n=()=>u(t=>!t),c=String(r%60).padStart(2,0);return{minutes:String(Math.floor(r/60)).padStart(2,0),seconds:c,togglerTimer:n,runTimer:l}},G=B,_=O().shape({otp:x().required("OTP is required").min(6).max(6)});function U({next:h,data:r,setData:i,prev:l}){const{mutateAsync:u}=T({}),{verifyOtp:n}=P,{minutes:c,seconds:m,togglerTimer:t,runTimer:g}=G(.1),s=q({enableReinitialize:!0,initialValues:{mobile:r.mobileNo||"",otp:r.otp||""},validationSchema:_,onSubmit:async(p,{})=>{var N,S,a;try{const o=await u({api:n,data:{mobileNo:p.mobile,otp:p.otp}});((N=o==null?void 0:o.data)==null?void 0:N.status)===!0?(h({...r,otp:p.otp}),f.success((S=o==null?void 0:o.data)==null?void 0:S.message)):f.error((a=o==null?void 0:o.data)==null?void 0:a.message)}catch(o){f.error("Invalid OTP")}}});j.useEffect(()=>(t(),()=>{t()}),[]);const F=async()=>{try{const p=await u({api:P.sendOtp,data:{mobileNo:s==null?void 0:s.values.mobile,type:"Register"}});t(),i({mobileNo:s==null?void 0:s.values.mobile,otp:""}),s.setFieldValue("otp","")}catch(p){console.log(p)}};return e.jsx(e.Fragment,{children:e.jsxs(R,{formik:s,children:[e.jsxs("h1",{className:"text-sm mt-8 mb-4",children:["Please enter the 6-digit verification code sent to your phone number +91-",r==null?void 0:r.mobileNo," ",e.jsx("span",{className:"text-sm text-blue-700",onClick:()=>l({mobile:s==null?void 0:s.values.mobile,otp:""}),children:"Edit"})]}),e.jsx(v,{label:"Verify OTP",name:"otp",type:"number",formik:s,onInput:p=>{p.target.value=Math.max(0,parseInt(p.target.value)).toString().slice(0,6)}}),e.jsx("div",{className:"text-center",children:e.jsx(I,{type:"submit",loading:s==null?void 0:s.isSubmitting,disabled:s==null?void 0:s.isSubmitting,children:"Verify OTP"})}),e.jsxs("div",{className:"text-center mt-4 text-sm",children:["Didn't receive the code?"," ",g?e.jsxs("span",{className:"text-gray-700 cursor-pointer",children:["Resend in ",c,":",m]}):e.jsx("span",{className:"text-blue-700 cursor-pointer",onClick:F,children:"Resend OTP"})]})]})})}const H=O().shape({mobile:x().required("Mobile is required").min(10).max(10),name:x().required("Name is required"),email:x().required("Email is required").email("Invalid Email"),gender:x().required("Gender is required"),password:x().required("Password is required"),confirmPassword:x().required("Confirm Password is required").oneOf([A("password"),null],"Passwords must match"),dob:x().required("Date of Birth is required")});function J({next:h,prev:r,data:i,setData:l}){var N,S;const{AutoFocusErrorField:u}=L(),{register:n}=P,c=C(),m=T({}),t=q({enableReinitialize:!0,initialValues:{otp:i.otp||"",mobile:i.mobileNo||"",name:i.name||"",email:i.email||"",gender:(i==null?void 0:i.gender)||"",password:i.password||"",confirmPassword:i.confirmPassword||"",dob:i.dob||"",photo:i.photo||""},validationSchema:H,onSubmit:async a=>{var o,y,w;try{const d=new FormData;d.append("mobile",a.mobile),d.append("name",a.name),d.append("email",a.email),d.append("dob",a.dob),d.append("gender",a.gender),d.append("password",a.password),d.append("confirmPassword",a.confirmPassword),d.append("photo",a.photo);const b=await m.mutateAsync({api:n,data:d});((o=b==null?void 0:b.data)==null?void 0:o.status)===!0?(f.success((y=b==null?void 0:b.data)==null?void 0:y.message),c("/juidco-app/auth/login")):f.error((w=b==null?void 0:b.data)==null?void 0:w.message)}catch(d){f.error("Something went wrong")}}}),g=async a=>{var w,d;const o=await V(a.target.files[0]),y=new File([o],(d=(w=a==null?void 0:a.target)==null?void 0:w.files[0])==null?void 0:d.name,{type:"image/*"});t.setFieldValue("photo",y)},{isSubmitting:s,submitCount:F,errors:p}=t;return j.useEffect(()=>{u({formik:t})},[p,F,s]),e.jsx(e.Fragment,{children:e.jsxs(R,{formik:t,children:[e.jsx("h2",{className:" font-semibold mb-4",children:"Citizen Registration"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx(v,{label:"Name",name:"name",type:"text",formik:t})}),e.jsx("div",{children:e.jsx(v,{label:"Mobile",name:"mobile",type:"number",formik:t,onInput:a=>{a.target.value=Math.max(0,parseInt(a.target.value)).toString().slice(0,10)}})}),e.jsx("div",{className:"-mt-2",children:e.jsx(v,{label:"Email",name:"email",type:"email",formik:t})}),e.jsxs("div",{className:"-mt-2",children:[e.jsx(v,{label:"Upload Photo",accept:"image/*",name:"photo",type:"file",onChange:a=>g(a)}),e.jsx("small",{className:"text-red-500 -mt-6",children:((N=t==null?void 0:t.errors)==null?void 0:N.photo)&&((S=t==null?void 0:t.touched)==null?void 0:S.photo)})]}),e.jsx("div",{className:"-mt-2",children:e.jsx(v,{label:"Date of Birth",name:"dob",type:"date",formik:t})}),e.jsx("div",{className:"-mt-2",children:e.jsxs(M,{formik:t,name:"gender",label:"Gender",children:[e.jsx("option",{value:"",children:"Select Date"}),["Male","Female","Other"].map((a,o)=>e.jsx("option",{value:a,children:a},o))]})}),e.jsx("div",{className:"-mt-2",children:e.jsx(D,{label:"Password",name:"password",formik:t})}),e.jsx("div",{className:"-mt-2",children:e.jsx(D,{label:"confirm password",name:"confirmPassword",formik:t})})]}),e.jsx("div",{className:"text-center mt-2",children:e.jsx(I,{type:"submit",loading:m.isLoading,disabled:m.isLoading,children:"Register Now"})})]})})}function oe(){const[h,r]=j.useState(0),[i,l]=j.useState({otp:"",mobileNo:"",name:"",email:"",password:"",dob:"",gender:"",aadhar:"",isSpeciallyAbled:0,isArmedForce:0,aadharDoc:null,photo:null}),u=m=>{console.log(m)},n=(m,t=!1)=>{if(l({...i,...m}),t){u(m);return}r(h+1)},c=m=>{l({...i,...m}),r(h-1)};return e.jsxs("div",{children:[{0:e.jsx($,{data:i,next:n,setData:l}),1:e.jsx(U,{data:i,setData:l,next:n,prev:c}),2:e.jsx(J,{data:i,setData:l,next:n,prev:c})}[h],e.jsx("div",{className:"text-center mt-4",children:e.jsx(E,{to:"/juidco-app/auth/login",className:"text-[#5846BE]",children:"Click here to Login"})})]})}export{oe as default};
