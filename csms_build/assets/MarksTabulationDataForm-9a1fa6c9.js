import{r as o,u as ee,K as se,c as le,a as x,b as te,j as s,B as ae,A as n,e as d,o as w,g as re}from"./index-de640f8f.js";import{B as oe}from"./BottomErrorCard-511fba4a.js";import{T as ie}from"./Tabs-018c5deb.js";function xe(){const[I,M]=o.useState(!1),[S,E]=o.useState(null),[F,i]=o.useState(!1),[f,_]=o.useState([]),[b,C]=o.useState([]),[g,A]=o.useState([]),[h,T]=o.useState([]);o.useState([]);const[y,P]=o.useState(),[ce,L]=o.useState(),[p,V]=o.useState(),{api_getActiveExamTermData:B,api_getactiveClassData:D,api_finance_year:O,api_section_group_map:$,api_markstabulationCrudStore:q,api_getMarksEntryData:ne,api_marksEntrySection:R}=re(),j=ee(),{id:N}=se(),G=le({classId:x().required("Select Class"),sectionId:x().required("Select Section"),termId:x().required("Select Term"),admissionNo:x().required("Enter admission no")}),l=te({initialValues:{classId:"",sectionId:"",termId:"",admissionNo:"",isMainSubject:!0,isOptionalSubject:!1,fullMarks:"",passMarks:"",totalMarks:0,totalObtainedMarks:0,percentage:0,marks:[]},onSubmit:(e,t)=>{console.log("at submit ",e),J(e)},validationSchema:G}),J=e=>{console.log("wow",e),i(!0);let t,r,m={admissionNo:e==null?void 0:e.admissionNo,tabulation:e.marks.map(a=>({fy:a==null?void 0:a.fy_name,admissionNo:a==null?void 0:a.admissionNo,termId:a==null?void 0:a.termId,classId:a==null?void 0:a.classId,sectionId:a==null?void 0:a.sectionId,marksEntryId:a==null?void 0:a.marks_entry_id,obtainedMarks:a==null?void 0:a.obtMarks}))};t=q,r=m,n.post(t,r,d()).then(function(a){var u,v,k;console.log("view discount group master..",(u=a==null?void 0:a.data)==null?void 0:u.data),(v=a==null?void 0:a.data)!=null&&v.status?j("/marks-tabulation"):c(!0,`${(k=a==null?void 0:a.data)==null?void 0:k.message}`),i(!1)}).catch(function(a){console.log("==2 error list...",a),c(!0,"Error occured in submitting form."),i(!1)})},K=()=>{i(!0),n.post(O,{},d()).then(function(e){e!=null&&e.data?(console.log(e==null?void 0:e.data),_(e==null?void 0:e.data)):c(!0,"Error occured while fetching data."),i(!1)}).catch(function(e){console.log("==2 error list...",e),c(!0,"Error occured while fetching data."),i(!1)})},U=()=>{i(!0),n.post(D,{},d()).then(function(e){e!=null&&e.data?(console.log(e==null?void 0:e.data),C(e==null?void 0:e.data.data)):c(!0,"Error occured while fetching data."),i(!1)}).catch(function(e){console.log("==2 error list...",e),c(!0,"Error occured while fetching data."),i(!1)})},Y=e=>{i(!0),n.post($,{classId:e},d()).then(function(t){t!=null&&t.data?(console.log(t==null?void 0:t.data),A(t==null?void 0:t.data.data)):c(!0,"Error occured while fetching data."),i(!1)}).catch(function(t){console.log("==2 error list...",t),c(!0,"Error occured while fetching data."),i(!1)})},H=()=>{i(!0),n.post(B,{},d()).then(function(e){e!=null&&e.data?(console.log(e==null?void 0:e.data),T(e==null?void 0:e.data.data)):c(!0,"Error occured while fetching data."),i(!1)}).catch(function(e){console.log("==2 error list...",e),c(!0,"Error occured while fetching data."),i(!1)})};console.log(l.values.fy);const z=()=>{i(!0),n.post(R,{classId:l.values.classId,sectionId:l.values.sectionId},d()).then(function(e){var t,r,m,a;(t=e==null?void 0:e.data)!=null&&t.status?(console.log((r=e==null?void 0:e.data)==null?void 0:r.data),l.setFieldValue("marks",(m=e==null?void 0:e.data)==null?void 0:m.data.map(u=>({...u,obtMarks:0,classId:l.values.classId,sectionId:l.values.sectionId,termId:l.values.termId,admissionNo:l.values.admissionNo})))):c(!0,`${(a=e==null?void 0:e.data)==null?void 0:a.message}`),i(!1)}).catch(function(e){console.log("==2 error list...",e),c(!0,"Error occured while fetching data.")})},Q=()=>{let e=l.values.marks.reduce((t,r)=>t+(r==null?void 0:r.full_marks),0);P(e)},W=()=>{let e=l.values.marks.reduce((t,r)=>parseInt(t)+parseInt(r==null?void 0:r.obtMarks),0);console.log(e),V(e)},X=(e,t)=>{l.setFieldValue(`marks.${t}.obtMarks`,e),console.log(t,e,`marks.${t}.obtMarks`),L(t)};console.log(l.values.marks),o.useEffect(()=>{W()},[l.values.marks]),o.useEffect(()=>{Q()},[l.values.marks]),o.useEffect(()=>{l.setFieldValue("totalMarks",y)},[y]),o.useEffect(()=>{K(),U(),H()},[]),o.useEffect(()=>{l.values.classId&&Y(l.values.classId)},[l.values.classId]),o.useEffect(()=>{l.values.classId&&l.values.sectionId&&z()},[l.values.classId,l.values.sectionId]),o.useEffect(()=>{let e=(p/l.values.totalMarks*100).toFixed(2);l.setFieldValue("percentage",e)},[p,l.values.totalMarks]);const Z=e=>{let t=e.target.name,r=e.target.value;t=="fullMarks"&&l.setFieldValue("fullMarks",w(r.trim(),l.values.fullMarks,3)),t=="passMarks"&&l.setFieldValue("passMarks",w(r.trim(),l.values.passMarks,3))},c=(e,t)=>{E(t),M(e)};return s.jsx(s.Fragment,{children:s.jsx("div",{className:"main-div",children:s.jsxs("div",{className:"main-inner-div",children:[F&&s.jsx(ae,{}),I&&s.jsx(oe,{activateBottomErrorCard:c,errorTitle:S}),s.jsxs("div",{className:"main-sub-div",children:[s.jsx("div",{className:"main-sub-inner-div",children:s.jsxs("div",{className:"text-div",children:[s.jsx("div",{className:"big-text",children:"Marks Tabulation Master Form"}),s.jsx("div",{className:"common-header-smalltext",children:"Unlock Your Potential. Join Our Journey Of Education And Excellence"})]})}),N===void 0?s.jsx("div",{className:"tab-div",children:s.jsx("div",{className:"add-button-master-div",children:s.jsxs("button",{onClick:()=>j("/marks-tabulation-form"),type:"submit",className:" add-button-master bg-[#0F766E] hover:[#0F766E]",children:["Add"," "]})})}):null]}),s.jsx(ie,{listRoute:"/marks-tabulation",formRoute:"/marks-tabulation-form"}),s.jsx("div",{className:"details-div",children:s.jsx("span",{className:"detailes text-[#0F766E]",children:"Marks Tabulation Form"})}),s.jsx("div",{className:"form-div",children:s.jsx("form",{onSubmit:l.handleSubmit,onChange:Z,children:s.jsxs("div",{className:"form",children:[s.jsxs("div",{className:"col-span-4 grid grid-cols-12",children:[s.jsxs("div",{className:"form-group mb-6 col-span-12 md:col-span-2 md:pr-4 relative",children:[s.jsxs("label",{className:"form-label inline-block mb-1 text-teal-900 text-sm font-semibold",children:["Financial Year",s.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),s.jsx("select",{...l.getFieldProps("fy"),type:"number",className:"form-control block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 h-10 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",placeholder:"Select class",children:f==null?void 0:f.map((e,t)=>s.jsx("option",{value:e==null?void 0:e.fy,children:e==null?void 0:e.fy}))}),s.jsx("span",{className:"text-red-600 absolute text-xs",children:l.touched.fy&&l.errors.fy?l.errors.fy:null})]}),s.jsxs("div",{className:"form-group mb-6 col-span-12 md:col-span-2 md:pr-4",children:[s.jsxs("label",{className:"form-label inline-block mb-1 text-teal-900 text-sm font-semibold",children:["Term",s.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),s.jsxs("select",{...l.getFieldProps("termId"),type:"text",className:"form-control bg-white h-10 block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",placeholder:"Select Discount Group",children:[s.jsx("option",{value:"",children:"Select"}),h==null?void 0:h.map((e,t)=>s.jsx("option",{value:e==null?void 0:e.id,children:e==null?void 0:e.term_name}))]}),s.jsx("span",{className:"text-red-600  text-xs",children:l.touched.termId&&l.errors.termId?l.errors.termId:null})]}),s.jsxs("div",{className:"form-group mb-6 col-span-12 md:col-span-2 md:pr-4",children:[s.jsxs("label",{className:"form-label inline-block mb-1 text-teal-900 text-sm font-semibold",children:["Admission no",s.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),s.jsx("input",{...l.getFieldProps("admissionNo"),type:"text",className:"form-control h-10 block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md",placeholder:"Enter admission no"}),s.jsx("span",{className:"text-red-600 text-xs",children:l.touched.admissionNo&&l.errors.admissionNo?l.errors.admissionNo:null})]}),s.jsxs("div",{className:"form-group mb-6 col-span-12 md:col-span-2 md:pr-4",children:[s.jsxs("label",{className:"form-label inline-block mb-1 text-teal-900 text-sm font-semibold",children:["Class",s.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),s.jsxs("select",{...l.getFieldProps("classId"),type:"number",className:"form-control bg-white h-10 block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",placeholder:"Select Class",children:[s.jsx("option",{value:"",children:"Select"}),b==null?void 0:b.map((e,t)=>s.jsx("option",{value:e==null?void 0:e.id,children:e==null?void 0:e.class_name}))]}),s.jsx("span",{className:"text-red-600  text-xs",children:l.touched.classId&&l.errors.classId?l.errors.classId:null})]}),s.jsxs("div",{className:"form-group mb-6 col-span-12 md:col-span-2 md:pr-4",children:[s.jsxs("label",{className:"form-label inline-block mb-1 text-teal-900 text-sm font-semibold",children:["Section",s.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),s.jsxs("select",{...l.getFieldProps("sectionId"),type:"text",className:"form-control bg-white h-10 block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",placeholder:"Select Discount Group",children:[s.jsx("option",{value:"",children:"Select"}),g==null?void 0:g.map((e,t)=>s.jsx("option",{value:e==null?void 0:e.id,children:e==null?void 0:e.section_name}))]}),s.jsx("span",{className:"text-red-600  text-xs",children:l.touched.sectionId&&l.errors.sectionId?l.errors.sectionId:null})]})]}),l.values.classId!==""&&l.values.sectionId!==""?s.jsxs("div",{className:"col-span-12 mt-4 ",children:[s.jsx("div",{className:"overflow-x-auto shadow-lg border",children:s.jsxs("table",{className:"min-w-full divide-y divide-gray-200 max-[820px]:w-[820px]",children:[s.jsx("thead",{className:"bg-[#E7EFFC] ",children:s.jsxs("tr",{children:[s.jsx("th",{className:"px-6 py-3  text-sm font-bold   tracking-wider",children:"Subject"}),s.jsx("th",{className:"px-6 py-3  text-sm font-bold   tracking-wider",children:"Full Marks"}),s.jsx("th",{className:"px-6 py-3  text-sm font-bold   tracking-wider",children:"Passing Marks"}),s.jsx("th",{className:"px-6 py-3  text-sm font-bold   tracking-wider",children:"Obtained Marks"})]})}),l.values.marks&&l.values.marks.map((e,t)=>s.jsx("tbody",{className:" divide-y divide-gray-200 ",children:s.jsxs("tr",{children:[s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e==null?void 0:e.subject_name}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e==null?void 0:e.full_marks}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e==null?void 0:e.pass_marks}),s.jsx("td",{className:"px-6 py-3 whitespace-nowrap",children:s.jsx("input",{...l.getFieldProps(`marks.${t}.obtMarks`),onChange:r=>X(r.target.value,t),onKeyDown:r=>["e","E","+","-"].includes(r.key)&&r.preventDefault(),className:"  text-center form-control h-10  w-1/2 px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md",type:"number"})})]})}))]})}),s.jsxs("div",{className:"mt-9",children:[" ",s.jsx("div",{className:"flex justify-start",children:s.jsxs("div",{className:"w-full grid-cols-12 col-span-12 grid mt-1 max-[464px]:grid-cols-6",children:[s.jsx("div",{className:"form-group mb-6 col-span-5 md:pr-4 flex justify-start max-[464px]:col-span-6",children:s.jsxs("label",{className:"form-check-label text-gray-800 ml-2 w-full",children:[" ",s.jsxs("span",{className:"inline text-gray-700",children:["Total Marks",s.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]})]})})," ",s.jsxs("div",{className:"form-group mb-6 col-span-2 md:pr-4 flex max-[464px]:col-span-6",children:[s.jsx("input",{...l.getFieldProps("totalMarks"),type:"number",disabled:!0,className:"form-control block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md ",placeholder:"0"}),s.jsx("span",{className:"text-red-600 absolute text-xs",children:l.touched.totalMarks&&l.errors.totalMarks?l.errors.totalMarks:null})]})]})}),s.jsx("div",{className:"flex justify-start",children:s.jsxs("div",{className:"w-full grid-cols-12 col-span-12 grid mt-1 max-[464px]:grid-cols-6",children:[s.jsx("div",{className:"form-group mb-6 col-span-5 md:pr-4 flex justify-start max-[464px]:col-span-6",children:s.jsxs("label",{className:"form-check-label text-gray-800 ml-2 w-full",children:[" ",s.jsxs("span",{className:"inline text-gray-700",children:["Obtained marks",s.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]})]})})," ",s.jsxs("div",{className:"form-group mb-6 col-span-2 md:pr-4 flex max-[464px]:col-span-6",children:[s.jsx("input",{...l.getFieldProps("totalObtainedMarks"),type:"number",disabled:!0,value:p,className:"form-control block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md ",placeholder:"0"}),s.jsx("span",{className:"text-red-600 absolute text-xs",children:l.touched.feeAmount&&l.errors.feeAmount?l.errors.feeAmount:null})]})]})}),s.jsx("div",{className:"flex justify-start",children:s.jsxs("div",{className:"w-full grid-cols-12 col-span-12 grid mt-1 max-[464px]:grid-cols-6",children:[s.jsx("div",{className:"form-group mb-6 col-span-5 md:pr-4 flex justify-start max-[464px]:col-span-6",children:s.jsxs("label",{className:"form-check-label text-gray-800 ml-2 w-full",children:[" ",s.jsxs("span",{className:"inline text-gray-700",children:["Percentage",s.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]})]})})," ",s.jsxs("div",{className:"form-group mb-6 col-span-2 md:pr-4 flex max-[464px]:col-span-6",children:[s.jsx("input",{...l.getFieldProps("percentage"),type:"number",disabled:!0,className:"form-control block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md ",placeholder:"0"}),s.jsx("span",{className:"text-red-600 absolute text-xs",children:l.touched.feeAmount&&l.errors.feeAmount?l.errors.feeAmount:null})]})]})})]})]}):null,s.jsxs("div",{className:"cancel-button-div",children:[s.jsx("div",{className:"    ",children:s.jsx("button",{onClick:()=>j("/marks-tabulation"),type:"button",className:"deactivate-button-master bg-red-500 text-white py-3",children:"Back to List"})}),s.jsx("div",{className:"submit-button-div",children:s.jsx("button",{type:"submit",className:"save-button",children:N!==void 0?"Update":"Save"})})]})]})})})]})})})}export{xe as default};
