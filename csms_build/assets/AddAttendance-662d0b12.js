import{u as ce,r as o,b as ne,S as g,a7 as q,A as j,e as y,R as re,j as t,B as se,a9 as de,aa as oe,ah as S,c as T,du as le,a as ie,g as xe}from"./index-de640f8f.js";import{B as ue}from"./BottomErrorCard-511fba4a.js";import{u as he}from"./useErrorAutoFocusField-42f30de3.js";let pe=T().shape({attendance:le().of(T().shape({description:ie().when("attendanceStatus",{is:p=>p=="2",then:p=>p.required("Description is required").min(3,"Must be at least 3 characters").max(100,"Must be at most 100 characters"),otherwise:p=>p.notRequired()})}))});function Ne(){var E,A,$,F,Y,B,M,R;ce();const{AutoFocusErrorField:p}=he(),{api_retrieve_all_student:fe,api_getactiveClassData:V,api_getSectionData:be,api_student_attendance:O,api_section_group_map:J,api_fetch_student_attendance:z}=xe(),[H,d]=o.useState(!1),[f,m]=o.useState([]),[U,G]=o.useState(!1),[K,Q]=o.useState(null),[k,W]=o.useState([]),[_,b]=o.useState([]),X=()=>{d(!0),j.post(V,{},y()).then(function(e){var a,n,s,h;console.log("Class Data..312312",(a=e==null?void 0:e.data)==null?void 0:a.data),(n=e==null?void 0:e.data)!=null&&n.status?W((s=e==null?void 0:e.data)==null?void 0:s.data):(u(!0,(h=e==null?void 0:e.data)==null?void 0:h.message),b([])),d(!1)}).catch(function(e){console.log("==2 error list...",e),u(!0,"Error occured while fetching data."),b([]),d(!1)})},Z=()=>{if(f){const e=f==null?void 0:f.map(a=>({studentId:a==null?void 0:a.id,admissionNo:a==null?void 0:a.admission_no,classId:a==null?void 0:a.class_id,sectionId:a==null?void 0:a.section_id,rollNo:a==null?void 0:a.roll_no,fullName:a==null?void 0:a.full_name,className:a==null?void 0:a.class_name,sectionName:a==null?void 0:a.section_name,attendanceStatus:"1",description:"",date:q().format("YYYY-MM-DD"),isCheck:!1}));w.setFieldValue("attendance",e)}},w=ne({enableReinitialize:!0,initialValues:{class_id:"",section_id:"",attendance:[{studentId:"",admissionNo:"",classId:"",sectionId:"",rollNo:"",fullName:"",className:"",sectionName:"",attendanceStatus:"",description:"",date:""}]},validationSchema:pe,onSubmit:e=>{var h;if(console.log("values",e),(h=e==null?void 0:e.attendance)==null?void 0:h.some(r=>(r==null?void 0:r.attendanceStatus)=="")){g.fire({icon:"error",title:"Oops...",text:"Please select attendance present, absent or leave for all students!"});return}const s={attendance:e==null?void 0:e.attendance.map(r=>({studentId:r==null?void 0:r.studentId,admissionNo:r==null?void 0:r.admissionNo,classId:e==null?void 0:e.class_id,sectionId:e==null?void 0:e.section_id,attendanceStatus:parseInt(r==null?void 0:r.attendanceStatus),description:r==null?void 0:r.description,attendanceDate:r==null?void 0:r.date})),classId:parseInt(e==null?void 0:e.class_id),sectionId:parseInt(e==null?void 0:e.section_id),attendanceDate:q().format("YYYY-MM-DD")};g.fire({title:"Are you sure?",text:"You want to submit attendance!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, submit it!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(r=>{r.isConfirmed?(d(!0),j.post(O,{...s},y()).then(function(l){var L,P;console.log("Class Data..",l),((L=l==null?void 0:l.data)==null?void 0:L.status)==!0?(g.fire("Submitted!","Attendance has been submitted.","success"),w.resetForm()):u(!0,(P=l==null?void 0:l.data)==null?void 0:P.message),d(!1)}).catch(function(l){console.log("==2 error list...",l),u(!0,"Error occured while fetching data."),d(!1)})):r.dismiss===g.DismissReason.cancel&&g.fire("Cancelled","Your form data is safe :)","error")})}}),{values:c,handleSubmit:v,getFieldProps:D,setFieldValue:i,errors:x,touched:N,isValid:ee,isSubmitting:I,submitCount:C}=w,te=()=>{d(!0),j.post(z,{classId:c==null?void 0:c.class_id,id:c==null?void 0:c.section_id},y()).then(function(e){var a,n,s;console.log("Student Data..Atten",(a=e==null?void 0:e.data)==null?void 0:a.data),(n=e==null?void 0:e.data)!=null&&n.status?m((s=e==null?void 0:e.data)==null?void 0:s.data):m([]),d(!1)}).catch(function(e){console.log("==2 error list...",e),u(!0,"Error occured while fetching data."),d(!1)})};o.useEffect(()=>{X()},[]),o.useEffect(()=>{c!=null&&c.section_id&&te()},[c==null?void 0:c.section_id]),o.useEffect(()=>{f&&Z()},[f]);const ae=()=>{d(!0),j.post(J,{classId:c.class_id},y()).then(function(e){var a,n,s,h;console.log("section Data..213123",(a=e==null?void 0:e.data)==null?void 0:a.data),((n=e==null?void 0:e.data)==null?void 0:n.status)==!0?b((s=e==null?void 0:e.data)==null?void 0:s.data):(u(!0,(h=e==null?void 0:e.data)==null?void 0:h.message),b([])),d(!1)}).catch(function(e){console.log("==2 error list...",e),u(!0,"Error occured while fetching data."),d(!1)})};o.useEffect(()=>{i("section_id",""),c.class_id?(ae(),m([])):(b([]),m([]))},[c==null?void 0:c.class_id]);const u=(e,a)=>{Q(a),G(e)};return re.useEffect(()=>{p({isValid:ee,submitCount:C,isSubmitting:I,errors:x})},[x,C,I]),t.jsxs(t.Fragment,{children:[H&&t.jsx(se,{}),U&&t.jsx(ue,{activateBottomErrorCard:u,errorTitle:K}),t.jsx(de,{value:c,children:t.jsx(oe,{onSubmit:v,children:t.jsx("div",{className:"w-full col-span-10 2xl:py-3 2xl:px-6 px-6 py-2",children:t.jsxs("div",{className:"border-[2px] border-gray-200 rounded-md h-[82vh] 2xl:p-6 p-4 overflow-y-auto",children:[t.jsx("div",{className:"",children:t.jsxs("div",{className:"flex w-full justify-between items-center max-[870px]:block",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-3xl text-center font-semibold text-gray-600 flex flex-start",children:"Add Attendance"}),t.jsx("span",{className:"text-sm text-center font-medium text-teal-600",children:"Unlock Your Potential. Join Our Journey Of Education And Excellence"})]}),t.jsxs("div",{className:"flex gap-6 mt-4 md:mt-0 flex-col lg:flex-row",children:[t.jsx("input",{disabled:!0,type:"text",className:"mt-7 h-8 w-full lg:w-40 form-control block  px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md ",value:Date().toLocaleString().slice(0,15)}),t.jsxs("div",{className:"form-group  md:col-span-2 mb-6 md:px-4",children:[t.jsxs("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold",children:["Class",t.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),t.jsxs("select",{className:"form-control block w-full lg:w-40 px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",...D("class_id"),children:[t.jsx("option",{value:"",children:"Select"}),k==null?void 0:k.map(e=>t.jsx("option",{value:e==null?void 0:e.id,children:e==null?void 0:e.class_name}))]}),t.jsx("span",{className:"text-red-600 text-xs",children:N.class_id&&x.class_id?x.class_id:null})]}),t.jsxs("div",{className:"form-group col-span-12 md:col-span-2 mb-6 md:px-4",children:[t.jsxs("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold",children:["Sections",t.jsx("small",{className:"mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),t.jsxs("select",{...D("section_id"),className:"form-control block w-full lg:w-40 px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",children:[t.jsx("option",{value:"",children:"Select"}),_==null?void 0:_.map(e=>t.jsx("option",{value:e==null?void 0:e.id,children:e==null?void 0:e.section_name}))]}),t.jsx("span",{className:"text-red-600 text-xs",children:N.section_id&&x.section_id?x.section_id:null})]})]})]})}),((E=c==null?void 0:c.attendance)==null?void 0:E.length)>0?t.jsx("div",{className:"flex flex-col",children:t.jsx("div",{className:"overflow-x-auto sm:-mx-6 lg:-mx-8",children:t.jsx("div",{className:"inline-block min-w-full py-2 sm:px-6 lg:px-8",children:t.jsxs("div",{className:"overflow-hidden",children:[t.jsxs("table",{className:"min-w-full border text-center text-sm font-light dark:border-neutral-500",children:[t.jsx("thead",{className:"border-b font-medium dark:border-neutral-500",children:t.jsxs("tr",{children:[t.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 font-medium dark:border-neutral-500",children:"sl.no"}),t.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:"Admission no"}),t.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:"Class"}),t.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:"Section"}),t.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:"Roll No"}),t.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:"Full name"}),t.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:t.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Present",t.jsx("input",{type:"checkbox",className:"h-[18px] w-[18px]",onChange:e=>{var n;const a=(n=c==null?void 0:c.attendance)==null?void 0:n.map(s=>({...s,attendanceStatus:e.target.checked?"1":""}));i("attendance",a)},checked:((A=c==null?void 0:c.attendance)==null?void 0:A.filter(e=>(e==null?void 0:e.attendanceStatus)=="1").length)===(($=c==null?void 0:c.attendance)==null?void 0:$.length)})]})}),t.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:t.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Absent",t.jsx("input",{type:"checkbox",className:"h-[18px] w-[18px]",onChange:e=>{var n;const a=(n=c==null?void 0:c.attendance)==null?void 0:n.map(s=>({...s,attendanceStatus:e.target.checked?"0":""}));i("attendance",a)},checked:((F=c==null?void 0:c.attendance)==null?void 0:F.filter(e=>(e==null?void 0:e.attendanceStatus)=="0").length)===((Y=c==null?void 0:c.attendance)==null?void 0:Y.length)})]})}),t.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:t.jsxs("div",{className:"flex items-center justify-center gap-2",children:["Leave",t.jsx("input",{type:"checkbox",className:"h-[18px] w-[18px]",onChange:e=>{var n;const a=(n=c==null?void 0:c.attendance)==null?void 0:n.map(s=>({...s,attendanceStatus:e.target.checked?"2":""}));i("attendance",a)},checked:((B=c==null?void 0:c.attendance)==null?void 0:B.filter(e=>(e==null?void 0:e.attendanceStatus)==="2").length)===((M=c==null?void 0:c.attendance)==null?void 0:M.length)})]})}),t.jsx("th",{scope:"col",className:"whitespace-nowrap border-r px-4 py-4 dark:border-neutral-500",children:"Description"})]})}),t.jsx("tbody",{children:(R=c==null?void 0:c.attendance)==null?void 0:R.map((e,a)=>t.jsxs("tr",{className:"border-b dark:border-neutral-500",children:[t.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 font-medium dark:border-neutral-500",children:a+1}),t.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:(e==null?void 0:e.admissionNo)||"N/A"}),t.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:e==null?void 0:e.className}),t.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:e==null?void 0:e.sectionName}),t.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:e==null?void 0:e.rollNo}),t.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:e==null?void 0:e.fullName}),t.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:t.jsx("input",{className:"h-[18px] w-[18px]  ",type:"checkbox",value:"1",name:`attendance[${a}].attendanceStatus`,onChange:n=>{i(`attendance[${a}].attendanceStatus`,n.target.value)},checked:(e==null?void 0:e.attendanceStatus)=="1"})}),t.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:t.jsx("input",{className:"h-[18px] w-[18px]",type:"checkbox",value:"0",name:`attendance[${a}].attendanceStatus`,onChange:n=>{i(`attendance[${a}].attendanceStatus`,n.target.value)},checked:(e==null?void 0:e.attendanceStatus)=="0"})}),t.jsx("td",{className:"whitespace-nowrap border-r px-6 py-4 dark:border-neutral-500",children:t.jsx("input",{className:"h-[18px] w-[18px]",type:"checkbox",value:"2",name:`attendance[${a}].attendanceStatus`,onChange:n=>{i(`attendance[${a}].attendanceStatus`,n.target.value)},checked:(e==null?void 0:e.attendanceStatus)=="2"})}),t.jsxs("td",{className:"whitespace-nowrap border-r px-4 py-4 dark:border-neutral-500",children:[t.jsx("input",{disabled:(e==null?void 0:e.attendanceStatus)=="1"||(e==null?void 0:e.attendanceStatus)=="0",type:"text",className:`form-control block w-full px-3 2xl:py-1.5 py-1 2xl:text-base text-sm font-normal text-gray-700  bg-clip-padding border border-solid ${S(N,`attendance[${a}].description`)&&S(x,`attendance[${a}].description`)?"border-red-300 bg-red-50":"border-gray-300 bg-white"} rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 `,name:`attendance[${a}].description`,onChange:n=>{i(`attendance[${a}].description`,n.target.value),(`attendance[${a}].attendanceStatus`=="1"||`attendance[${a}].attendanceStatus`=="0")&&w.setTouched({[`attendance[${a}].description`]:!0})},value:e==null?void 0:e.description}),t.jsx("h1",{className:"text-red-500 text-[11px]",children:S(N,`attendance[${a}].description`)&&S(x,`attendance[${a}].description`)})]})]}))})]}),t.jsx("div",{className:"flex justify-end w-full gap-4 mt-4",children:t.jsx("button",{type:"submit",className:"bg-[#0F766E] text- text-white px-4 py-2 rounded-md mt-4",children:"Submit"})})]})})})}):t.jsx("h1",{className:"text-gray-600 text-center mt-56 text-2xl",children:"No Data Found! please select class and section"})]})})})})]})}export{Ne as default};
