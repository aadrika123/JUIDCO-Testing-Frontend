import{j as e,p as E,_ as w}from"./index-FgAh2Vi0.js";import{P as D}from"./index-BxyVfkOV.js";import{u as F,r as h}from"./router-DLL89Qev.js";import{s as S}from"./index-DXEukT1i.js";import{o as V,c as L,a as n}from"./yup-D0nsuUX4.js";import{b as O,F as R,R as u,B as z}from"./switch-DRO3lH05.js";import{h as c}from"./moment-BjLXg0w5.js";import{a as B}from"./useCustomQuery-BhBLTzQ6.js";import{O as P}from"./OverLayLoader-BxUV0rNF.js";import"./axios-DmypytPv.js";import"./headlessui-DXpdh5LM.js";import"./tslib.es6-CRos2fHm.js";const I=L().shape({vehicleNumber:n().required("Vehicle Number is required"),date:n().required("Date is required"),inTime:n().required("In Time is required"),outTime:n().required("Out Time is required"),receiptNo:n().required("Receipt No is required")});function ae(){const y=F(),a=B({}),[p]=h.useState(null),[_,N]=h.useState(!1),[Y,b]=h.useState(null),r=O({defaultValues:{vehicleNumber:"",date:"",inTime:"",outTime:c().format("HH:mm"),receiptNo:""},resolver:V(I)}),{handleSubmit:H}=r,$=async t=>{var l,m,o,s,d,i,f,v,x,T,j,g;y(`/parking-app/pay-organized-ticket?receipt_no=${t.receiptNo}&out_time=${c().format("HH:mm")}&in_time=${t.inTime}&vehicle_type=${(o=(m=(l=a==null?void 0:a.data)==null?void 0:l.data)==null?void 0:m.data)==null?void 0:o.vehicle_type}&area_id=${(i=(d=(s=a==null?void 0:a.data)==null?void 0:s.data)==null?void 0:d.data)==null?void 0:i.area_id}&ulb_id=${(x=(v=(f=a==null?void 0:a.data)==null?void 0:f.data)==null?void 0:v.data)==null?void 0:x.ulb_id}&scheduler_id=${(g=(j=(T=a==null?void 0:a.data)==null?void 0:T.data)==null?void 0:j.data)==null?void 0:g.scheduler_id}`)},k=async()=>{N(!0),b(null);const t=await S.createWorker({logger:s=>{}});await t.load(),await t.loadLanguage("eng"),await t.initialize("eng");const{data:{text:l}}=await t.recognize(p),o=l.split(`
`).find(s=>s.length==10);if(!o){b("Vehicle Number not found"),N(!1),await t.terminate(),N(!1);return}r.setValue("vehicleNumber",o),await t.terminate()};h.useEffect(()=>{p&&k()},[p]);const q=async()=>{var t,l,m,o,s,d;if(r.watch("vehicleNumber"))try{const i=await a.mutateAsync({api:`${E.getOutTicket}/${r.watch("vehicleNumber").toUpperCase()}`,data:{}});i!=null&&i.data.error?(w.error("Data Not Found"),r.reset({vehicleNumber:r.watch("vehicleNumber"),date:"",inTime:"",outTime:c().format("HH:mm"),receiptNo:""})):r.reset({vehicleNumber:r.watch("vehicleNumber"),receiptNo:(l=(t=i==null?void 0:i.data)==null?void 0:t.data)==null?void 0:l.receipt_no,date:c((o=(m=i==null?void 0:i.data)==null?void 0:m.data)==null?void 0:o.date).format("YYYY-MM-DD"),inTime:(d=(s=i==null?void 0:i.data)==null?void 0:s.data)==null?void 0:d.in_time,outTime:c().format("HH:mm")})}catch{w.error("Data Not Found"),r.reset({vehicleNumber:r.watch("vehicleNumber"),date:"",inTime:"",outTime:c().format("HH:mm"),receiptNo:""})}};return e.jsxs(D,{title:"Home",children:[(a==null?void 0:a.isPending)&&e.jsx(P,{}),e.jsx("div",{className:"py-4 mt-2 mx-auto px-4",children:e.jsx("div",{children:e.jsx("div",{className:"px-8",children:e.jsx(R,{methods:r,onSubmit:H($),children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 ",children:[e.jsx("div",{className:"col-span-2",children:e.jsx(u,{className:"w-full h-10 border border-gray-300 rounded-lg uppercase",name:"vehicleNumber",onBlur:q,label:"Vehicle Number",placeholder:"Enter Vehicle Number",inputValidation:["removeSpace","vehicleNumber"]})}),e.jsx("div",{className:"col-span-2",children:e.jsx(u,{disabled:!0,name:"date",label:"Date",type:"date",placeholder:"Enter Date"})}),e.jsx("div",{children:e.jsx(u,{disabled:!0,name:"inTime",type:"time",label:"In Time",placeholder:"Enter In Time"})}),e.jsx("div",{children:e.jsx(u,{disabled:!0,name:"outTime",type:"time",label:"Out Time",placeholder:"Enter Out Time"})}),e.jsx("div",{className:"col-span-2",children:e.jsx(u,{disabled:!0,name:"receiptNo",label:"Receipt No",placeholder:"Enter Receipt No"})}),e.jsx("div",{className:"col-span-2 flex justify-center w-full mt-4",children:e.jsx(z,{type:"submit",size:"sm",className:"w-full",children:_?"Loading...":"Pay Ticket"})})]})})})})})]})}export{ae as default};
