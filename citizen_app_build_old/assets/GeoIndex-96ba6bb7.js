import{R as C,_ as ue,f as Ze,r as l,u as De,c as et,d as F,A as O,b as s,F as N,j as e,M as me,P as tt}from"./index-02f90fa3.js";import{u as st}from"./formik.esm-ac1f6228.js";import{I as pe}from"./full.esm-723eee0f.js";import{A as at}from"./ApiHeader2-b363f7b8.js";import{c as lt,b as G}from"./index.esm-5c2f65fb.js";import{u as ge}from"./useSetTitle-abb53869.js";/* empty css                */import{u as nt}from"./useCustomGeoLocation-e1220fa6.js";import{r as V}from"./resizeImage-f1558408.js";import"./hoist-non-react-statics.cjs-6e0de22a.js";const z="/assets/photo-506bbc5b.png",it=C.lazy(()=>ue(()=>import("./CommonLoader-2dc187a9.js"),["assets/CommonLoader-2dc187a9.js","assets/index-02f90fa3.js","assets/index-a15f3b02.css","assets/BeatLoader-1298beeb.js"])),rt=C.lazy(()=>ue(()=>import("./ForwardScreen-bd9d462e.js"),["assets/ForwardScreen-bd9d462e.js","assets/index-02f90fa3.js","assets/index-a15f3b02.css","assets/full.esm-723eee0f.js","assets/Hourglass-8d1547f1.js","assets/hoist-non-react-statics.cjs-6e0de22a.js"])),vt=()=>{const{notify:w,roleName:y}=C.useContext(Ze),{isGeolocationAvailable:ot,isGeolocationEnabled:fe,coords:o,getPosition:ct}=nt(),[n,M]=l.useState(),[_,he]=l.useState(null),q=De(),[xe,L]=l.useState(""),[be,Ne]=l.useState(),[U,B]=l.useState(null),[c,we]=l.useState(),[ye,$]=l.useState(!1),[ve,Ie]=l.useState(),[T,H]=l.useState(null),[d,Se]=l.useState(),[_e,Y]=l.useState(!1),[Fe,Ce]=l.useState(),[A,J]=l.useState(null),[m,Le]=l.useState(),[Ue,K]=l.useState(!1),[P,dt]=l.useState(0),[mt,Te]=l.useState(!1),[Ae,v]=l.useState(!1),[Pe,j]=l.useState(""),[Q,g]=l.useState(!1),{getTcData:je,api_getStaticSafDetails:ke,api_getgbSafDetails:Re,post_safGeoTagging:Ee,post_gbSafGeoTagging:Oe}=tt(),{id:b,type:p,isBack:W}=et();p=="saf"&&ge("SAF Geo-Tagging"),p=="gbSaf"&&ge("GB SAF Geo-Tagging"),l.useEffect(()=>{setTimeout(()=>{g(!1)},1e4),g(!0),y=="utc"&&ze(),p=="saf"?Ve():Ge()},[y,p,b]);const Ge=()=>{F.post(Re,{applicationId:b},O()).then(t=>{var a;console.log("getting application data => ",t),M((a=t==null?void 0:t.data)==null?void 0:a.data)}).catch(t=>{console.log("getting application data error => ",t)}).finally(()=>g(!1))},Ve=()=>{F.post(ke,{applicationId:b},O()).then(t=>{var a;console.log("getting application data => ",t),y=="tc"&&g(!1),M((a=t==null?void 0:t.data)==null?void 0:a.data)}).catch(t=>{console.log("getting application data error => ",t),y=="tc"&&g(!1)})},ze=()=>{F.post(je,{safId:b},O()).then(t=>{var a,i,f,h;((a=t==null?void 0:t.data)==null?void 0:a.status)==!0&&(console.log("getting tc data => ",t),he((f=(i=t==null?void 0:t.data)==null?void 0:i.data)==null?void 0:f.geoTagging),g(!1)),((h=t==null?void 0:t.data)==null?void 0:h.status)==!1&&(g(!1),q("/search/property"),w("Please try again after sometime !!!","error"))}).catch(t=>{console.log("error getting tc data => ",t),q("/search/property"),w("Something went wrong !!!","error"),g(!1)})},Me=lt({frontImage:G().required("required to upload"),leftImage:G().required("required to upload"),rightImage:G().required("required to upload")}),r=st({initialValues:{frontImage:"",leftImage:"",rightImage:""},onSubmit:t=>{if(console.log("submitting images => ",t),(n==null?void 0:n.payment_status)==0){X();return}else v(!0),j("forward")},validationSchema:Me}),X=()=>{g(!0);let t;p=="saf"&&(t=Ee),p=="gbSaf"&&(t=Oe);let a=new FormData;a.append("safId",b),a.append("directionType[2]","Front"),ye?a.append("imagePath[2]",U):a.append("imagePath[2]",be),a.append("longitude[2]",c==null?void 0:c.longitude),a.append("latitude[2]",c==null?void 0:c.latitude),a.append("directionType[1]","Right"),_e?a.append("imagePath[1]",T):a.append("imagePath[1]",ve),a.append("longitude[1]",d==null?void 0:d.longitude),a.append("latitude[1]",d==null?void 0:d.latitude),a.append("directionType[0]","Left"),Ue?a.append("imagePath[0]",A):a.append("imagePath[0]",Fe),a.append("longitude[0]",m==null?void 0:m.longitude),a.append("latitude[0]",m==null?void 0:m.latitude),F.post(t,a,at()).then(i=>{var f,h,I;((f=i==null?void 0:i.data)==null?void 0:f.status)==!0&&(console.log("success images",i),w("Geo-Tagged Successfully","success"),(n==null?void 0:n.payment_status)==0?window.location.replace(`/property/viewDemand/${b}`):(L("true"),Te(!0))),((h=i==null?void 0:i.data)==null?void 0:h.status)==!1&&(console.log("error images",i),w((I=i==null?void 0:i.data)==null?void 0:I.message,"error"),alert(i==null?void 0:i.data),L("false"),v(!1))}).catch(i=>{console.log("error images => ",i),w("Server Error","error"),alert(i),L("false"),v(!1)}).finally(()=>g(!1))};l.useState(null),l.useState(0);const Z=l.useRef(null),k=l.useRef(null),[u,D]=l.useState(null),qe=()=>{k.current.getContext("2d").drawImage(Z.current,0,0);const a=k.current.toDataURL("image/jpg");D(a),console.log("image data captured => ",a)},R=async t=>{var a,i,f,h,I,te,se,ae,le,ne,ie,re,oe,ce,de;if(!fe){w("Please enable location first !!!","error"),t.target.value=null;return}if(t.target.name=="frontImage"){$(!1);const S=await V((a=t==null?void 0:t.target)==null?void 0:a.files[0]);we({latitude:o==null?void 0:o.latitude,longitude:o==null?void 0:o.longitude});const x=new File([S],(f=(i=t==null?void 0:t.target)==null?void 0:i.files[0])==null?void 0:f.name,{type:(I=(h=t==null?void 0:t.target)==null?void 0:h.files[0])==null?void 0:I.type});Ne(x),B(URL.createObjectURL(x)),r.setFieldValue("flongitude",c==null?void 0:c.longitude),r.setFieldValue("flatitude",c==null?void 0:c.latitude)}if(t.target.name=="rightImage"){Y(!1);const S=await V((te=t==null?void 0:t.target)==null?void 0:te.files[0]);Se({latitude:o==null?void 0:o.latitude,longitude:o==null?void 0:o.longitude});const x=new File([S],(ae=(se=t==null?void 0:t.target)==null?void 0:se.files[0])==null?void 0:ae.name,{type:(ne=(le=t==null?void 0:t.target)==null?void 0:le.files[0])==null?void 0:ne.type});Ie(x),H(URL.createObjectURL(x)),r.setFieldValue("rlongitude",d==null?void 0:d.longitude),r.setFieldValue("rlatitude",d==null?void 0:d.latitude)}if(t.target.name=="leftImage"){K(!1);const S=await V((ie=t==null?void 0:t.target)==null?void 0:ie.files[0]);Le({latitude:o==null?void 0:o.latitude,longitude:o==null?void 0:o.longitude});const x=new File([S],(oe=(re=t==null?void 0:t.target)==null?void 0:re.files[0])==null?void 0:oe.name,{type:(de=(ce=t==null?void 0:t.target)==null?void 0:ce.files[0])==null?void 0:de.type});Ce(x),J(URL.createObjectURL(x)),r.setFieldValue("llongitude",m==null?void 0:m.longitude),r.setFieldValue("llatitude",m==null?void 0:m.latitude)}},[Be,$e]=l.useState(!1),[He,ee]=l.useState(!1),Ye=t=>{ee(!0),D(t)},E=()=>{$e(!1),ee(!1)},Je=()=>{},Ke=()=>{},Qe=()=>{const t=document.createElement("a");t.href=u,P==1&&($(!0),B(u),r.setFieldValue("frontImage",u)),P==2&&(Y(!0),H(u),r.setFieldValue("rightImage",u)),P==3&&(K(!0),J(u),r.setFieldValue("leftImage",u)),t.click(),E()},We=()=>{v(!0),j("forward")},Xe=()=>{v(!0),j("backward")};return s(N,{children:[Q&&e(it,{}),e(rt,{roleName:y,action:Pe,openScreen:Ae,id:b,navigation:()=>X(),closePopUp:()=>v(!1),canSubmit:xe,type:p}),s("div",{className:"w-full",children:[e("h1",{className:"text-center text-base font-semibold border-b-2 py-2 border-[#838FCE] mx-4",children:"Field Verification Geo-Tagging"}),s("div",{className:"p-4 flex flex-col gap-y-4 rounded-sm",children:[s("div",{className:"w-full items-center justify-center px-4  py-4 shadow-sm flex md:flex-row flex-col flex-wrap gap-2 md:justify-evenly bg-indigo-50",children:[s("span",{className:"grid grid-cols-12 w-full text-sm gap-2 my-1",children:[e("span",{className:"col-span-6",children:"Your Application No.:"})," ",e("span",{className:"font-medium text-sm col-span-6",children:n==null?void 0:n.saf_no})]}),s("span",{className:"grid grid-cols-12 w-full text-sm  gap-2 my-1",children:[e("span",{className:"col-span-6",children:"Application Type:"})," ",e("span",{className:"font-medium text-sm col-span-6",children:n==null?void 0:n.assessment_type})]}),s("span",{className:"grid grid-cols-12 w-full text-sm  gap-1",children:[s("span",{className:"col-span-6",children:[p=="saf"&&"Property",p=="gbSaf"&&"Govt. Building Usage"," Type:"]})," ",s("span",{className:"font-medium text-sm col-span-6",children:[p=="saf"&&(n==null?void 0:n.property_type),p=="gbSaf"&&(n==null?void 0:n.building_type)]})]}),s("span",{className:"grid grid-cols-12 w-full text-sm  gap-2 my-1",children:[e("span",{className:"col-span-6",children:"Apply Date:"})," ",e("span",{className:"font-medium text-sm col-span-6",children:n==null?void 0:n.application_date})]})]}),y=="tc"?e(N,{children:!Q&&s("form",{className:"border-1 border-[#838FCE] mb-4 rounded-md border shadow-md p-1",onChange:r.handleChange,onSubmit:r.handleSubmit,children:[e("h1",{className:"text-center rounded-md font-semibold uppercase text-sm py-1",children:"Upload Image"}),(W=="true"||W==!0)&&e("span",{className:"text-red-500 text-xs text-center pl-4 font-semibold pt-2",children:"Backwarded for Geo-Tagging"}),s("div",{className:"my-2 mx-1 rounded-md shadow-lg",children:[e("div",{className:"text-white bg-[#838FCE] px-2 py-1.5 text-sm font-semibold rounded-t-md",children:"Front Image"}),e("div",{className:"px-2 py-2",children:s("div",{className:"grid grid-cols-12 text-sm pb-2 px-2",children:[e("span",{className:" col-span-12 font-semibold flex justify-center items-center mb-2",children:e("img",{src:U??z,alt:"Front Image",srcSet:"",className:"w-32 rounded-md"})}),s("span",{className:"col-span-12 grid grid-cols-12 mb-2",children:[e("span",{className:"col-span-8 text-sm flex items-center",children:"Capture Image :"}),e("span",{className:"col-span-5 text-xs mr-2",children:e("input",{type:"file",onChange:R,name:"frontImage",id:"",accept:"image/*",className:"bg-white px-2 py-1 w-full rounded-sm shadow-sm border-[1px] border-gray-400"})})]}),s("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Latitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:c==null?void 0:c.latitude})})]}),s("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Longitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:c==null?void 0:c.longitude})})]}),e("span",{className:"col-span-12 mt-2 text-center",children:r.touched.frontImage&&r.errors.frontImage&&e(N,{children:e("span",{className:"text-red-600 text-xs",children:r.errors.frontImage})})})]})})]}),s("div",{className:"my-2 mx-1 rounded-md shadow-lg",children:[e("div",{className:"text-white bg-[#838FCE] px-2 py-1.5 text-sm font-semibold rounded-t-md",children:"Right Image"}),e("div",{className:"px-2 py-2",children:s("div",{className:"grid grid-cols-12 text-sm pb-2 px-4",children:[e("span",{className:" col-span-12 font-semibold flex justify-center items-center mb-2",children:e("img",{src:T??z,alt:"Front Image",srcSet:"",className:"w-32 rounded-md"})}),s("span",{className:"col-span-12 grid grid-cols-12 mb-2",children:[e("span",{className:"col-span-8 text-sm flex items-center",children:"Capture Image :"}),e("span",{className:"col-span-5 text-xs mr-1",children:e("input",{type:"file",onChange:R,name:"rightImage",id:"",accept:"image/*",className:"bg-white px-2 py-1 w-full rounded-sm shadow-sm border-[1px] border-gray-400"})})]}),s("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Latitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:d==null?void 0:d.latitude})})]}),s("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Longitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:d==null?void 0:d.longitude})})]}),e("span",{className:"col-span-12 mt-2 text-center",children:r.touched.rightImage&&r.errors.rightImage&&e(N,{children:e("span",{className:"text-red-600 text-xs",children:r.errors.rightImage})})})]})})]}),s("div",{className:"my-2 mx-1 rounded-md shadow-lg",children:[e("div",{className:"text-white bg-[#838FCE] px-2 py-1.5 text-sm font-semibold rounded-t-md",children:"Left Image"}),e("div",{className:"px-2 py-2",children:s("div",{className:"grid grid-cols-12 text-sm pb-2 px-4",children:[e("span",{className:" col-span-12 font-semibold flex justify-center items-center mb-2",children:e("img",{src:A??z,alt:"Front Image",srcSet:"",className:"w-32 rounded-md"})}),s("span",{className:"col-span-12 grid grid-cols-12 mb-2",children:[e("span",{className:"col-span-8 text-sm flex items-center",children:"Capture Image :"}),e("span",{className:"col-span-5 text-xs mr-1",children:e("input",{type:"file",onChange:R,name:"leftImage",id:"",accept:"image/*",className:"bg-white px-2 py-1 w-full rounded-sm shadow-sm border-[1px] border-gray-300"})})]}),s("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Latitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:m==null?void 0:m.latitude})})]}),s("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Longitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:m==null?void 0:m.longitude})})]}),e("span",{className:"col-span-12 mt-2 text-center",children:r.touched.leftImage&&r.errors.leftImage&&e(N,{children:e("span",{className:"text-red-600 text-xs",children:r.errors.leftImage})})})]})})]}),e("div",{className:"w-full flex justify-center m-2",children:e("button",{type:"submit",className:"px-4 py-1.5 mr-4 text-sm text-white rounded-md shadow-md bg-green-500 hover:bg-green-600 focus:bg-green-600",children:(n==null?void 0:n.payment_status)==0?"Submit & Pay":"Forward"})})]})}):e(N,{children:e("div",{className:"w-full",children:s("div",{className:"border-2 border-blue-700 bg-blue-50 mb-4",children:[e("h1",{className:"text-center font-semibold bg-blue-700 text-white uppercase text-lg",children:"Images"}),Array.isArray(_)&&(_==null?void 0:_.map((t,a)=>e(C.Fragment,{children:s("div",{className:"bg-indigo-50 border-2 border-indigo-500 my-2 mx-1",children:[s("div",{className:"text-white bg-indigo-500 px-2 font-semibold capitalize",children:[t==null?void 0:t.direction_type," Image"]}),e("div",{className:"px-2 py-2",children:s("div",{className:"grid grid-cols-12 text-sm pb-2 px-2",children:[e("span",{className:" col-span-12 font-semibold flex justify-center items-center mb-2",onClick:()=>Ye(t==null?void 0:t.doc_path),children:e("img",{src:`${t==null?void 0:t.doc_path}`,alt:t==null?void 0:t.direction_type,srcSet:"",className:"w-3 rounded-md2"})}),s("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Latitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:t==null?void 0:t.latitude})})]}),s("span",{className:"col-span-12 grid grid-cols-12",children:[e("span",{className:"col-span-6 text-sm flex items-center",children:"Longitude :"}),e("span",{className:"col-span-6 text-sm",children:e("span",{className:"font-semibold text-sm",children:t==null?void 0:t.longitude})})]})]})})]})},a))),s("div",{className:"w-full flex items-center justify-between m-2",children:[e("button",{onClick:()=>Xe(),className:"px-4 py-1.5 mr-4 text-sm text-white rounded-sm shadow-md bg-red-500 hover:bg-red-600 focus:bg-red-600",children:"Backward"}),e("button",{onClick:()=>We(),className:"px-4 py-1.5 mr-4 text-sm text-white rounded-sm shadow-md bg-green-500 hover:bg-green-600 focus:bg-green-600",children:"Forward"})]})]})})})]})]}),e(me,{isOpen:Be,onAfterOpen:Je,className:"z-50 h-screen w-screen backdrop-blur-sm flex flex-row justify-center items-center overflow-auto",contentLabel:"Example Modal",children:s("div",{className:" animate__animated animate__zoomIn animate__faster rounded-lg md:ml-24 shadow-lg relative bg-gray-50 px-4 py-4 w-[90vw] mt-10 z-50 border-t-2 border-l-2 border-white overflow-auto",children:[e("div",{className:"absolute top-2 z-10 bg-red-200 hover:bg-red-300 right-2 rounded-full p-2 cursor-pointer",onClick:E,children:e(pe,{fontSize:10})}),s("div",{className:"mt-6 w-full",children:[e("video",{ref:Z,autoPlay:!0,className:""}),e("canvas",{ref:k,style:{display:"none"}}),e("div",{className:"w-full text-center my-4",children:e("button",{onClick:qe,className:"text-sm px-4 py-1 bg-indigo-500 hover:bg-indigo-600 focus:bg-indigo-600 text-white rounded-md shadow-md",children:"Capture"})}),u&&s(N,{children:[e("img",{src:u,alt:"Captured Image"}),e("div",{className:"w-full text-center my-4",children:e("button",{onClick:Qe,className:"text-sm px-4 py-1 bg-indigo-500 hover:bg-indigo-600 focus:bg-indigo-600 text-white rounded-md shadow-md",children:"Save"})})]})]})]})}),e(me,{isOpen:He,onAfterOpen:Ke,className:"z-20 h-screen w-screen backdrop-blur-sm flex flex-row justify-center items-center overflow-auto",contentLabel:"Example Modal",children:s("div",{className:" animate__animated animate__zoomIn animate__faster relative rounded-lg shadow-xl border-2 border-gray-50 px-0",style:{width:"95vw",height:"80vh"},children:[e("div",{className:"absolute top-2 z-40 bg-red-200 hover:bg-red-300 right-2 rounded-full p-2 cursor-pointer",onClick:E,children:e(pe,{fontSize:10})}),e("div",{className:"w-full h-[77vh] overflow-auto flex flex-wrap items-center justify-center",children:e("img",{src:u,alt:"",srcSet:""})})]})})]})};export{vt as default};
