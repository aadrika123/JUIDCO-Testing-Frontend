import{Q as b,j as t,b as p,P as N,R as P,F as k,u as V}from"./index-02f90fa3.js";import{u as T}from"./formik.esm-ac1f6228.js";import{c as v,a as x,f as $}from"./index.esm-5c2f65fb.js";import{F as O,T as q,L as R,P as F}from"./LoadingButton-e84c4856.js";import{u as C}from"./useCustomQuery-f7224d32.js";import"./hoist-non-react-statics.cjs-6e0de22a.js";import"./ThemeStyle-994f51bc.js";import"./index.esm-fa7f7591.js";import"./ApiHeader2-b363f7b8.js";const A=v({mobile:x().required("Enter mobile number")});function j({next:g,data:e,setData:d}){const{mutateAsync:o}=C({}),{send_otp:h}=N(),c=T({enableReinitialize:!0,initialValues:{mobile:e.mobile||""},validationSchema:A,onSubmit:async(u,{})=>{var i,s,f;try{const a=await o({api:h,data:{mobile:u.mobile}});(i=a==null?void 0:a.data)!=null&&i.status?(g({...e,mobile:u.mobile}),b.success((s=a==null?void 0:a.data)==null?void 0:s.message)):b.error((f=a==null?void 0:a.data)==null?void 0:f.message)}catch(a){b.error(a==null?void 0:a.message)}}});return t("div",{className:"py-10",children:p(O,{formik:c,children:[p("div",{className:"mb-5",children:[t(q,{label:"Mobile",name:"mobile",type:"text",formik:c,placeholder:"Enter your register mobile no"})," "]}),t(R,{type:c.isSubmitting?"button":"submit",disabled:c.isSubmitting,loading:c.isSubmitting,children:"SEND OTP"})]})})}const I=g=>{const[e,d]=P.useState(0),[o,h]=P.useState(!1);P.useEffect(()=>{let s;return o?(d(60*g),s=setInterval(()=>{d(f=>f-1)},1e3)):clearInterval(s),()=>clearInterval(s)},[o]),P.useEffect(()=>{e<0&&o&&(h(!1),d(0))},[e,o]);const c=()=>h(s=>!s),u=String(e%60).padStart(2,0);return{minutes:String(Math.floor(e/60)).padStart(2,0),seconds:u,togglerTimer:c,runTimer:o}},L=I,z=v().shape({otp:x().required("OTP is required")});function M({next:g,data:e,setData:d,prev:o}){const{minutes:h,seconds:c,togglerTimer:u,runTimer:i}=L(.5),{verify_otp:s}=N(),{mutateAsync:f,isLoading:a}=C({}),m=T({enableReinitialize:!0,initialValues:{mobile:(e==null?void 0:e.mobile)||"",otp:(e==null?void 0:e.otp)||""},validationSchema:z,onSubmit:async(w,{})=>{var S,y,r,D,E;try{const n=await f({api:s,data:{mobile:w==null?void 0:w.mobile,Otp:w==null?void 0:w.otp}});console.log(n),(S=n==null?void 0:n.data)!=null&&S.status?(g({...e,otp:w.otp,token:(r=(y=n==null?void 0:n.data)==null?void 0:y.data)==null?void 0:r.token}),b.success((D=n==null?void 0:n.data)==null?void 0:D.message)):b.error((E=n==null?void 0:n.data)==null?void 0:E.message)}catch(n){b.error(n==null?void 0:n.message)}}});P.useEffect(()=>(u(),()=>{u()}),[]);const l=async()=>{var w,S,y;try{const r=await f({api:s,data:{mobile:e==null?void 0:e.mobile}});(w=r==null?void 0:r.data)!=null&&w.status?(b.success((S=r==null?void 0:r.data)==null?void 0:S.message),d({...e,otp:""}),m.setFieldValue("otp",""),u()):b.error((y=r==null?void 0:r.data)==null?void 0:y.message)}catch(r){b.error(r==null?void 0:r.message)}};return t("div",{className:"py-2",children:p(O,{formik:m,children:[p("h1",{className:"text-sm mt-8 mb-4",children:["Please enter the 6-digit verification code sent to your phone number",m==null?void 0:m.values.mobile," ",t("span",{className:"text-sm text-blue-700",onClick:()=>o({mobile:m==null?void 0:m.values.mobile,otp:""}),children:"Edit"})]}),t("div",{className:"mb-5",children:t(q,{label:"Verify OTP",name:"otp",type:"text",formik:m})}),t(R,{type:m.isSubmitting?"button":"submit",disabled:m.isSubmitting,loading:m.isSubmitting,className:"mb-5",children:"Verify OTP"}),p("div",{className:"text-center  text-sm",children:["Didn't receive the code?"," ",a?t("small",{className:"text-gray-700 text-sm",children:"Please wait..."}):t(k,{children:i?p("span",{className:"text-gray-700 cursor-pointer",children:["Resend in ",h,":",c]}):t("span",{className:"text-blue-700 cursor-pointer",onClick:l,children:"Resend OTP"})})]})]})})}const _=v().shape({newPassword:x().required("New Password is required"),confirmPassword:x().required("Confirm Password is required").oneOf([$("newPassword"),null],"Passwords must match")});function B({next:g,data:e,setData:d,prev:o}){const h=V(),{reset_password:c}=N(),{mutateAsync:u}=C({}),i=T({enableReinitialize:!0,initialValues:{newPassword:"",confirmPassword:""},validationSchema:_,onSubmit:async(s,{})=>{var f,a,m;try{const l=await u({api:c,data:{token:e==null?void 0:e.token,password:s==null?void 0:s.newPassword}});(f=l==null?void 0:l.data)!=null&&f.status?(g(s,!0),b.success((a=l==null?void 0:l.data)==null?void 0:a.message),h("/")):b.error((m=l==null?void 0:l.data)==null?void 0:m.message)}catch(l){b.error(l==null?void 0:l.message)}}});return t("div",{className:"py-10",children:p(O,{formik:i,children:[t("h1",{className:"text-lg mt-5 mb-4 font-semibold",children:"Create New Password"}),t(F,{label:"New Password",name:"newPassword",formik:i}),t(F,{label:"Confirm Password",name:"confirmPassword",formik:i}),t(R,{type:i.isSubmitting?"button":"submit",disabled:i.isSubmitting,loading:i.isSubmitting,children:"RESET PASSWORD"})]})})}function Z(){const[g,e]=P.useState(0),[d,o]=P.useState({mobile:"",otp:"",newPassword:"",confirmPassword:"",token:""}),h=i=>{console.log(i)},c=(i,s=!1)=>{if(o({...d,...i}),s){h(i);return}e(g+1)},u=i=>{o({...d,...i}),e(g-1)};return t(k,{children:t("div",{children:{0:t(j,{next:c,data:d,setData:o}),1:t(M,{next:c,prev:u,data:d,setData:o}),2:t(B,{next:c,prev:u,data:d,setData:o})}[g]})})}export{Z as default};
