import{r as h,j as c,u as wt,f as xt,d as ct,A as rt,F as nt,b as p,L as vt,P as Ct}from"./index-02f90fa3.js";import{u as It}from"./formik.esm-ac1f6228.js";import{c as pt,b as yt,a as dt}from"./index.esm-5c2f65fb.js";/* empty css                */import{R as St}from"./Hourglass-8d1547f1.js";import{T as b,F as Et}from"./LoadingButton-e84c4856.js";import"./hoist-non-react-statics.cjs-6e0de22a.js";import"./ThemeStyle-994f51bc.js";import"./index.esm-fa7f7591.js";/*! js-cookie v3.0.5 | MIT */function y(a){for(var u=1;u<arguments.length;u++){var m=arguments[u];for(var d in m)a[d]=m[d]}return a}var bt={read:function(a){return a[0]==='"'&&(a=a.slice(1,-1)),a.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(a){return encodeURIComponent(a).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function N(a,u){function m(e,o,i){if(!(typeof document>"u")){i=y({},u,i),typeof i.expires=="number"&&(i.expires=new Date(Date.now()+i.expires*864e5)),i.expires&&(i.expires=i.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var f="";for(var l in i)i[l]&&(f+="; "+l,i[l]!==!0&&(f+="="+i[l].split(";")[0]));return document.cookie=e+"="+a.write(o,e)+f}}function d(e){if(!(typeof document>"u"||arguments.length&&!e)){for(var o=document.cookie?document.cookie.split("; "):[],i={},f=0;f<o.length;f++){var l=o[f].split("="),v=l.slice(1).join("=");try{var r=decodeURIComponent(l[0]);if(i[r]=a.read(v,r),e===r)break}catch{}}return e?i[e]:i}}return Object.create({set:m,get:d,remove:function(e,o){m(e,"",y({},o,{expires:-1}))},withAttributes:function(e){return N(this.converter,y({},this.attributes,e))},withConverter:function(e){return N(y({},this.converter,e),this.attributes)}},{attributes:{value:Object.freeze(u)},converter:{value:Object.freeze(a)}})}var Nt=N(bt,{path:"/"});const Rt=()=>{const[a,u]=h.useState(""),m=()=>{const l=Math.random().toString(36).slice(2,8).toUpperCase();u(l)},d=(l,v)=>l===a?!0:(v({captcha:""},!1),m(),!1),e=document.createElement("canvas");e.style.margin="0",e.style.padding="0",e.width=100,e.height=22;const o=e.getContext("2d");o.font="bold 15px Arial",o.fillStyle="blue",o.fillText(a,21,16);const i=e.toDataURL();return h.useEffect(()=>{m()},[]),{catptchaTextField:l=>c("div",{children:c(b,{name:"captcha",placeholder:"Enter captcha",formik:l})}),captcha:a,dataUrl:i,verifyCaptcha:d,generateCaptcha:m}},Pt=()=>{const a=wt(),{catptchaTextField:u,dataUrl:m,generateCaptcha:d,verifyCaptcha:e}=Rt(),{notify:o,setisLoggedIn:i,setheartBeatCounter:f}=h.useContext(xt),[l,v]=h.useState(null),[r,R]=h.useState(),{api_login:st,api_getPermission:mt}=Ct(),[S,w]=h.useState(!1),ut=pt({email:yt().required("Enter email"),password:dt().required("Enter password"),captcha:dt().required("Enter captcha")}),g=It({initialValues:{email:"",password:"",type:"mobile",captcha:""},onSubmit:async(n,{resetForm:t})=>{e(n==null?void 0:n.captcha,t)?ht():o("Invalid Captcha")},validationSchema:ut}),A=["TAX COLLECTOR","ULB TAX COLLECTOR","TEAM LEADER","JUNIOR ENGINEER","TAX DAROGA","DRIVER","SEPTIC TANKER DRIVER","ENFORCEMENT OFFICER","CONDUCTOR"],ft=h.useMemo(()=>Array.isArray(l)&&l.some(n=>A.includes(n)),[l]);h.useEffect(()=>{var n,t,x,C;l!=null&&(ft?(o("Login Successfull !!! ","success"),window.localStorage.setItem("menuList",JSON.stringify((n=r==null?void 0:r.userDetails)==null?void 0:n.menuPermission)),window.localStorage.setItem("userName",JSON.stringify((t=r==null?void 0:r.userDetails)==null?void 0:t.name)),window.localStorage.setItem("conductorId",(x=r==null?void 0:r.userDetails)==null?void 0:x.user_name),window.localStorage.setItem("roles",JSON.stringify((C=r==null?void 0:r.userDetails)==null?void 0:C.role)),a("/dashboard")):o("You don't have permission of Tax Collector !!!","warn"))},[l]);const E=JSON.parse(window.localStorage.getItem("roles")),I=window.localStorage.getItem("token"),gt=h.useMemo(()=>Array.isArray(E)&&E.some(n=>A.includes(n)),[E,I]);h.useEffect(()=>{I!=""&&I!=null&&I!=null&&gt&&a("/dashboard")},[]);const ht=()=>{w(!0);let n={email:g.values.email,password:g.values.password,type:"mobile"};console.log("--1--before login send...",n),ct.post(st,n,rt()).then(function(t){var x,C,F,O,T,D,L,k,U,j,P,V,B,J,M,_,q,X,$,z,G,H,K,W,Y,Q,Z,tt,et,at;console.log("login response => ",t),t.data.status==!0?(console.log("--2--login response...",t),window.localStorage.setItem("token",(C=(x=t==null?void 0:t.data)==null?void 0:x.data)==null?void 0:C.token),window.localStorage.setItem("isLoggedIn",!0),window.localStorage.setItem("userEmail",(T=(O=(F=t==null?void 0:t.data)==null?void 0:F.data)==null?void 0:O.userDetails)==null?void 0:T.email),window.localStorage.setItem("userName",(k=(L=(D=t==null?void 0:t.data)==null?void 0:D.data)==null?void 0:L.userDetails)==null?void 0:k.name),window.localStorage.setItem("conductorId",(P=(j=(U=t==null?void 0:t.data)==null?void 0:U.data)==null?void 0:j.userDetails)==null?void 0:P.user_name),window.localStorage.setItem("userType",(J=(B=(V=t==null?void 0:t.data)==null?void 0:V.data)==null?void 0:B.userDetails)==null?void 0:J.user_type),window.localStorage.setItem("userMobile",(q=(_=(M=t==null?void 0:t.data)==null?void 0:M.data)==null?void 0:_.userDetails)==null?void 0:q.mobile),window.localStorage.setItem("ulbId",(z=($=(X=t==null?void 0:t.data)==null?void 0:X.data)==null?void 0:$.userDetails)==null?void 0:z.ulb_id),window.localStorage.setItem("device","mobile"),window.localStorage.setItem("userUlbName",JSON.stringify((K=(H=(G=t==null?void 0:t.data)==null?void 0:G.data)==null?void 0:H.userDetails)==null?void 0:K.ulbName)),Nt.set("accesstoken",(Y=(W=t==null?void 0:t.data)==null?void 0:W.data)==null?void 0:Y.token,{expires:7,secure:!0}),R((Q=t==null?void 0:t.data)==null?void 0:Q.data),v((et=(tt=(Z=t==null?void 0:t.data)==null?void 0:Z.data)==null?void 0:tt.userDetails)==null?void 0:et.role),f(s=>s+1),i(!0),ct.post(mt,{moduleId:1},rt()).then(s=>{var it,lt,ot;console.log("getPermission response => ",s),s.data.status==!0?window.localStorage.setItem("menuList",JSON.stringify((lt=(it=s==null?void 0:s.data)==null?void 0:it.data)==null?void 0:lt.permission)):(o((ot=s==null?void 0:s.data)==null?void 0:ot.message,"error"),g.setFieldValue("captcha",""),d(),w(!1))}).catch(s=>{console.log("getPermission error => ",s),o("Something went wrong !!! ","error"),g.setFieldValue("captcha",""),d(),w(!1)})):(w(!1),o((at=t==null?void 0:t.data)==null?void 0:at.message,"error"),g.setFieldValue("captcha",""),d(),w(!1))}).catch(function(t){w(!1),console.log("--2--login error...",t),o("Something went wrong !!! ","error"),g.setFieldValue("captcha",""),d(),w(!1)})};return c(nt,{children:p(Et,{formik:g,children:[c("div",{className:"mt-6 flex flex-col flex-wrap gap-2",children:c(b,{name:"email",label:"Email",formik:g})}),c("div",{className:"mt-4 flex flex-col flex-wrap gap-2",children:c(b,{type:"password",name:"password",label:"Password",formik:g})}),c("div",{className:"mt-6 flex flex-col flex-wrap gap-0",children:p("div",{className:"flex justify-between",children:[c("div",{className:"bg-gray-400 px-4 py-1 rounded-sm",children:c("img",{src:m,alt:"captcha"})}),c("div",{children:c("button",{type:"button",onClick:d,className:"text-[#5846BE] text-sm",children:"Reload Captcha"})})]})}),c("div",{className:"mt-2 flex flex-col flex-wrap gap-2",children:u(g)}),c("div",{className:"text-center mb-6 mt-4",children:S?c("div",{className:"flex justify-center",children:c(St,{strokeColor:"grey",strokeWidth:"5",animationDuration:"0.75",width:"25",visible:!0})}):p(nt,{children:[c("div",{className:"mb-1",children:c(vt,{to:"/forget-password",className:"text-xs text-indigo-600",children:"Forgot Password ?"})}),p("button",{disabled:S,type:"submit",className:"px-4 py-1.5 bg-green-200 hover:bg-green-300 rounded-md shadow-md text-sm",children:[" ",S?"Please wait...":"Login"]})," "]})})]})})};export{Pt as default};
