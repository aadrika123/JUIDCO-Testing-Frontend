import{u as W,z as O,s as T,g as j,b as X,o as Z,r as h,j as a,D as aa,F as ea,J as sa,R as M,y as Q,B as ta,c as da,d as A,_ as o,G as V,t as ra,v as la,H as na,w as ca,S as ia,x as oa}from"./index-BhUdOP_r.js";import{P as ua}from"./index-Dz8sjSL2.js";import{T as ha,a as xa,b as K,c,d as ga,e as i}from"./table-CwxQdaVU.js";import{g as ja}from"./services-KQnp_8oA.js";import{P as pa}from"./index-DIhL8Sw8.js";import{S as fa}from"./index-DAPV0_uK.js";import{q as ba}from"./switch-C83BFyiM.js";import"./pagination-B5OvJmEf.js";const Na=da().shape({latitude:A().required("titleName Name is required"),longitude:A().required("Longitude is required"),radius:A().required("Radius is required"),ulbId:A().required("Ulb id is required")});function ya({open:I,setOpen:x,title:q,id:g,edit:u,setEdit:p,refetch:C}){var P,$,b;const E=W({}),f=O({}),{data:r,isFetching:F}=T({api:`${j.getLocationById}/${g}`,key:"getLocationById",options:{enabled:u}}),l=X({defaultValues:{latitude:"",longitude:"",radius:"",ulbId:""},resolver:Z(Na)}),S=async n=>{var N,y,L,m;try{if(u&&n){const t=await f.mutateAsync({api:`${j.updateLocation}/${g}`,data:n});(N=t.data)!=null&&N.success?o.success((y=t==null?void 0:t.data)==null?void 0:y.message):o.error("Location not updated successfully")}else{const t=await E.mutateAsync({api:j.createLocation,data:n});(L=t.data)!=null&&L.success?o.success((m=t==null?void 0:t.data)==null?void 0:m.message):o.error("Location not created successfully"),l.reset({latitude:"",longitude:"",radius:"",ulbId:""})}x(!1),p(!1),C()}catch(t){console.log(t)}};h.useEffect(()=>{u&&r?l.reset({latitude:r.data.latitude,longitude:r.data.longitude,radius:r.data.radius,ulbId:r.data.ulbId}):l.reset({latitude:"",longitude:"",radius:"",ulbId:""})},[u,r]);const s=T({api:`${j.getAllUlb}?page=1&limit=1000`,key:"getAllUlb",options:{enabled:!0}});return a.jsx(aa,{open:I,setOpen:x,title:q,setEdit:p,edit:u,isLoading:F,children:a.jsx(ea,{methods:l,onSubmit:l.handleSubmit(S),children:a.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[a.jsx("div",{children:a.jsx(sa,{name:"ulbId",data:((b=($=(P=s.data)==null?void 0:P.data)==null?void 0:$.docs)==null?void 0:b.map(n=>({value:n._id,label:n.ulbName})))??[]})}),a.jsx("div",{children:a.jsx(M,{name:"latitude",placeholder:"Enter latitude"})}),a.jsx("div",{children:a.jsx(M,{name:"longitude",placeholder:"Enter longitude"})}),a.jsx("div",{children:a.jsx(M,{name:"radius",placeholder:"Enter radius"})}),a.jsx(Q,{}),a.jsx("div",{children:a.jsx(ta,{isLoading:l.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}function La(){var b,n,N,y,L,m,t,k,B,H,R;const I=O({}),[x,q]=h.useState(1),[g,u]=h.useState(10),[p,C]=h.useState(""),[E,f]=h.useState(!1),[r,F]=h.useState(""),[l,S]=h.useState(!1),s=T({api:`${j.getAllLocation}?page=${x}&limit=${g}&q=${p}`,key:"getAllLocation",value:[x,g],options:{enabled:!0}}),P=e=>{S(!0),f(!0),F(e)},$=async e=>{var w,v,_,U,Y,z,D,G,J;try{const d=await I.mutateAsync({api:`${(w=j)==null?void 0:w.updateLocationStatus}/${e}`,data:{id:r}});(v=d==null?void 0:d.data)!=null&&v.success?(s.refetch(),((U=(_=d==null?void 0:d.data)==null?void 0:_.data)==null?void 0:U.status)==1&&o.success((Y=d.data)==null?void 0:Y.message),((D=(z=d==null?void 0:d.data)==null?void 0:z.data)==null?void 0:D.status)==0&&o.error((G=d.data)==null?void 0:G.message)):o.error((J=d.data)==null?void 0:J.message)}catch(d){o.error(ja(d))}};return a.jsxs("main",{className:"grid items-start",children:[a.jsx(ya,{open:E,setOpen:f,title:l?"Edit Location":"Add Location",id:r,edit:l,setEdit:S,refetch:s.refetch}),a.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[a.jsxs("div",{className:"flex w-full justify-between gap-2",children:[a.jsx("div",{children:a.jsx(fa,{search:p,setSearch:C,refetch:s.refetch,isFetching:s.isLoading})}),a.jsx("div",{children:a.jsx(V,{className:"flex items-center gap-2",onClick:()=>f(!0),children:"Add New"})})]}),a.jsxs(ra,{children:[a.jsx(la,{className:"px-7",children:a.jsxs(na,{children:["Location List (",(n=(b=s.data)==null?void 0:b.data)==null?void 0:n.totalDocs,")"]})}),a.jsx(ca,{children:s.isLoading?a.jsx("div",{className:"flex h-32 items-center justify-center",children:a.jsx(ia,{})}):a.jsxs(a.Fragment,{children:[a.jsxs(ha,{children:[a.jsx(xa,{children:a.jsxs(K,{children:[a.jsx(c,{className:"",children:"#"}),a.jsx(c,{className:"",children:"Ulb"}),a.jsx(c,{className:"",children:"Latitude"}),a.jsx(c,{className:"",children:"Longitude"}),a.jsx(c,{className:"",children:"Radius(In Meter)"}),a.jsx(c,{className:"",children:"Id"}),a.jsx(c,{className:"",children:"Created at"}),a.jsx(c,{className:"",children:"Status"}),a.jsx(c,{children:"Action"})]})}),a.jsx(ga,{children:(L=(y=(N=s==null?void 0:s.data)==null?void 0:N.data)==null?void 0:y.docs)==null?void 0:L.map((e,w)=>{var v;return a.jsxs(K,{children:[a.jsx(i,{children:w+1}),a.jsx(i,{children:(v=e==null?void 0:e.ulb)==null?void 0:v.ulbName}),a.jsx(i,{children:e==null?void 0:e.latitude}),a.jsx(i,{children:e==null?void 0:e.longitude}),a.jsx(i,{children:e==null?void 0:e.radius}),a.jsx(i,{children:e==null?void 0:e._id}),a.jsx(i,{children:oa(e==null?void 0:e.createdAt).format("DD-MM-YYYY")}),a.jsx(i,{children:a.jsxs(ba,{checked:(e==null?void 0:e.status)==1,onChange:()=>$(e==null?void 0:e._id),className:`${e!=null&&e.status?"bg-primary":"bg-gray-200"} relative inline-flex items-center h-6 rounded-full w-11`,children:[a.jsx("span",{className:"sr-only",children:"Enable notifications"}),a.jsx("span",{className:`${e!=null&&e.status?"translate-x-6":"translate-x-1"} inline-block w-4 h-4 transform bg-white rounded-full`})]})}),a.jsx(i,{children:a.jsx(V,{className:"bg-primary",onClick:()=>P(e==null?void 0:e._id),children:"Edit"})})]},e==null?void 0:e._id)})})]}),a.jsx(Q,{className:"mb-2 mt-4"}),a.jsx("div",{className:"flex w-full justify-end",children:a.jsx(pa,{page:x,perPage:g,totalPage:(t=(m=s==null?void 0:s.data)==null?void 0:m.data)==null?void 0:t.totalDocs,hasNextPage:(B=(k=s==null?void 0:s.data)==null?void 0:k.data)==null?void 0:B.hasNextPage,hasPrevPage:(R=(H=s==null?void 0:s.data)==null?void 0:H.data)==null?void 0:R.hasPrevPage,setPage:q,setPerPage:u})})]})})]})]})]})}function qa(){return a.jsx(ua,{title:"Location List",subTitle:"Manage all the Location here",children:a.jsx("div",{className:"py-12",children:a.jsx(La,{})})})}export{qa as default};
