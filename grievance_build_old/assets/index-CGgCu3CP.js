import{u as W,z as O,s as H,g as p,b as X,o as Z,r as u,j as s,D as ss,F as es,R as E,J as as,y as Q,B as ts,c as is,d as y,_ as h,G as V,t as ds,v as ns,H as rs,w as cs,S as ls,x as ms}from"./index-BhUdOP_r.js";import{P as hs}from"./index-Dz8sjSL2.js";import{T as os,a as us,b as K,c as n,d as xs,e as r}from"./table-CwxQdaVU.js";import{g as ps}from"./services-KQnp_8oA.js";import{P as js}from"./index-DIhL8Sw8.js";import{S as gs}from"./index-DAPV0_uK.js";import{q as fs}from"./switch-C83BFyiM.js";import"./pagination-B5OvJmEf.js";const bs=is().shape({problem:y().required("Role name is required"),departmentId:y().required("Description is required"),sla1:y().required("Description is required"),sla2:y().required("Description is required"),sla3:y().required("Description is required")});function Ps({open:x,setOpen:j,title:I,id:m,edit:o,setEdit:g,refetch:L}){var $,w,b;const C=W({}),f=O({}),{data:d,isFetching:A}=H({api:`${p.getProblemById}/${m}`,key:"getRoleById",options:{enabled:o}}),c=X({defaultValues:{problem:"",departmentId:"",sla1:"",sla2:"",sla3:""},resolver:Z(bs)}),F=async l=>{var P,S,v,N;try{if(o&&l){const t=await f.mutateAsync({api:`${p.updateProblem}/${m}`,data:l});(P=t.data)!=null&&P.success?h.success((S=t==null?void 0:t.data)==null?void 0:S.message):h.error("Role not updated successfully")}else{const t=await C.mutateAsync({api:p.createProblem,data:l});(v=t.data)!=null&&v.success?h.success((N=t==null?void 0:t.data)==null?void 0:N.message):h.error("Role not created successfully"),c.reset({problem:"",departmentId:"",sla1:"",sla2:"",sla3:""})}j(!1),g(!1),L()}catch(t){console.log(t)}};u.useEffect(()=>{o&&d?c.reset({problem:d.data.problem,departmentId:d.data.departmentId,sla1:d.data.sla1,sla2:d.data.sla2,sla3:d.data.sla3}):c.reset({problem:"",departmentId:"",sla1:"",sla2:"",sla3:""})},[o,d]);const a=H({api:`${p.getAllDepartment}?page=1&limit=1000`,key:"getAllDepartment",options:{enabled:!0}});return s.jsx(ss,{open:x,setOpen:j,title:I,setEdit:g,edit:o,isLoading:A,children:s.jsx(es,{methods:c,onSubmit:c.handleSubmit(F),children:s.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[s.jsx("div",{children:s.jsx(E,{name:"problem",placeholder:"Enter problem name"})}),s.jsx("div",{children:s.jsx(as,{name:"departmentId",data:((b=(w=($=a.data)==null?void 0:$.data)==null?void 0:w.docs)==null?void 0:b.map(l=>({value:l._id,label:l.department})))??[]})}),s.jsx("div",{children:s.jsx(E,{name:"sla1",placeholder:"Enter SLA 1"})}),s.jsx("div",{children:s.jsx(E,{name:"sla2",placeholder:"Enter SLA 2"})}),s.jsx("div",{children:s.jsx(E,{name:"sla3",placeholder:"Enter SLA 3"})}),s.jsx(Q,{}),s.jsx("div",{children:s.jsx(ts,{isLoading:c.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}function Ss(){var b,l,P,S,v,N,t,R,T,k,B;const[x,j]=u.useState(1),I=O({}),[m,o]=u.useState(10),[g,L]=u.useState(""),[C,f]=u.useState(!1),[d,A]=u.useState(!1),[c,F]=u.useState(""),a=H({api:`${p.getAllProblem}?page=${x}&limit=${m}&q=${g}`,key:"getAllProblem",value:[x,m],options:{enabled:!0}}),$=async e=>{var q,M,D,G,_,Y,z,J,U;try{const i=await I.mutateAsync({api:`${(q=p)==null?void 0:q.updateProblemStatus}/${e}`,data:{id:c}});(M=i==null?void 0:i.data)!=null&&M.success?(a.refetch(),((G=(D=i==null?void 0:i.data)==null?void 0:D.data)==null?void 0:G.status)==1&&h.success((_=i.data)==null?void 0:_.message),((z=(Y=i==null?void 0:i.data)==null?void 0:Y.data)==null?void 0:z.status)==0&&h.error((J=i.data)==null?void 0:J.message)):h.error((U=i.data)==null?void 0:U.message)}catch(i){h.error(ps(i))}},w=e=>{A(!0),f(!0),F(e)};return s.jsxs("main",{className:"grid items-start",children:[s.jsx(Ps,{open:C,setOpen:f,title:d?"Edit Gr Problem":"Add Gr Problem",id:c,edit:d,setEdit:A,refetch:a.refetch}),s.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[s.jsxs("div",{className:"flex w-full justify-between gap-2",children:[s.jsx("div",{children:s.jsx(gs,{search:g,setSearch:L,setPage:j,refetch:a.refetch,isFetching:a.isLoading})}),s.jsx("div",{children:s.jsx(V,{className:"flex items-center gap-2",onClick:()=>f(!0),children:"Add New"})})]}),s.jsxs(ds,{children:[s.jsx(ns,{className:"px-7",children:s.jsxs(rs,{children:["Grievance Problem List (",(l=(b=a.data)==null?void 0:b.data)==null?void 0:l.totalDocs,")"]})}),s.jsx(cs,{children:a.isLoading?s.jsx("div",{className:"flex h-32 items-center justify-center",children:s.jsx(ls,{})}):s.jsxs(s.Fragment,{children:[s.jsxs(os,{children:[s.jsx(us,{children:s.jsxs(K,{children:[s.jsx(n,{className:"",children:"#"}),s.jsx(n,{className:"",children:"Gr Problem"}),s.jsx(n,{className:"",children:"Department"}),s.jsx(n,{className:"",children:"SLA 1"}),s.jsx(n,{className:"",children:"SLA 2"}),s.jsx(n,{className:"",children:"SLA 3"}),s.jsx(n,{className:"",children:"Id"}),s.jsx(n,{className:"",children:"Created at"}),s.jsx(n,{className:"",children:"Status"}),s.jsx(n,{children:"Action"})]})}),s.jsx(xs,{children:(v=(S=(P=a==null?void 0:a.data)==null?void 0:P.data)==null?void 0:S.docs)==null?void 0:v.map((e,q)=>s.jsxs(K,{children:[s.jsx(r,{children:x*m-m+q+1}),s.jsx(r,{children:e==null?void 0:e.problem}),s.jsx(r,{children:e==null?void 0:e.departmentName}),s.jsxs(r,{children:[e==null?void 0:e.sla1," (Hs)"]}),s.jsxs(r,{children:[e==null?void 0:e.sla2," (Hs)"]}),s.jsxs(r,{children:[e==null?void 0:e.sla3," (Hs)"]}),s.jsx(r,{children:e==null?void 0:e._id}),s.jsx(r,{children:ms(e==null?void 0:e.createdAt).format("DD-MM-YYYY")}),s.jsx(r,{children:s.jsxs(fs,{checked:(e==null?void 0:e.status)==1,onChange:()=>$(e._id),className:`${e!=null&&e.status?"bg-primary":"bg-gray-200"} relative inline-flex items-center h-6 rounded-full w-11`,children:[s.jsx("span",{className:"sr-only",children:"Enable notifications"}),s.jsx("span",{className:`${e!=null&&e.status?"translate-x-6":"translate-x-1"} inline-block w-4 h-4 transform bg-white rounded-full`})]})}),s.jsx(r,{children:s.jsx(V,{onClick:()=>w(e==null?void 0:e._id),children:"Edit"})})]},e==null?void 0:e._id))})]}),s.jsx(Q,{className:"mb-2 mt-4"}),s.jsx("div",{className:"flex w-full justify-end",children:s.jsx(js,{page:x,perPage:m,totalPage:(t=(N=a==null?void 0:a.data)==null?void 0:N.data)==null?void 0:t.totalDocs,hasNextPage:(T=(R=a==null?void 0:a.data)==null?void 0:R.data)==null?void 0:T.hasNextPage,hasPrevPage:(B=(k=a==null?void 0:a.data)==null?void 0:k.data)==null?void 0:B.hasPrevPage,setPage:j,setPerPage:o})})]})})]})]})]})}function Is(){return s.jsx(hs,{title:"Grievance Problem",subTitle:"Manage all the Grievance Problem here",children:s.jsx("div",{children:s.jsx(Ss,{})})})}export{Is as default};
