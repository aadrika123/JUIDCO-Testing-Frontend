import{a as ma,z as Ia,r as y,b as Ta,o as wa,s as i,g as d,j as a,F as Aa,y as ia,a0 as o,R as T,J as h,B as Sa,t as $a,v as Pa,H as Ca,w as ka,S as Da,x as ha,a3 as g,L as Fa,G as w,c as Ra,d as n,P as _a,_ as A}from"./index-BhUdOP_r.js";import{T as Ba,a as Ha,b as pa,c as r,d as La,e as c}from"./table-CwxQdaVU.js";import{P as Ga}from"./index-DIhL8Sw8.js";import{P as Ma}from"./index-Dz8sjSL2.js";import"./pagination-B5OvJmEf.js";const Ua=Ra().shape({ulbId:n(),moduleId:n(),complaintTypeId:n(),priorityId:n(),targetTypeId:n(),complaintSourceTypeId:n(),departmentId:n(),fDate:n(),slaStatusSearch:n(),toDate:n(),complaintRefNo:n(),type:n()});function Ya(){var S,$,P,C,k,D,F,R,_,B,H,L,G,M,U,Y,O,J,z,E,V,q,K,Q,W,X,Z,aa,ea,la,ta,sa,na,ra,ca,da;const{user:l}=ma(),xa=Ia({}),[u,ga]=y.useState(1),[p,ua]=y.useState(10),[ja,ba]=y.useState(new Set),t=Ta({resolver:wa(Ua),defaultValues:{ulbId:"",moduleId:"",complaintTypeId:"",priorityId:"",targetTypeId:"",slaStatusSearch:"",complaintSourceTypeId:"",departmentId:"",fDate:"",toDate:"",complaintRefNo:"",type:""}});console.log("methods"),t.watch("type");const ya=async()=>{s.refetch()},s=i({api:`${d.complaintReport}?page=${u}&limit=${p}&priority=${t.watch("priorityId")}&ulb=${t.watch("ulbId")}&complaintType=${t.watch("complaintTypeId")}&targetType=${t.watch("targetTypeId")}&module=${t.watch("moduleId")}&source=${t.watch("complaintSourceTypeId")}&fDate=${t.watch("fDate")}&toDate=${t.watch("toDate")}&complaintRefNo=${t.watch("complaintRefNo")}&slaStatusSearch=${t.watch("slaStatusSearch")}&departmentId=${t.watch("departmentId")}&type=${t.watch("type")}   `,key:"searchAllComplaints",value:[u,p],options:{enabled:!0}}),j=i({api:`${(S=d)==null?void 0:S.getAllUlb}?page=1&limit=10000`,key:"getAllUlb",options:{enabled:!0}});i({api:`${($=d)==null?void 0:$.getAllModule}?page=1&limit=10000`,key:"geAllModules",options:{enabled:!0}});const N=i({api:`${(P=d)==null?void 0:P.getAllComplaintType}?page=1&limit=10000`,key:"getAllComplaintTypes",options:{enabled:!0}}),v=i({api:`${(C=d)==null?void 0:C.getAllPriority}?page=1&limit=10000`,key:"getAllPriority",options:{enabled:!0}}),f=i({api:`${(k=d)==null?void 0:k.getAllTarget}?page=1&limit=10000`,key:"getAllTargetTypes",options:{enabled:!0}}),m=i({api:`${d.getAllComplaintSource}?page=1&limit=10000`,key:"getAllComplaintSource",options:{enabled:!0}}),I=i({api:`${d.getAllDepartment}?page=1&limit=10000`,key:"getAllDepartment",options:{enabled:!0,refetchOnMount:!1}});i({api:`${d.getAllProblemDirect}?page=1&limit=10000`,key:"getProblemData",options:{enabled:!0,refetchOnMount:!1}});const Na=y.useRef(null),va=async e=>{_a("Do you want to highlight this complaint?","Please confirm",async()=>{var x;try{(x=(await xa.mutateAsync({api:`${d.updateComplaintApplicationById}/${e}`,data:{isHighlighted:!0}})).data)!=null&&x.success?(ba(fa=>new Set(fa).add(e)),A.success("This Application is now highlighted")):A.error("This Application is not highlighted")}catch{A.error("This Application is not highlighted")}})};return console.log("Bug Fixing- ",(F=(D=j==null?void 0:j.data)==null?void 0:D.data)==null?void 0:F.docs),a.jsxs(a.Fragment,{children:[a.jsx(Aa,{methods:t,onSubmit:t.handleSubmit(ya),children:a.jsxs("div",{className:"grid grid-cols-4 gap-x-2 gap-y-4 bg-background px-10 py-4",children:[a.jsxs("h1",{className:"col-span-4 text-xl font-bold uppercase text-blue-800",children:["Search Grievance"," "]}),a.jsx(ia,{className:"col-span-4"}),a.jsxs("div",{children:[a.jsx(o,{htmlFor:"complaintRefNo",children:"Grievance No."}),a.jsx(T,{name:"complaintRefNo",className:"",placeholder:"Enter Grievance number"})]}),a.jsxs("div",{children:[a.jsx(o,{htmlFor:"fDate",children:"From Date"}),a.jsx(T,{name:"fDate",type:"date",className:""})]}),a.jsxs("div",{children:[a.jsx(o,{htmlFor:"toDate",children:"Upto Date"}),a.jsx(T,{name:"toDate",type:"date",className:""})]}),a.jsxs("div",{children:[a.jsx(o,{htmlFor:"ulbId",children:"ULB"}),a.jsx(h,{className:"cursor-pointer bg-background",name:"ulbId",data:((B=(_=(R=j.data)==null?void 0:R.data)==null?void 0:_.docs)==null?void 0:B.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.ulbName})))??[]})]}),a.jsxs("div",{children:[a.jsx(o,{htmlFor:"departmentId",children:"Department"}),a.jsx(h,{className:"cursor-pointer bg-background",name:"departmentId",data:((G=(L=(H=I==null?void 0:I.data)==null?void 0:H.data)==null?void 0:L.docs)==null?void 0:G.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.department})))??[]})]}),a.jsxs("div",{children:[a.jsx(o,{htmlFor:"complaintTypeId",children:"Grievance Type"}),a.jsx(h,{className:"cursor-pointer bg-background",name:"complaintTypeId",data:((Y=(U=(M=N==null?void 0:N.data)==null?void 0:M.data)==null?void 0:U.docs)==null?void 0:Y.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.complaintTypeName})))??[]})]}),a.jsxs("div",{children:[a.jsx(o,{htmlFor:"priorityId",children:"Priority"}),a.jsx(h,{className:"cursor-pointer bg-background",name:"priorityId",data:((z=(J=(O=v==null?void 0:v.data)==null?void 0:O.data)==null?void 0:J.docs)==null?void 0:z.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.priorityName})))??[]})]}),a.jsxs("div",{children:[a.jsx(o,{htmlFor:"targetTypeId",children:"Target Type"}),a.jsx(h,{className:"cursor-pointer bg-background",name:"targetTypeId",data:((q=(V=(E=f==null?void 0:f.data)==null?void 0:E.data)==null?void 0:V.docs)==null?void 0:q.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.targetType})))??[]})]}),a.jsxs("div",{children:[a.jsx(o,{htmlFor:"complaintSourceTypeId",children:"Grievance Source Type"}),a.jsx(h,{className:"cursor-pointer bg-background",name:"complaintSourceTypeId",data:((W=(Q=(K=m==null?void 0:m.data)==null?void 0:K.data)==null?void 0:Q.docs)==null?void 0:W.map(e=>({value:e==null?void 0:e._id,label:e==null?void 0:e.source})))??[]})]}),a.jsxs("div",{children:[a.jsx(o,{htmlFor:"type",children:"Grievance Status"}),a.jsx(h,{name:"type",data:[{value:"0",label:"Pending"},{value:"1",label:"Resolved"},{value:"2",label:"Rejected"},{value:"3",label:"Pending (Re-Opened)"},{value:"4",label:"Close"}]})]}),a.jsx("div",{}),a.jsx("div",{className:"mt-6",children:a.jsx(Sa,{isLoading:t.formState.isSubmitting,type:"submit",className:" float-right  w-auto px-10",children:"Search"})})]})}),a.jsx("div",{className:"mt-2",children:a.jsxs($a,{children:[a.jsx(Pa,{className:"px-7",children:a.jsx(Ca,{className:"flex justify-between",children:a.jsxs("h1",{children:["Grievance List (",(Z=(X=s.data)==null?void 0:X.data)==null?void 0:Z.totalDocs,")"]})})}),a.jsx(ka,{children:s.isLoading?a.jsx("div",{className:"flex h-32 items-center justify-center",children:a.jsx(Da,{})}):a.jsxs("div",{children:[a.jsxs(Ba,{ref:Na,children:[a.jsx(Ha,{children:a.jsxs(pa,{children:[a.jsx(r,{className:"",children:"#"}),a.jsx(r,{className:"",children:"Grievance No."}),a.jsx(r,{className:"",children:"Department"}),t.watch("fDate")&&a.jsx(r,{className:"",children:"From Date"}),t.watch("toDate")&&a.jsx(r,{className:"",children:"Upto Date"}),a.jsx(r,{className:"",children:"Ulb Name"}),a.jsx(r,{className:"",children:"Citizen Name"}),a.jsx(r,{className:"",children:"Mobile No."}),a.jsx(r,{className:"",children:"Resolve Status"}),a.jsx(r,{className:"",children:"View"}),!((l==null?void 0:l.role)==="ULB GRO"||(l==null?void 0:l.role)==="ULB Admin"||(l==null?void 0:l.role)==="Normal"||(l==null?void 0:l.role)==="Telecaller"||(l==null?void 0:l.role)==="State Jsk/Ivr/Calling"||(l==null?void 0:l.role)==="Jsk/ Ivr /Calling")&&a.jsx(r,{className:"",children:"Action"})]})}),a.jsx(La,{children:(la=(ea=(aa=s==null?void 0:s.data)==null?void 0:aa.data)==null?void 0:ea.docs)==null?void 0:la.map((e,oa)=>{var x,b;return a.jsxs(pa,{children:[a.jsx(c,{children:u*p-p+oa+1}),a.jsx(c,{children:e.complaintRefNo||"N/A"}),a.jsx(c,{children:((x=e==null?void 0:e.department)==null?void 0:x.department)||"N/A"}),t.watch("fDate")&&a.jsxs(c,{children:[t.watch("fDate")?ha(t.watch("fDate")).format("DD-MM-YYYY"):"N/A"," "]}),t.watch("toDate")&&a.jsx(c,{children:ha(e.createdAt).format("DD-MM-YYYY")||"N/A"}),a.jsx(c,{children:((b=e.ulb)==null?void 0:b.ulbName)||"N/A"}),a.jsx(c,{children:e.citizenName||"N/A"}),a.jsx(c,{children:e.mobileNo||"N/A"}),a.jsxs(c,{children:[(e==null?void 0:e.wf_status)===4&&a.jsx(g,{variant:"destructive",children:"Closed"}),(e==null?void 0:e.wf_status)===3&&a.jsx(g,{className:"bg-amber-500 text-white",children:"Pending(Re-Opened)"}),(e==null?void 0:e.wf_status)===2&&a.jsx(g,{variant:"destructive",children:"Rejected"}),(e==null?void 0:e.wf_status)===1&&a.jsx(g,{variant:"success",children:"Resolved"}),(e==null?void 0:e.wf_status)===0&&a.jsx(g,{variant:"secondary",children:"Pending"})]}),a.jsx(c,{children:a.jsx(Fa,{to:`/grievance/dashboard/management-complaint-details?complaintRefNo=${e==null?void 0:e.complaintRefNo}
                         &complaintId=${e==null?void 0:e._id}`,children:a.jsx(w,{className:"bg-primary",onClick:()=>{},children:"View"})})}),!((l==null?void 0:l.role)==="ULB GRO"||(l==null?void 0:l.role)==="ULB Admin"||(l==null?void 0:l.role)==="Normal"||(l==null?void 0:l.role)==="Telecaller"||(l==null?void 0:l.role)==="State Jsk/Ivr/Calling"||(l==null?void 0:l.role)==="Jsk/ Ivr /Calling")&&a.jsx(c,{children:ja.has(e==null?void 0:e._id)||e!=null&&e.isHighlighted?a.jsx(w,{type:"button",className:"bg-green-500",children:"Highlighted"}):a.jsx(w,{type:"button",className:"bg-red-500",onClick:()=>va(e==null?void 0:e._id),children:"Highlight"})})]},e._id)})})]}),a.jsx(ia,{className:"mb-2 mt-4"}),a.jsx("div",{className:"flex w-full justify-end",children:a.jsx(Ga,{page:u,perPage:p,totalPage:(sa=(ta=s==null?void 0:s.data)==null?void 0:ta.data)==null?void 0:sa.totalDocs,hasNextPage:(ra=(na=s==null?void 0:s.data)==null?void 0:na.data)==null?void 0:ra.hasNextPage,hasPrevPage:(da=(ca=s==null?void 0:s.data)==null?void 0:ca.data)==null?void 0:da.hasPrevPage,setPage:ga,setPerPage:ua})})]})})]})})]})}function qa(){return a.jsx(Ma,{title:"",subTitle:"",children:a.jsx("div",{className:"",children:a.jsx(Ya,{})})})}export{qa as default};
