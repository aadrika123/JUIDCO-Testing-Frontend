import{u as Z,z as Q,s as W,g as y,b as ee,o as ae,r as h,j as e,D as ie,F as te,R as se,A as ne,a0 as D,J as G,K as ce,y as X,B as re,c as de,d as J,ad as K,M as oe,_ as m,G as V,t as le,v as me,H as ue,w as he,S as pe,I as xe,x as fe}from"./index-BhUdOP_r.js";import{P as ge}from"./index-Dz8sjSL2.js";import{T as je,a as Ne,b as O,c as o,d as ye,e as l}from"./table-CwxQdaVU.js";import{g as Se}from"./services-KQnp_8oA.js";import{P as be}from"./index-DIhL8Sw8.js";import{S as Te}from"./index-DAPV0_uK.js";import{q as ve}from"./switch-C83BFyiM.js";import"./pagination-B5OvJmEf.js";const we=de().shape({title:J().required("Title  is required"),description:J().required("Description is required"),notificationSide:K().required("Notification Side is required"),notificationType:K().required("Notification Type is required"),imageUrl:oe().nullable()});function Pe({open:p,setOpen:S,title:w,id:d,edit:u,setEdit:x,refetch:P}){const F=Z({}),f=Q({}),{data:n,isFetching:$}=W({api:`${y.getNotificationById}/${d}`,key:"getNotificationById",options:{enabled:u}}),c=ee({defaultValues:{title:"",description:"",notificationSide:"",notificationType:""},resolver:ae(we)}),b=async a=>{var T,g,j,N;const r=new FormData;r.append("title",a.title),r.append("description",a.description),r.append("notificationSide",a.notificationSide),r.append("notificationType",String(a==null?void 0:a.notificationType)),r.append("imageUrl",a.imageUrl);try{if(u&&a){const t=await f.mutateAsync({api:`${y.updateNotification}/${d}`,data:r});(T=t.data)!=null&&T.success?m.success((g=t==null?void 0:t.data)==null?void 0:g.message):m.error("Notification not updated successfully")}else{const t=await F.mutateAsync({api:y.createNotification,data:r});(j=t.data)!=null&&j.success?m.success((N=t==null?void 0:t.data)==null?void 0:N.message):m.error("Notification not created successfully"),c.reset({title:"",description:"",notificationSide:"",notificationType:""})}S(!1),x(!1),P()}catch(t){console.log(t)}};return h.useEffect(()=>{u&&n?c.reset({title:n.data.title,description:n.data.description,notificationSide:n.data.notificationSide,notificationType:n.data.notificationType,imageUrl:n.data.imageUrl}):c.reset({title:"",description:"",notificationSide:"",notificationType:""})},[u,n]),e.jsx(ie,{open:p,setOpen:S,title:w,setEdit:x,edit:u,isLoading:$,children:e.jsx(te,{methods:c,onSubmit:c.handleSubmit(b),children:e.jsxs("div",{className:"grid grid-cols-1 gap-x-2 gap-y-4",children:[e.jsx("div",{children:e.jsx(se,{name:"title",placeholder:"Enter your Title"})}),e.jsx("div",{children:e.jsx(ne,{name:"description",placeholder:"Enter your description"})}),e.jsx(D,{htmlFor:"notificationSide",children:"Notification Side"}),e.jsx("div",{children:e.jsx(G,{name:"notificationSide",data:[{value:"1",label:"Citizen"},{value:"0",label:"management"}]})}),e.jsx(D,{htmlFor:"notificationType",children:"Notification Type"}),e.jsx("div",{children:e.jsx(G,{name:"notificationType",data:[{value:"0",label:"Notification"},{value:"1",label:"Recent News"}]})}),e.jsx("div",{children:e.jsx(ce,{name:"imageUrl",placeholder:"Upload your Images"})}),e.jsx(X,{}),e.jsx("div",{children:e.jsx(re,{isLoading:c.formState.isSubmitting,type:"submit",className:"h-11 w-full rounded-xl",children:"Submit"})})]})})})}function Fe(){var g,j,N,t,C,A,q,E,I,M,R;const[p,S]=h.useState(1),w=Q({}),[d,u]=h.useState(10),[x,P]=h.useState(""),[F,f]=h.useState(!1),[n,$]=h.useState(""),[c,b]=h.useState(!1),a=W({api:`${y.getAllNotification}?page=${p}&limit=${d}&q=${x}`,key:"getAllNotification",value:[p,d],options:{enabled:!0}}),r=i=>{b(!0),f(!0),$(i)},T=async i=>{var v,U,k,H,B,L,_,z,Y;try{const s=await w.mutateAsync({api:`${(v=y)==null?void 0:v.updateNotificationStatus}/${i}`,data:{id:n}});(U=s==null?void 0:s.data)!=null&&U.success?(a.refetch(),((H=(k=s==null?void 0:s.data)==null?void 0:k.data)==null?void 0:H.status)==1&&m.success((B=s.data)==null?void 0:B.message),((_=(L=s==null?void 0:s.data)==null?void 0:L.data)==null?void 0:_.status)==0&&m.error((z=s.data)==null?void 0:z.message)):m.error((Y=s.data)==null?void 0:Y.message)}catch(s){m.error(Se(s))}};return e.jsxs("main",{className:"grid items-start",children:[e.jsx(Pe,{open:F,setOpen:f,title:c?"Edit News":"Add News",id:n,edit:c,setEdit:b,refetch:a.refetch}),e.jsxs("div",{className:"grid auto-rows-max items-start gap-4 md:gap-2 lg:col-span-2",children:[e.jsxs("div",{className:"flex w-full justify-between gap-2",children:[e.jsx("div",{children:e.jsx(Te,{search:x,setSearch:P,refetch:a.refetch,isFetching:a.isLoading})}),e.jsx("div",{children:e.jsx(V,{className:"flex items-center gap-2",onClick:()=>f(!0),children:"Add New"})})]}),e.jsxs(le,{children:[e.jsx(me,{className:"px-7",children:e.jsxs(ue,{children:["News List (",(j=(g=a.data)==null?void 0:g.data)==null?void 0:j.totalDocs,")"]})}),e.jsx(he,{children:a.isLoading?e.jsx("div",{className:"flex h-32 items-center justify-center",children:e.jsx(pe,{})}):e.jsxs(e.Fragment,{children:[e.jsxs(je,{children:[e.jsx(Ne,{children:e.jsxs(O,{children:[e.jsx(o,{className:"",children:"#"}),e.jsx(o,{className:"",children:"Images"}),e.jsx(o,{className:"",children:"Title"}),e.jsx(o,{className:"",children:"Notification Side"}),e.jsx(o,{className:"",children:"Notification Type"}),e.jsx(o,{className:"",children:"Created at"}),e.jsx(o,{className:"",children:"Status"}),e.jsx(o,{children:"Action"})]})}),e.jsx(ye,{children:(C=(t=(N=a==null?void 0:a.data)==null?void 0:N.data)==null?void 0:t.docs)==null?void 0:C.map((i,v)=>e.jsxs(O,{children:[e.jsx(l,{children:p*d-d+v+1}),e.jsx(l,{style:{margin:5,width:"50px",height:"50px",backgroundSize:"cover",backgroundPosition:"center",borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center",padding:0},children:e.jsx(xe,{src:i==null?void 0:i.fullImgUrl,alt:i.imageUrl,className:"h-12 w-12 rounded-full"})}),e.jsx(l,{children:i.title}),e.jsx(l,{children:i.notificationSide==0?"Management":"Citizen"}),e.jsx(l,{children:i.notificationType==0?"Notification":"Recent News"}),e.jsx(l,{children:fe(i.createdAt).format("DD-MM-YYYY")}),e.jsx(l,{children:e.jsxs(ve,{checked:(i==null?void 0:i.status)==1,onChange:()=>T(i._id),className:`${i!=null&&i.status?"bg-primary":"bg-gray-200"} relative inline-flex items-center h-6 rounded-full w-11`,children:[e.jsx("span",{className:"sr-only",children:"Enable notifications"}),e.jsx("span",{className:`${i!=null&&i.status?"translate-x-6":"translate-x-1"} inline-block w-4 h-4 transform bg-white rounded-full`})]})}),e.jsx(l,{children:e.jsx(V,{onClick:()=>r(i._id),children:"Edit"})})]},i._id))})]}),e.jsx(X,{className:"mb-2 mt-4"}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(be,{page:p,perPage:d,totalPage:(q=(A=a==null?void 0:a.data)==null?void 0:A.data)==null?void 0:q.totalDocs,hasNextPage:(I=(E=a==null?void 0:a.data)==null?void 0:E.data)==null?void 0:I.hasNextPage,hasPrevPage:(R=(M=a==null?void 0:a.data)==null?void 0:M.data)==null?void 0:R.hasPrevPage,setPage:S,setPerPage:u})})]})})]})]})]})}function Ue(){return e.jsx(ge,{title:"News List",subTitle:"Manage all the News here",children:e.jsx("div",{className:"py-12",children:e.jsx(Fe,{})})})}export{Ue as default};
